{"version":3,"sources":["../db-monster-test/db-monster-lib.js"],"names":["window","ENV","counter","data","_base","String","prototype","lpad","padding","toLength","repeat","length","concat","formatElapsed","value","str","parseFloat","toFixed","minutes","Math","floor","comps","split","seconds","ms","getElapsedClassName","elapsed","className","countClassName","queries","updateQuery","object","random","elapsedClassName","query","waiting","cleanQuery","generateRow","keepIdentity","nbQueries","lastMutationId","lastSample","topFiveQueries","l","j","push","i","source","getData","oldData","rows","dbname","row","mutations","toArray","mutationsValue","body","document","querySelector","theFirstChild","firstChild","sliderContainer","createElement","style","cssText","slider","text","innerHTML","id","setAttribute","addEventListener","e","target","appendChild","insertBefore","generateData","timeout"],"mappings":"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","file":"db-monster-lib.74900742.map","sourceRoot":"../src/_html-web","sourcesContent":["window.ENV = function () {'use strict';\n  var counter = 0;\n  var data;\n  var _base;\n  if (!(_base = String.prototype).lpad)\n    _base.lpad = function (padding, toLength) {\n      return padding.repeat((toLength - this.length) / padding.length).concat(this);\n    };\n\n  function formatElapsed(value) {\n    var str = parseFloat(value).toFixed(2);\n    if (value > 60) {\n      var minutes = Math.floor(value / 60);\n      var comps = (value % 60).toFixed(2).split('.');\n      var seconds = comps[0].lpad('0', 2);\n      var ms = comps[1];\n      str = minutes + \":\" + seconds + \".\" + ms;\n    }\n    return str;\n  }\n\n  function getElapsedClassName(elapsed) {\n    var className = 'Query elapsed';\n    if (elapsed >= 10.0) {\n      className += ' warn_long';\n    }\n    else if (elapsed >= 1.0) {\n      className += ' warn';\n    }\n    else {\n      className += ' short';\n    }\n    return className;\n  }\n\n  function countClassName(queries) {\n    var countClassName = \"label\";\n    if (queries >= 20) {\n      countClassName += \" label-important\";\n    }\n    else if (queries >= 10) {\n      countClassName += \" label-warning\";\n    }\n    else {\n      countClassName += \" label-success\";\n    }\n    return countClassName;\n  }\n\n  function updateQuery(object) {\n    if (!object) {\n      object = {};\n    }\n    var elapsed = Math.random() * 15;\n    object.elapsed = elapsed;\n    object.formatElapsed = formatElapsed(elapsed);\n    object.elapsedClassName = getElapsedClassName(elapsed);\n    object.query = \"SELECT blah FROM something\";\n    object.waiting = Math.random() < 0.5;\n    if (Math.random() < 0.2) {\n      object.query = \"<IDLE> in transaction\";\n    }\n    if (Math.random() < 0.1) {\n      object.query = \"vacuum\";\n    }\n    return object;\n  }\n\n  function cleanQuery(value) {\n    if (value) {\n      value.formatElapsed = \"\";\n      value.elapsedClassName = \"\";\n      value.query = \"\";\n      value.elapsed = null;\n      value.waiting = null;\n    } else {\n      return {\n        query: \"***\",\n        formatElapsed: \"\",\n        elapsedClassName: \"\"\n      };\n    }\n  }\n\n  function generateRow(object, keepIdentity, counter) {\n    var nbQueries = Math.floor((Math.random() * 10) + 1);\n    if (!object) {\n      object = {};\n    }\n    object.lastMutationId = counter;\n    object.nbQueries = nbQueries;\n    if (!object.lastSample) {\n      object.lastSample = {};\n    }\n    if (!object.lastSample.topFiveQueries) {\n      object.lastSample.topFiveQueries = [];\n    }\n    if (keepIdentity) {\n      // for Angular optimization\n      if (!object.lastSample.queries) {\n        object.lastSample.queries = [];\n        for (var l = 0; l < 12; l++) {\n          object.lastSample.queries[l] = cleanQuery();\n        }\n      }\n      for (var j in object.lastSample.queries) {\n        var value = object.lastSample.queries[j];\n        if (j <= nbQueries) {\n          updateQuery(value);\n        } else {\n          cleanQuery(value);\n        }\n      }\n    } else {\n      object.lastSample.queries = [];\n      for (var j = 0; j < 12; j++) {\n        if (j < nbQueries) {\n          var value = updateQuery(cleanQuery());\n          object.lastSample.queries.push(value);\n        } else {\n          object.lastSample.queries.push(cleanQuery());\n        }\n      }\n    }\n    for (var i = 0; i < 5; i++) {\n      var source = object.lastSample.queries[i];\n      object.lastSample.topFiveQueries[i] = source;\n    }\n    object.lastSample.nbQueries = nbQueries;\n    object.lastSample.countClassName = countClassName(nbQueries);\n    return object;\n  }\n\n  function getData(keepIdentity) {\n    var oldData = data;\n    if (!keepIdentity) { // reset for each tick when !keepIdentity\n      data = [];\n      for (var i = 1; i <= ENV.rows; i++) {\n        data.push({ dbname: 'cluster' + i, query: \"\", formatElapsed: \"\", elapsedClassName: \"\" });\n        data.push({ dbname: 'cluster' + i + ' slave', query: \"\", formatElapsed: \"\", elapsedClassName: \"\" });\n      }\n    }\n    if (!data) { // first init when keepIdentity\n      data = [];\n      for (var i = 1; i <= ENV.rows; i++) {\n        data.push({ dbname: 'cluster' + i });\n        data.push({ dbname: 'cluster' + i + ' slave' });\n      }\n      oldData = data;\n    }\n    for (var i in data) {\n      var row = data[i];\n      if (!keepIdentity && oldData && oldData[i]) {\n        row.lastSample = oldData[i].lastSample;\n      }\n      if (!row.lastSample || Math.random() < ENV.mutations()) {\n        counter = counter + 1;\n        if (!keepIdentity) {\n          row.lastSample = null;\n        }\n        generateRow(row, keepIdentity, counter);\n      } else {\n        data[i] = oldData[i];\n      }\n    }\n    return {\n      toArray: function () {\n        return data;\n      }\n    };\n  }\n\n  var mutationsValue = 0.5;\n\n  function mutations(value) {\n    if (value) {\n      mutationsValue = value;\n      return mutationsValue;\n    } else {\n      return mutationsValue;\n    }\n  }\n\n  var body = document.querySelector('body');\n  var theFirstChild = body.firstChild;\n\n  var sliderContainer = document.createElement('div');\n  sliderContainer.style.cssText = \"display: flex\";\n  var slider = document.createElement('input');\n  var text = document.createElement('label');\n  text.innerHTML = 'mutations : ' + (mutationsValue * 100).toFixed(0) + '%';\n  text.id = \"ratioval\";\n  slider.setAttribute(\"type\", \"range\");\n  slider.style.cssText = 'margin-bottom: 10px; margin-top: 5px';\n  slider.addEventListener('change', function (e) {\n    ENV.mutations(e.target.value / 100);\n    document.querySelector('#ratioval').innerHTML = 'mutations : ' + (ENV.mutations() * 100).toFixed(0) + '%';\n  });\n  sliderContainer.appendChild(text);\n  sliderContainer.appendChild(slider);\n  body.insertBefore(sliderContainer, theFirstChild);\n\n  return {\n    generateData: getData,\n    rows: 50,\n    timeout: 0,\n    mutations: mutations\n  };\n}();"]}