{"version":3,"sources":["../src/lib/directive.ts","../src/lib/dom.ts","../src/lib/part.ts","../src/lib/template.ts","../src/lib/template-instance.ts","../src/lib/template-result.ts","../src/lib/parts.ts","../src/lib/default-template-processor.ts","../src/lib/template-factory.ts","../src/lib/render.ts","src/lit-html.ts","../../lib/haunted-builds/index-w-microtask.js","../router-test/use-disconnected.ts","../router-test/use-trigger-update.ts","../../node_modules/router5/node_modules/symbol-observable/es/ponyfill.js","../../node_modules/router5/node_modules/symbol-observable/es/index.js","../../node_modules/search-params/dist/cjs/index.js","../../node_modules/path-parser/dist/es/path-parser.js","../../node_modules/route-node/dist/es/route-node.js","../../node_modules/router5-transition-path/dist/index.es.js","../../node_modules/router5/dist/index.es.js","../../node_modules/router5-plugin-browser/dist/index.es.js","../router-test/use-router.ts","../router-test/child-one.ts","../router-test/child-two.ts","../router-test/router-test.ts"],"names":["symbolFor","Symbol","for","str","phaseSymbol","hookSymbol","updateSymbol","commitSymbol","effectsSymbol","contextSymbol","contextEvent","current","currentId","setCurrent","element","clear","notify","id","defer","Promise","resolve","then","bind","setTimeout","scheduler","tasks","runTasks","t","i","len","length","task","push","read","write","Container","renderer","frag","host","Map","_updateQueued","result","handlePhase","phase","arg","commit","render","runEffects","args","apply","call","symbol","effects","effect","hooks","forEach","hook","teardown","toCamelCase","val","indexOf","toLowerCase","split","reduce","out","part","charAt","toUpperCase","slice","component","BaseElement","HTMLElement","options","useShadowDOM","Element","observedAttributes","_container","attachShadow","mode","shadowRoot","update","name","_","newValue","Reflect","set","reflectiveProp","initialValue","value","Object","freeze","enumerable","configurable","get","proto","Proxy","prototype","target","key","receiver","desc","writable","defineProperty","setPrototypeOf","Hook","el","use","useMemo","fn","values","hasChanged","some","useCallback","inputs","setEffects","cb","useEffect","callback","lastValues","run","_teardown","useState","updater","makeArgs","updaterFn","previousValue","useReducer","initialState","dispatch","state","reducer","action","DirectiveContainer","virtual","setValue","map","WeakMap","withHooks","factory","cont","setContexts","consumer","useContext","_updater","Context","Error","_subscribe","detail","dispatchEvent","CustomEvent","bubbles","cancelable","composed","unsubscribe","defaultValue","_unsubscribe","createContext","Provider","listeners","eventHandler","event","index","splice","stopPropagation","addEventListener","removeEventListener","_value","Consumer","render$$1","context","symbolObservablePonyfill","root","observable","self","window","global","module","Function","__assign","assign","s","n","arguments","p","hasOwnProperty","defaultOrConstrained","match","replace","rules","pattern","regex","RegExp","tokenise","tokens","matched","rule","type","otherVal","substr","identity","exists","undefined","optTrailingSlash","source","strictTrailingSlash","upToDelimiter","delimiter","test","appendQueryParam","params","param","existingVal","Array","isArray","concat","Path","path","hasUrlParams","filter","hasSpatParam","hasMatrixParams","hasQueryParams","spatParams","getParams","urlParams","queryParams","r","join","createPath","isQueryParam","opts","_this","urlTest","unexpectedQueryParams","keys","partialTest","delimited","build","ignoreConstraints","ignoreSearch","encodedUrlParams","acc","encode","encodeURI","missingParameters","constraintsPassed","every","base","searchParams","sparams","paramName","searchPart","predicate","_a","_b","caseSensitive","m","decodeURIComponent","getMetaFromSegments","segments","accName","meta","segment","parser","allParams","buildStateFromMatch","buildPathFromSegments","queryParamsMode","trailingSlashMode","nonSearchParams","_i","segments_1","extraParams","searchParamsObject","segmentPath","absolute","finalPath","getPathFromSegments","getPath","getSearch","matchChildren","nodes","pathSegment","currentMatch","consumedBefore","_c","strongMatching","_d","isRoot","_loop_1","child","remainingPath","children","consumedPath","querystring","remainingQueryParams_1","getNonAbsoluteChildren","nodes_1","state_1","sortChildren","originalChildren","sort","sortPredicate","left","right","leftPath","rightPath","leftSegments","rightSegments","leftParamsCount","rightParamsCount","leftParamLength","rightParamLength","defaultBuildOptions","defaultMatchOptions","RouteNode","childRoutes","parent","finalSort","checkParents","add","sortDescendants","getParentSegments","reverse","setParent","setPath","route","addRouteNode","routeNode","fullName","addNode","routeName","getSegmentsByName","buildPath","buildState","matchPath","getSegmentsMatchingPath","matchedSegments","firstSegmentParams","lastSegment","lastSegmentSlashChild","findSlashChild","names","hasParentsParams","hasParams","findAbsoluteChildren","absoluteChildren","slashChildren","findSegmentByName","routes","filteredRoutes","topLevelNodes","startingNodes","node","finalMatch","nameToIDs","ids","hasMetaParams","extractSegmentParams","transitionPath","toState","fromState","toStateOptions","fromStateIds","toStateIds","maxI","Math","min","pointOfDifference","leftParams","rightParams","different","reload","toDeactivate","toActivate","intersection","shouldUpdateNode","nodeName","fromSate","toDeactivateReversed","matching","activatedSegment","sameLevelDeactivatedSegment","defaultOptions","autoCleanUp","allowNotFound","rewritePathOnMatch","withOptions","router","routerOptions","getOptions","setOption","option","errorCodes","ROUTER_NOT_STARTED","NO_START_PATH_OR_STATE","ROUTER_ALREADY_STARTED","ROUTE_NOT_FOUND","SAME_STATES","CANNOT_DEACTIVATE","CANNOT_ACTIVATE","TRANSITION_ERR","TRANSITION_CANCELLED","constants","UNKNOWN_ROUTE","ROUTER_START","ROUTER_STOP","TRANSITION_START","TRANSITION_CANCEL","TRANSITION_SUCCESS","TRANSITION_ERROR","withRoutes","forward","fromRoute","toRoute","config","forwardMap","rootNode","onRouteAdded","canActivate","forwardTo","decodeParams","decoders","encodeParams","encoders","defaultParams","canActivateHandler","isActive","strictEquality","ignoreQueryParams","activeState","getState","areStatesEqual","makeState","areStatesDescendants","paramsWithDefault","encodedParams","name_1","decodedParams","forwardState","routeParams","builtPath","setRootPath","rootPath","withDependencies","dependencies","routerDependencies","setDependency","dependencyName","dependency","setDependencies","deps","getDependencies","getInjectables","executeFactory","factoryFunction","withState","stateId","routerState","setState","forceId","makeNotFoundState","state1","state2","getUrlParams","state1Params","state2Params","parentState","childState","eventsMap","onStart","onStop","onTransitionSuccess","onTransitionStart","onTransitionError","onTransitionCancel","withPlugins","routerPlugins","getPlugins","usePlugin","plugins","removePluginFns","plugin","startPlugin","removePlugin","appliedPlugin","removeEventListeners","methodName","Boolean","removeListener","withMiddleware","middlewareFactories","middlewareFunctions","useMiddleware","middlewares","middleware","middlewareFunction","clearMiddleware","getMiddlewareFactories","getMiddlewareFunctions","withObservability","callbacks","invokeEventListeners","eventName","_cb","subscribe","listener","isObject","finalListener","next","unsubscribeHandler","previousRoute","observer","TypeError","$$observable","functions","isCancelled","errorKey","remainingFunctions","isState","obj","hasStateChanged","mergeStates","processFn","stepFn","errBase","_done","done","err","newState","console","error","res","resVal","stack","promiseError","isMapped","transition","cancelled","completed","getLifecycleFunctions","canDeactivateFunctions","canActivateFunctions","cancel","code","activeSegments_1","clearCanDeactivate","makeError","isUnknownRoute","asyncBase","canDeactivate","forceDeactivate","canDeactivateFunctionMap","fnMap","canActivateFunctionMap","pipeline","noop","withNavigation","cancelCurrentTransition","navigate","navigateToDefault","defaultRoute","lastArg","isStarted","sameStates","force","skipTransition","transitionToState","redirect","params_1","redirected","noop$1","withRouterLifecycle","started","start","startPathOrState","startPath","startState","invokeErrCb","navigateToDefault_1","redirect_1","stop","toFunction","withRouteLifecycle","canDeactivateFactories","canActivateFactories","getLifecycleFactories","canDeactivateHandler","pipe","fns","prev","createRouter","cloneRouter","clonedRouter","isBrowser","history","getBase","location","pathname","supportsPopStateOnHashChange","navigator","userAgent","pushState","title","replaceState","addPopstateListener","shouldAddHashChangeListener","useHash","getLocation","hash","hashPrefix","correctedPath","safelyEncodePath","search","decodeURI","getHash","browser","safeBrowser","mergeState","preserveHash","browserPluginFactory","transitionOptions","removePopStateListener","browserPlugin","routerStart","buildUrl","prefix","urlToPath","url","pathParts","matchUrl","replaceHistoryState","lastKnownState","updateBrowserState","trimmedState","finalState","onPopState","evt","historyState","hasState","statesAreEqual"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;AAoBA,MAAM,UAAU,GAAG,IAAI,OAAJ,EAAnB;AAOA;;;;;;;;;;;;;;;;;;;;AAoBA;;AACO,MAAM,SAAS,GAAgC,CAA7B,IACpB,CAAC,GAAG,IAAJ,KAAuB;AACtB,QAAM,CAAC,GAAG,CAAC,CAAC,GAAG,IAAJ,CAAX;AACA,EAAA,UAAU,CAAC,GAAX,CAAe,CAAf,EAAkB,IAAlB;AACA,SAAO,CAAP;AACD,CALE;;;;AAOA,MAAM,WAAW,GAAI,CAAD,IAAiC;AAC1D,SAAO,OAAO,CAAP,KAAa,UAAb,IAA2B,UAAU,CAAC,GAAX,CAAe,CAAf,CAAlC;AACD,CAFM;;;;;;;;;;;ACvDP;;;;;;;;;;;;;;AAsBA;;;AAGO,MAAM,YAAY,GAAG,MAAM,CAAC,cAAP,KAA0B,SAA1B,IACvB,MAAM,CAAC,cAAP,CAA4C,yBAA5C,KACG,SAFD;AAIP;;;;;;;;;AAMO,MAAM,aAAa,GACtB,CAAC,SAAD,EACC,KADD,EAEC,GAAA,GAAiB,IAFlB,EAGC,MAAA,GAAoB,IAHrB,KAGmC;AACjC,MAAI,IAAI,GAAG,KAAX;;AACA,SAAO,IAAI,KAAK,GAAhB,EAAqB;AACnB,UAAM,CAAC,GAAG,IAAK,CAAC,WAAhB;AACA,IAAA,SAAS,CAAC,YAAV,CAAuB,IAAvB,EAA8B,MAA9B;AACA,IAAA,IAAI,GAAG,CAAP;AACD;AACF,CAXE;AAaP;;;;;;;;AAIO,MAAM,WAAW,GACpB,CAAC,SAAD,EAAkB,SAAlB,EAAwC,OAAA,GAAqB,IAA7D,KACW;AACL,MAAI,IAAI,GAAG,SAAX;;AACA,SAAO,IAAI,KAAK,OAAhB,EAAyB;AACvB,UAAM,CAAC,GAAG,IAAK,CAAC,WAAhB;AACA,IAAA,SAAS,CAAC,WAAV,CAAsB,IAAtB;AACA,IAAA,IAAI,GAAG,CAAP;AACD;AACF,CATF;;;;;;;;;;;ACpDP;;;;;;;;;;;;;;AAqCA;;;;AAIO,MAAM,QAAQ,GAAW,EAAzB;AAEP;;;;;AAGO,MAAM,OAAO,GAAG,EAAhB;;;;;;;;;;AC9CP;;;;;;;;;;;;;;AAoBA;;;;AAIO,MAAM,MAAM,GAAG,SAAS,MAAM,CAAC,IAAI,CAAC,MAAL,EAAD,CAAN,CAAsB,KAAtB,CAA4B,CAA5B,CAA8B,IAAtD;AAEP;;;;;;AAIO,MAAM,UAAU,GAAG,OAAO,MAAM,KAAhC;;AAEA,MAAM,WAAW,GAAG,IAAI,MAAJ,CAAW,GAAG,MAAM,IAAI,UAAU,EAAlC,CAApB;AAEP;;;;;AAGO,MAAM,oBAAoB,GAAG,OAA7B;AAEP;;;;;;AAGM,MAAO,QAAP,CAAe;AAInB,EAAA,WAAA,CAAY,MAAZ,EAAoC,OAApC,EAAgE;AAHhE,SAAA,KAAA,GAAwB,EAAxB;AAIE,SAAK,OAAL,GAAe,OAAf;AACA,QAAI,KAAK,GAAG,CAAC,CAAb;AACA,QAAI,SAAS,GAAG,CAAhB;AACA,UAAM,aAAa,GAAW,EAA9B;;AACA,UAAM,gBAAgB,GAAI,QAAD,IAAkC;AACzD,YAAM,OAAO,GAAG,QAAQ,CAAC,OAAzB,CADyD,CAEzD;AACA;;AACA,YAAM,MAAM,GAAG,QAAQ,CAAC,gBAAT,CACX,OADW,EAEX;AAAI;AAFO,QAGX,IAHW,EAIX,KAJW,CAAf,CAJyD,CASzD;AACA;AACA;;AACA,UAAI,aAAa,GAAG,CAApB;;AACA,aAAO,MAAM,CAAC,QAAP,EAAP,EAA0B;AACxB,QAAA,KAAK;AACL,cAAM,IAAI,GAAG,MAAM,CAAC,WAApB;;AACA,YAAI,IAAI,CAAC,QAAL,KAAkB;AAAE;AAAxB,UAAiD;AAC/C,gBAAK,IAAgB,CAAC,aAAjB,EAAL,EAAuC;AACrC,oBAAM,UAAU,GAAI,IAAgB,CAAC,UAArC,CADqC,CAErC;AACA;AACA;AACA;AACA;;AACA,kBAAI,KAAK,GAAG,CAAZ;;AACA,mBAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,UAAU,CAAC,MAA/B,EAAuC,CAAC,EAAxC,EAA4C;AAC1C,oBAAI,UAAU,CAAC,CAAD,CAAV,CAAc,KAAd,CAAoB,OAApB,CAA4B,MAA5B,KAAuC,CAA3C,EAA8C;AAC5C,kBAAA,KAAK;AACN;AACF;;AACD,qBAAO,KAAK,KAAK,CAAjB,EAAoB;AAClB;AACA;AACA,sBAAM,aAAa,GAAG,MAAM,CAAC,OAAP,CAAe,SAAf,CAAtB,CAHkB,CAIlB;;AACA,sBAAM,IAAI,GAAG,sBAAsB,CAAC,IAAvB,CAA4B,aAA5B,EAA4C,CAA5C,CAAb,CALkB,CAMlB;AACA;AACA;AACA;AACA;;AACA,sBAAM,mBAAmB,GACrB,IAAI,CAAC,WAAL,KAAqB,oBADzB;AAEA,sBAAM,cAAc,GACf,IAAgB,CAAC,YAAjB,CAA8B,mBAA9B,CADL;AAEA,sBAAM,OAAO,GAAG,cAAc,CAAC,KAAf,CAAqB,WAArB,CAAhB;AACA,qBAAK,KAAL,CAAW,IAAX,CAAgB;AAAC,kBAAA,IAAI,EAAE,WAAP;AAAoB,kBAAA,KAApB;AAA2B,kBAAA,IAA3B;AAAiC,kBAAA;AAAjC,iBAAhB;AACC,gBAAA,IAAgB,CAAC,eAAjB,CAAiC,mBAAjC;AACD,gBAAA,SAAS,IAAI,OAAO,CAAC,MAAR,GAAiB,CAA9B;AACD;AACF;;AACD,gBAAK,IAAgB,CAAC,OAAjB,KAA6B,UAAlC,EAA8C;AAC5C,cAAA,gBAAgB,CAAC,IAAD,CAAhB;AACD;AACF,WAtCD,MAsCO,IAAI,IAAI,CAAC,QAAL,KAAkB;AAAE;AAAxB,UAA8C;AACnD,kBAAM,IAAI,GAAI,IAAa,CAAC,IAA5B;;AACA,gBAAI,IAAI,CAAC,OAAL,CAAa,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,oBAAM,MAAM,GAAG,IAAI,CAAC,UAApB;AACA,oBAAM,OAAO,GAAG,IAAI,CAAC,KAAL,CAAW,WAAX,CAAhB;AACA,oBAAM,SAAS,GAAG,OAAO,CAAC,MAAR,GAAiB,CAAnC,CAH6B,CAI7B;AACA;;AACA,mBAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,SAApB,EAA+B,CAAC,EAAhC,EAAoC;AAClC,gBAAA,MAAM,CAAC,YAAP,CACK,OAAO,CAAC,CAAD,CAAP,KAAe,EAAhB,GAAsB,YAAY,EAAlC,GACsB,QAAQ,CAAC,cAAT,CAAwB,OAAO,CAAC,CAAD,CAA/B,CAF1B,EAGI,IAHJ;AAIA,qBAAK,KAAL,CAAW,IAAX,CAAgB;AAAC,kBAAA,IAAI,EAAE,MAAP;AAAe,kBAAA,KAAK,EAAE,EAAE;AAAxB,iBAAhB;AACD,eAZ4B,CAa7B;AACA;;;AACA,kBAAI,OAAO,CAAC,SAAD,CAAP,KAAuB,EAA3B,EAA+B;AAC7B,gBAAA,MAAM,CAAC,YAAP,CAAoB,YAAY,EAAhC,EAAoC,IAApC;AACA,gBAAA,aAAa,CAAC,IAAd,CAAmB,IAAnB;AACD,eAHD,MAGO;AACJ,gBAAA,IAAa,CAAC,IAAd,GAAqB,OAAO,CAAC,SAAD,CAA5B;AACF,eApB4B,CAqB7B;;;AACA,cAAA,SAAS,IAAI,SAAb;AACD;AACF,WA1BM,MA0BA,IAAI,IAAI,CAAC,QAAL,KAAkB;AAAE;AAAxB,UAAiD;AACtD,gBAAK,IAAgB,CAAC,IAAjB,KAA0B,MAA/B,EAAuC;AACrC,oBAAM,MAAM,GAAG,IAAI,CAAC,UAApB,CADqC,CAErC;AACA;AACA;AACA;;AACA,kBAAI,IAAI,CAAC,eAAL,KAAyB,IAAzB,IAAiC,KAAK,KAAK,aAA/C,EAA8D;AAC5D,gBAAA,KAAK;AACL,gBAAA,MAAM,CAAC,YAAP,CAAoB,YAAY,EAAhC,EAAoC,IAApC;AACD;;AACD,cAAA,aAAa,GAAG,KAAhB;AACA,mBAAK,KAAL,CAAW,IAAX,CAAgB;AAAC,gBAAA,IAAI,EAAE,MAAP;AAAe,gBAAA;AAAf,eAAhB,EAXqC,CAYrC;AACA;;AACA,kBAAI,IAAI,CAAC,WAAL,KAAqB,IAAzB,EAA+B;AAC5B,gBAAA,IAAgB,CAAC,IAAjB,GAAwB,EAAxB;AACF,eAFD,MAEO;AACL,gBAAA,aAAa,CAAC,IAAd,CAAmB,IAAnB;AACA,gBAAA,KAAK;AACN;;AACD,cAAA,SAAS;AACV,aArBD,MAqBO;AACL,kBAAI,CAAC,GAAG,CAAC,CAAT;;AACA,qBAAO,CAAC,CAAC,GAAI,IAAgB,CAAC,IAAjB,CAAuB,OAAvB,CAA+B,MAA/B,EAAuC,CAAC,GAAG,CAA3C,CAAN,MACA,CAAC,CADR,EACW;AACT;AACA;AACA;AACA;AACA,qBAAK,KAAL,CAAW,IAAX,CAAgB;AAAC,kBAAA,IAAI,EAAE,MAAP;AAAe,kBAAA,KAAK,EAAE,CAAC;AAAvB,iBAAhB;AACD;AACF;AACF;AACF;AACF,KAnHD;;AAoHA,IAAA,gBAAgB,CAAC,OAAD,CAAhB,CAzH8D,CA0H9D;;;AACA,SAAK,MAAM,CAAX,IAAgB,aAAhB,EAA+B;AAC7B,MAAA,CAAC,CAAC,UAAF,CAAc,WAAd,CAA0B,CAA1B;AACD;AACF;;AAlIkB;;;;AA0Jd,MAAM,oBAAoB,GAAI,IAAD,IAAwB,IAAI,CAAC,KAAL,KAAe,CAAC,CAArE,EAEP;AACA;;;;;AACO,MAAM,YAAY,GAAG,MAAM,QAAQ,CAAC,aAAT,CAAuB,EAAvB,CAA3B;AAEP;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBO,MAAM,sBAAsB,GAC/B,4JADG;;;;;;;;;;ACjNP;;AAIA;;AAtBA;;;;;;;;;;;;;;AAcA;;;;AAUA;;;;AAIM,MAAO,gBAAP,CAAuB;AAM3B,EAAA,WAAA,CACI,QADJ,EACwB,SADxB,EAEI,OAFJ,EAE0B;AAP1B,SAAA,MAAA,GAAgC,EAAhC;AAQE,SAAK,QAAL,GAAgB,QAAhB;AACA,SAAK,SAAL,GAAiB,SAAjB;AACA,SAAK,OAAL,GAAe,OAAf;AACD;;AAED,EAAA,MAAM,CAAC,MAAD,EAAkB;AACtB,QAAI,CAAC,GAAG,CAAR;;AACA,SAAK,MAAM,IAAX,IAAmB,KAAK,MAAxB,EAAgC;AAC9B,UAAI,IAAI,KAAK,SAAb,EAAwB;AACtB,QAAA,IAAI,CAAC,QAAL,CAAc,MAAM,CAAC,CAAD,CAApB;AACD;;AACD,MAAA,CAAC;AACF;;AACD,SAAK,MAAM,IAAX,IAAmB,KAAK,MAAxB,EAAgC;AAC9B,UAAI,IAAI,KAAK,SAAb,EAAwB;AACtB,QAAA,IAAI,CAAC,MAAL;AACD;AACF;AACF;;AAED,EAAA,MAAM,GAAA;AACJ;AACA;AACA;AACA;AACA;AACA,UAAM,QAAQ,GAAG,oBACb,KAAK,QAAL,CAAc,OAAd,CAAsB,OAAtB,CAA8B,SAA9B,CAAwC,IAAxC,CADa,GAEb,QAAQ,CAAC,UAAT,CAAoB,KAAK,QAAL,CAAc,OAAd,CAAsB,OAA1C,EAAmD,IAAnD,CAFJ;AAIA,UAAM,KAAK,GAAG,KAAK,QAAL,CAAc,KAA5B;AACA,QAAI,SAAS,GAAG,CAAhB;AACA,QAAI,SAAS,GAAG,CAAhB;;AACA,UAAM,gBAAgB,GAAI,QAAD,IAA+B;AACtD;AACA;AACA,YAAM,MAAM,GAAG,QAAQ,CAAC,gBAAT,CACX,QADW,EAEX;AAAI;AAFO,QAGX,IAHW,EAIX,KAJW,CAAf;AAKA,UAAI,IAAI,GAAG,MAAM,CAAC,QAAP,EAAX,CARsD,CAStD;;AACA,aAAO,SAAS,GAAG,KAAK,CAAC,MAAlB,IAA4B,IAAI,KAAK,IAA5C,EAAkD;AAChD,cAAM,IAAI,GAAG,KAAK,CAAC,SAAD,CAAlB,CADgD,CAEhD;AACA;AACA;AACA;AACA;AACA;;AACA,YAAI,CAAC,oCAAqB,IAArB,CAAL,EAAiC;AAC/B,eAAK,MAAL,CAAY,IAAZ,CAAiB,SAAjB;;AACA,UAAA,SAAS;AACV,SAHD,MAGO,IAAI,SAAS,KAAK,IAAI,CAAC,KAAvB,EAA8B;AACnC,cAAI,IAAI,CAAC,IAAL,KAAc,MAAlB,EAA0B;AACxB,kBAAM,IAAI,GAAG,KAAK,SAAL,CAAe,oBAAf,CAAoC,KAAK,OAAzC,CAAb;AACA,YAAA,IAAI,CAAC,eAAL,CAAqB,IAAI,CAAC,eAA1B;;AACA,iBAAK,MAAL,CAAY,IAAZ,CAAiB,IAAjB;AACD,WAJD,MAIO;AACL,iBAAK,MAAL,CAAY,IAAZ,CAAiB,GAAG,KAAK,SAAL,CAAe,0BAAf,CAChB,IADgB,EACC,IAAI,CAAC,IADN,EACY,IAAI,CAAC,OADjB,EAC0B,KAAK,OAD/B,CAApB;AAED;;AACD,UAAA,SAAS;AACV,SAVM,MAUA;AACL,UAAA,SAAS;;AACT,cAAI,IAAI,CAAC,QAAL,KAAkB,UAAtB,EAAkC;AAChC,YAAA,gBAAgB,CAAE,IAA4B,CAAC,OAA/B,CAAhB;AACD;;AACD,UAAA,IAAI,GAAG,MAAM,CAAC,QAAP,EAAP;AACD;AACF;AACF,KAvCD;;AAwCA,IAAA,gBAAgB,CAAC,QAAD,CAAhB;;AACA,QAAI,iBAAJ,EAAkB;AAChB,MAAA,QAAQ,CAAC,SAAT,CAAmB,QAAnB;AACA,MAAA,cAAc,CAAC,OAAf,CAAuB,QAAvB;AACD;;AACD,WAAO,QAAP;AACD;;AAxF0B;;;;;;;;;;;ACV7B;;AAEA;;AApBA;;;;;;;;;;;;;;AAcA;;;;AAQA;;;;AAIM,MAAO,cAAP,CAAqB;AAMzB,EAAA,WAAA,CACI,OADJ,EACmC,MADnC,EACsD,IADtD,EAEI,SAFJ,EAEgC;AAC9B,SAAK,OAAL,GAAe,OAAf;AACA,SAAK,MAAL,GAAc,MAAd;AACA,SAAK,IAAL,GAAY,IAAZ;AACA,SAAK,SAAL,GAAiB,SAAjB;AACD;AAED;;;;;AAGA,EAAA,OAAO,GAAA;AACL,UAAM,QAAQ,GAAG,KAAK,OAAL,CAAa,MAAb,GAAsB,CAAvC;AACA,QAAI,IAAI,GAAG,EAAX;;AACA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,QAApB,EAA8B,CAAC,EAA/B,EAAmC;AACjC,YAAM,CAAC,GAAG,KAAK,OAAL,CAAa,CAAb,CAAV,CADiC,CAEjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,YAAM,KAAK,GAAG,iCAAuB,IAAvB,CAA4B,CAA5B,CAAd;;AACA,UAAI,KAAJ,EAAW;AACT;AACA;AACA;AACA,QAAA,IAAI,IAAI,CAAC,CAAC,MAAF,CAAS,CAAT,EAAY,KAAK,CAAC,KAAlB,IAA2B,KAAK,CAAC,CAAD,CAAhC,GAAsC,KAAK,CAAC,CAAD,CAA3C,GACJ,8BADI,GACmB,KAAK,CAAC,CAAD,CADxB,GAC8B,gBADtC;AAED,OAND,MAMO;AACL;AACA;AACA,QAAA,IAAI,IAAI,CAAC,GAAG,oBAAZ;AACD;AACF;;AACD,WAAO,IAAI,GAAG,KAAK,OAAL,CAAa,QAAb,CAAd;AACD;;AAED,EAAA,kBAAkB,GAAA;AAChB,UAAM,QAAQ,GAAG,QAAQ,CAAC,aAAT,CAAuB,UAAvB,CAAjB;AACA,IAAA,QAAQ,CAAC,SAAT,GAAqB,KAAK,OAAL,EAArB;AACA,WAAO,QAAP;AACD;;AApDwB;AAuD3B;;;;;;;;;;;AAOM,MAAO,iBAAP,SAAiC,cAAjC,CAA+C;AACnD,EAAA,OAAO,GAAA;AACL,WAAO,QAAQ,MAAM,OAAN,EAAe,QAA9B;AACD;;AAED,EAAA,kBAAkB,GAAA;AAChB,UAAM,QAAQ,GAAG,MAAM,kBAAN,EAAjB;AACA,UAAM,OAAO,GAAG,QAAQ,CAAC,OAAzB;AACA,UAAM,UAAU,GAAG,OAAO,CAAC,UAA3B;AACA,IAAA,OAAO,CAAC,WAAR,CAAoB,UAApB;AACA,4BAAc,OAAd,EAAuB,UAAU,CAAC,UAAlC;AACA,WAAO,QAAP;AACD;;AAZkD;;;;;;;;;;;ACtErD;;AACA;;AACA;;AAEA;;AACA;;AACA;;AAxBA;;;;;;;;;;;;;;AAcA;;;AAcO,MAAM,WAAW,GAAI,KAAD,IAAuC;AAChE,SACI,KAAK,KAAK,IAAV,IACA,EAAE,OAAO,KAAP,KAAiB,QAAjB,IAA6B,OAAO,KAAP,KAAiB,UAAhD,CAFJ;AAGD,CAJM;AAMP;;;;;;;;AAIM,MAAO,kBAAP,CAAyB;AAO7B,EAAA,WAAA,CAAY,OAAZ,EAA8B,IAA9B,EAA4C,OAA5C,EAA6D;AAF7D,SAAA,KAAA,GAAQ,IAAR;AAGE,SAAK,OAAL,GAAe,OAAf;AACA,SAAK,IAAL,GAAY,IAAZ;AACA,SAAK,OAAL,GAAe,OAAf;AACA,SAAK,KAAL,GAAa,EAAb;;AACA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,OAAO,CAAC,MAAR,GAAiB,CAArC,EAAwC,CAAC,EAAzC,EAA6C;AAC3C,WAAK,KAAL,CAAW,CAAX,IAAgB,KAAK,WAAL,EAAhB;AACD;AACF;AAED;;;;;AAGU,EAAA,WAAW,GAAA;AACnB,WAAO,IAAI,aAAJ,CAAkB,IAAlB,CAAP;AACD;;AAES,EAAA,SAAS,GAAA;AACjB,UAAM,OAAO,GAAG,KAAK,OAArB;AACA,UAAM,CAAC,GAAG,OAAO,CAAC,MAAR,GAAiB,CAA3B;AACA,QAAI,IAAI,GAAG,EAAX;;AAEA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,CAApB,EAAuB,CAAC,EAAxB,EAA4B;AAC1B,MAAA,IAAI,IAAI,OAAO,CAAC,CAAD,CAAf;AACA,YAAM,IAAI,GAAG,KAAK,KAAL,CAAW,CAAX,CAAb;;AACA,UAAI,IAAI,KAAK,SAAb,EAAwB;AACtB,cAAM,CAAC,GAAG,IAAI,CAAC,KAAf;;AACA,YAAI,CAAC,IAAI,IAAL,KACC,KAAK,CAAC,OAAN,CAAc,CAAd,KACA;AACA,eAAO,CAAP,KAAa,QAAb,IAA0B,CAAS,CAAC,MAAM,CAAC,QAAR,CAHpC,CAAJ,EAG4D;AAC1D,eAAK,MAAM,CAAX,IAAgB,CAAhB,EAAwC;AACtC,YAAA,IAAI,IAAI,OAAO,CAAP,KAAa,QAAb,GAAwB,CAAxB,GAA4B,MAAM,CAAC,CAAD,CAA1C;AACD;AACF,SAPD,MAOO;AACL,UAAA,IAAI,IAAI,OAAO,CAAP,KAAa,QAAb,GAAwB,CAAxB,GAA4B,MAAM,CAAC,CAAD,CAA1C;AACD;AACF;AACF;;AAED,IAAA,IAAI,IAAI,OAAO,CAAC,CAAD,CAAf;AACA,WAAO,IAAP;AACD;;AAED,EAAA,MAAM,GAAA;AACJ,QAAI,KAAK,KAAT,EAAgB;AACd,WAAK,KAAL,GAAa,KAAb;AACA,WAAK,OAAL,CAAa,YAAb,CAA0B,KAAK,IAA/B,EAAqC,KAAK,SAAL,EAArC;AACD;AACF;;AAxD4B;;;;AA2DzB,MAAO,aAAP,CAAoB;AAIxB,EAAA,WAAA,CAAY,QAAZ,EAAwC;AAFxC,SAAA,KAAA,GAAiB,SAAjB;AAGE,SAAK,SAAL,GAAiB,QAAjB;AACD;;AAED,EAAA,QAAQ,CAAC,KAAD,EAAe;AACrB,QAAI,KAAK,KAAK,cAAV,KAAuB,CAAC,WAAW,CAAC,KAAD,CAAZ,IAAuB,KAAK,KAAK,KAAK,KAA7D,CAAJ,EAAyE;AACvE,WAAK,KAAL,GAAa,KAAb,CADuE,CAEvE;AACA;AACA;;AACA,UAAI,CAAC,4BAAY,KAAZ,CAAL,EAAyB;AACvB,aAAK,SAAL,CAAe,KAAf,GAAuB,IAAvB;AACD;AACF;AACF;;AAED,EAAA,MAAM,GAAA;AACJ,WAAO,4BAAY,KAAK,KAAjB,CAAP,EAAgC;AAC9B,YAAM,SAAS,GAAG,KAAK,KAAvB;AACA,WAAK,KAAL,GAAa,cAAb;AACA,MAAA,SAAS,CAAC,IAAD,CAAT;AACD;;AACD,QAAI,KAAK,KAAL,KAAe,cAAnB,EAA6B;AAC3B;AACD;;AACD,SAAK,SAAL,CAAe,MAAf;AACD;;AA9BuB;;;;AAiCpB,MAAO,QAAP,CAAe;AAOnB,EAAA,WAAA,CAAY,OAAZ,EAAkC;AAHlC,SAAA,KAAA,GAAiB,SAAjB;AACA,SAAA,aAAA,GAAyB,SAAzB;AAGE,SAAK,OAAL,GAAe,OAAf;AACD;AAED;;;;;;;AAKA,EAAA,UAAU,CAAC,SAAD,EAAgB;AACxB,SAAK,SAAL,GAAiB,SAAS,CAAC,WAAV,CAAsB,6BAAtB,CAAjB;AACA,SAAK,OAAL,GAAe,SAAS,CAAC,WAAV,CAAsB,6BAAtB,CAAf;AACD;AAED;;;;;;;;;AAOA,EAAA,eAAe,CAAC,GAAD,EAAU;AACvB,SAAK,SAAL,GAAiB,GAAjB;AACA,SAAK,OAAL,GAAe,GAAG,CAAC,WAAnB;AACD;AAED;;;;;;;AAKA,EAAA,cAAc,CAAC,IAAD,EAAe;AAC3B,IAAA,IAAI,CAAC,OAAL,CAAa,KAAK,SAAL,GAAiB,6BAA9B;;AACA,IAAA,IAAI,CAAC,OAAL,CAAa,KAAK,OAAL,GAAe,6BAA5B;AACD;AAED;;;;;;;AAKA,EAAA,eAAe,CAAC,GAAD,EAAc;AAC3B,IAAA,GAAG,CAAC,OAAJ,CAAY,KAAK,SAAL,GAAiB,6BAA7B;;AACA,SAAK,OAAL,GAAe,GAAG,CAAC,OAAnB;AACA,IAAA,GAAG,CAAC,OAAJ,GAAc,KAAK,SAAnB;AACD;;AAED,EAAA,QAAQ,CAAC,KAAD,EAAe;AACrB,SAAK,aAAL,GAAqB,KAArB;AACD;;AAED,EAAA,MAAM,GAAA;AACJ,WAAO,4BAAY,KAAK,aAAjB,CAAP,EAAwC;AACtC,YAAM,SAAS,GAAG,KAAK,aAAvB;AACA,WAAK,aAAL,GAAqB,cAArB;AACA,MAAA,SAAS,CAAC,IAAD,CAAT;AACD;;AACD,UAAM,KAAK,GAAG,KAAK,aAAnB;;AACA,QAAI,KAAK,KAAK,cAAd,EAAwB;AACtB;AACD;;AACD,QAAI,WAAW,CAAC,KAAD,CAAf,EAAwB;AACtB,UAAI,KAAK,KAAK,KAAK,KAAnB,EAA0B;AACxB,aAAK,WAAL,CAAiB,KAAjB;AACD;AACF,KAJD,MAIO,IAAI,KAAK,YAAY,8BAArB,EAAqC;AAC1C,WAAK,qBAAL,CAA2B,KAA3B;AACD,KAFM,MAEA,IAAI,KAAK,YAAY,IAArB,EAA2B;AAChC,WAAK,WAAL,CAAiB,KAAjB;AACD,KAFM,MAEA,IACH,KAAK,CAAC,OAAN,CAAc,KAAd,KACA;AACC,IAAA,KAAa,CAAC,MAAM,CAAC,QAAR,CAHX,EAG8B;AACnC,WAAK,eAAL,CAAqB,KAArB;AACD,KALM,MAKA,IAAI,KAAK,KAAK,aAAd,EAAuB;AAC5B,WAAK,KAAL,GAAa,aAAb;AACA,WAAK,KAAL;AACD,KAHM,MAGA;AACL;AACA,WAAK,WAAL,CAAiB,KAAjB;AACD;AACF;;AAEO,EAAA,OAAO,CAAC,IAAD,EAAW;AACxB,SAAK,OAAL,CAAa,UAAb,CAAyB,YAAzB,CAAsC,IAAtC,EAA4C,KAAK,OAAjD;AACD;;AAEO,EAAA,WAAW,CAAC,KAAD,EAAY;AAC7B,QAAI,KAAK,KAAL,KAAe,KAAnB,EAA0B;AACxB;AACD;;AACD,SAAK,KAAL;;AACA,SAAK,OAAL,CAAa,KAAb;;AACA,SAAK,KAAL,GAAa,KAAb;AACD;;AAEO,EAAA,WAAW,CAAC,KAAD,EAAe;AAChC,UAAM,IAAI,GAAG,KAAK,SAAL,CAAe,WAA5B;AACA,IAAA,KAAK,GAAG,KAAK,IAAI,IAAT,GAAgB,EAAhB,GAAqB,KAA7B;;AACA,QAAI,IAAI,KAAK,KAAK,OAAL,CAAa,eAAtB,IACA,IAAI,CAAC,QAAL,KAAkB;AAAE;AADxB,MAC8C;AAC5C;AACA;AACA;AACC,QAAA,IAAa,CAAC,IAAd,GAAqB,KAArB;AACF,OAND,MAMO;AACL,WAAK,WAAL,CAAiB,QAAQ,CAAC,cAAT,CACb,OAAO,KAAP,KAAiB,QAAjB,GAA4B,KAA5B,GAAoC,MAAM,CAAC,KAAD,CAD7B,CAAjB;AAED;;AACD,SAAK,KAAL,GAAa,KAAb;AACD;;AAEO,EAAA,qBAAqB,CAAC,KAAD,EAAsB;AACjD,UAAM,QAAQ,GAAG,KAAK,OAAL,CAAa,eAAb,CAA6B,KAA7B,CAAjB;;AACA,QAAI,KAAK,KAAL,YAAsB,kCAAtB,IACA,KAAK,KAAL,CAAW,QAAX,KAAwB,QAD5B,EACsC;AACpC,WAAK,KAAL,CAAW,MAAX,CAAkB,KAAK,CAAC,MAAxB;AACD,KAHD,MAGO;AACL;AACA;AACA;AACA;AACA,YAAM,QAAQ,GACV,IAAI,kCAAJ,CAAqB,QAArB,EAA+B,KAAK,CAAC,SAArC,EAAgD,KAAK,OAArD,CADJ;;AAEA,YAAM,QAAQ,GAAG,QAAQ,CAAC,MAAT,EAAjB;;AACA,MAAA,QAAQ,CAAC,MAAT,CAAgB,KAAK,CAAC,MAAtB;;AACA,WAAK,WAAL,CAAiB,QAAjB;;AACA,WAAK,KAAL,GAAa,QAAb;AACD;AACF;;AAEO,EAAA,eAAe,CAAC,KAAD,EAAyB;AAC9C;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA,QAAI,CAAC,KAAK,CAAC,OAAN,CAAc,KAAK,KAAnB,CAAL,EAAgC;AAC9B,WAAK,KAAL,GAAa,EAAb;AACA,WAAK,KAAL;AACD,KAd6C,CAgB9C;AACA;;;AACA,UAAM,SAAS,GAAG,KAAK,KAAvB;AACA,QAAI,SAAS,GAAG,CAAhB;AACA,QAAI,QAAJ;;AAEA,SAAK,MAAM,IAAX,IAAmB,KAAnB,EAA0B;AACxB;AACA,MAAA,QAAQ,GAAG,SAAS,CAAC,SAAD,CAApB,CAFwB,CAIxB;;AACA,UAAI,QAAQ,KAAK,SAAjB,EAA4B;AAC1B,QAAA,QAAQ,GAAG,IAAI,QAAJ,CAAa,KAAK,OAAlB,CAAX;AACA,QAAA,SAAS,CAAC,IAAV,CAAe,QAAf;;AACA,YAAI,SAAS,KAAK,CAAlB,EAAqB;AACnB,UAAA,QAAQ,CAAC,cAAT,CAAwB,IAAxB;AACD,SAFD,MAEO;AACL,UAAA,QAAQ,CAAC,eAAT,CAAyB,SAAS,CAAC,SAAS,GAAG,CAAb,CAAlC;AACD;AACF;;AACD,MAAA,QAAQ,CAAC,QAAT,CAAkB,IAAlB;AACA,MAAA,QAAQ,CAAC,MAAT;AACA,MAAA,SAAS;AACV;;AAED,QAAI,SAAS,GAAG,SAAS,CAAC,MAA1B,EAAkC;AAChC;AACA,MAAA,SAAS,CAAC,MAAV,GAAmB,SAAnB;AACA,WAAK,KAAL,CAAW,QAAQ,IAAI,QAAS,CAAC,OAAjC;AACD;AACF;;AAED,EAAA,KAAK,CAAC,SAAA,GAAkB,KAAK,SAAxB,EAAiC;AACpC,0BACI,KAAK,SAAL,CAAe,UADnB,EACgC,SAAS,CAAC,WAD1C,EACwD,KAAK,OAD7D;AAED;;AA7LkB;AAgMrB;;;;;;;;;;;AAOM,MAAO,oBAAP,CAA2B;AAO/B,EAAA,WAAA,CAAY,OAAZ,EAA8B,IAA9B,EAA4C,OAA5C,EAA6D;AAH7D,SAAA,KAAA,GAAiB,SAAjB;AACA,SAAA,aAAA,GAAyB,SAAzB;;AAGE,QAAI,OAAO,CAAC,MAAR,KAAmB,CAAnB,IAAwB,OAAO,CAAC,CAAD,CAAP,KAAe,EAAvC,IAA6C,OAAO,CAAC,CAAD,CAAP,KAAe,EAAhE,EAAoE;AAClE,YAAM,IAAI,KAAJ,CACF,yDADE,CAAN;AAED;;AACD,SAAK,OAAL,GAAe,OAAf;AACA,SAAK,IAAL,GAAY,IAAZ;AACA,SAAK,OAAL,GAAe,OAAf;AACD;;AAED,EAAA,QAAQ,CAAC,KAAD,EAAe;AACrB,SAAK,aAAL,GAAqB,KAArB;AACD;;AAED,EAAA,MAAM,GAAA;AACJ,WAAO,4BAAY,KAAK,aAAjB,CAAP,EAAwC;AACtC,YAAM,SAAS,GAAG,KAAK,aAAvB;AACA,WAAK,aAAL,GAAqB,cAArB;AACA,MAAA,SAAS,CAAC,IAAD,CAAT;AACD;;AACD,QAAI,KAAK,aAAL,KAAuB,cAA3B,EAAqC;AACnC;AACD;;AACD,UAAM,KAAK,GAAG,CAAC,CAAC,KAAK,aAArB;;AACA,QAAI,KAAK,KAAL,KAAe,KAAnB,EAA0B;AACxB,UAAI,KAAJ,EAAW;AACT,aAAK,OAAL,CAAa,YAAb,CAA0B,KAAK,IAA/B,EAAqC,EAArC;AACD,OAFD,MAEO;AACL,aAAK,OAAL,CAAa,eAAb,CAA6B,KAAK,IAAlC;AACD;AACF;;AACD,SAAK,KAAL,GAAa,KAAb;AACA,SAAK,aAAL,GAAqB,cAArB;AACD;;AAxC8B;AA2CjC;;;;;;;;;;;;;AASM,MAAO,iBAAP,SAAiC,kBAAjC,CAAmD;AAGvD,EAAA,WAAA,CAAY,OAAZ,EAA8B,IAA9B,EAA4C,OAA5C,EAA6D;AAC3D,UAAM,OAAN,EAAe,IAAf,EAAqB,OAArB;AACA,SAAK,MAAL,GACK,OAAO,CAAC,MAAR,KAAmB,CAAnB,IAAwB,OAAO,CAAC,CAAD,CAAP,KAAe,EAAvC,IAA6C,OAAO,CAAC,CAAD,CAAP,KAAe,EADjE;AAED;;AAES,EAAA,WAAW,GAAA;AACnB,WAAO,IAAI,YAAJ,CAAiB,IAAjB,CAAP;AACD;;AAED,EAAA,SAAS,GAAA;AACP,QAAI,KAAK,MAAT,EAAiB;AACf,aAAO,KAAK,KAAL,CAAW,CAAX,EAAc,KAArB;AACD;;AACD,WAAO,MAAM,SAAN,EAAP;AACD;;AAED,EAAA,MAAM,GAAA;AACJ,QAAI,KAAK,KAAT,EAAgB;AACd,WAAK,KAAL,GAAa,KAAb,CADc,CAEd;;AACC,WAAK,OAAL,CAAqB,KAAK,IAA1B,IAAkC,KAAK,SAAL,EAAlC;AACF;AACF;;AA1BsD;;;;AA6BnD,MAAO,YAAP,SAA4B,aAA5B,CAAyC,GAE/C;AACA;AACA;AACA;;;;AACA,IAAI,qBAAqB,GAAG,KAA5B;;AAEA,IAAI;AACF,QAAM,OAAO,GAAG;AACd,QAAI,OAAJ,GAAW;AACT,MAAA,qBAAqB,GAAG,IAAxB;AACA,aAAO,KAAP;AACD;;AAJa,GAAhB,CADE,CAOF;;AACA,EAAA,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,OAAhC,EAAgD,OAAhD,EARE,CASF;;AACA,EAAA,MAAM,CAAC,mBAAP,CAA2B,MAA3B,EAAmC,OAAnC,EAAmD,OAAnD;AACD,CAXD,CAWE,OAAO,EAAP,EAAW,CACZ;;AAKK,MAAO,SAAP,CAAgB;AASpB,EAAA,WAAA,CAAY,OAAZ,EAA8B,SAA9B,EAAiD,YAAjD,EAA2E;AAL3E,SAAA,KAAA,GAA2C,SAA3C;AAEA,SAAA,aAAA,GAAmD,SAAnD;AAIE,SAAK,OAAL,GAAe,OAAf;AACA,SAAK,SAAL,GAAiB,SAAjB;AACA,SAAK,YAAL,GAAoB,YAApB;;AACA,SAAK,iBAAL,GAA0B,CAAD,IAAO,KAAK,WAAL,CAAiB,CAAjB,CAAhC;AACD;;AAED,EAAA,QAAQ,CAAC,KAAD,EAAyC;AAC/C,SAAK,aAAL,GAAqB,KAArB;AACD;;AAED,EAAA,MAAM,GAAA;AACJ,WAAO,4BAAY,KAAK,aAAjB,CAAP,EAAwC;AACtC,YAAM,SAAS,GAAG,KAAK,aAAvB;AACA,WAAK,aAAL,GAAqB,cAArB;AACA,MAAA,SAAS,CAAC,IAAD,CAAT;AACD;;AACD,QAAI,KAAK,aAAL,KAAuB,cAA3B,EAAqC;AACnC;AACD;;AAED,UAAM,WAAW,GAAG,KAAK,aAAzB;AACA,UAAM,WAAW,GAAG,KAAK,KAAzB;AACA,UAAM,oBAAoB,GAAG,WAAW,IAAI,IAAf,IACzB,WAAW,IAAI,IAAf,KACK,WAAW,CAAC,OAAZ,KAAwB,WAAW,CAAC,OAApC,IACA,WAAW,CAAC,IAAZ,KAAqB,WAAW,CAAC,IADjC,IAEA,WAAW,CAAC,OAAZ,KAAwB,WAAW,CAAC,OAHzC,CADJ;AAKA,UAAM,iBAAiB,GACnB,WAAW,IAAI,IAAf,KAAwB,WAAW,IAAI,IAAf,IAAuB,oBAA/C,CADJ;;AAGA,QAAI,oBAAJ,EAA0B;AACxB,WAAK,OAAL,CAAa,mBAAb,CACI,KAAK,SADT,EACoB,KAAK,iBADzB,EAC4C,KAAK,QADjD;AAED;;AACD,QAAI,iBAAJ,EAAuB;AACrB,WAAK,QAAL,GAAgB,UAAU,CAAC,WAAD,CAA1B;AACA,WAAK,OAAL,CAAa,gBAAb,CACI,KAAK,SADT,EACoB,KAAK,iBADzB,EAC4C,KAAK,QADjD;AAED;;AACD,SAAK,KAAL,GAAa,WAAb;AACA,SAAK,aAAL,GAAqB,cAArB;AACD;;AAED,EAAA,WAAW,CAAC,KAAD,EAAa;AACtB,QAAI,OAAO,KAAK,KAAZ,KAAsB,UAA1B,EAAsC;AACpC,WAAK,KAAL,CAAW,IAAX,CAAgB,KAAK,YAAL,IAAqB,KAAK,OAA1C,EAAmD,KAAnD;AACD,KAFD,MAEO;AACJ,WAAK,KAAL,CAAmC,WAAnC,CAA+C,KAA/C;AACF;AACF;;AA3DmB,EA8DtB;AACA;AACA;;;;;AACA,MAAM,UAAU,GAAI,CAAD,IAA0C,CAAC,KACzD,qBAAqB,GACjB;AAAC,EAAA,OAAO,EAAE,CAAC,CAAC,OAAZ;AAAqB,EAAA,OAAO,EAAE,CAAC,CAAC,OAAhC;AAAyC,EAAA,IAAI,EAAE,CAAC,CAAC;AAAjD,CADiB,GAEjB,CAAC,CAAC,OAHmD,CAA9D;;;;;;;;;ACjeA;;AAnBA;;;;;;;;;;;;;;AAuBA;;;AAGM,MAAO,wBAAP,CAA+B;AACnC;;;;;;;;;AASA,EAAA,0BAA0B,CACtB,OADsB,EACJ,IADI,EACU,OADV,EAEtB,OAFsB,EAEA;AACxB,UAAM,MAAM,GAAG,IAAI,CAAC,CAAD,CAAnB;;AACA,QAAI,MAAM,KAAK,GAAf,EAAoB;AAClB,YAAM,QAAQ,GAAG,IAAI,wBAAJ,CAAsB,OAAtB,EAA+B,IAAI,CAAC,KAAL,CAAW,CAAX,CAA/B,EAA8C,OAA9C,CAAjB;AACA,aAAO,QAAQ,CAAC,KAAhB;AACD;;AACD,QAAI,MAAM,KAAK,GAAf,EAAoB;AAClB,aAAO,CAAC,IAAI,gBAAJ,CAAc,OAAd,EAAuB,IAAI,CAAC,KAAL,CAAW,CAAX,CAAvB,EAAsC,OAAO,CAAC,YAA9C,CAAD,CAAP;AACD;;AACD,QAAI,MAAM,KAAK,GAAf,EAAoB;AAClB,aAAO,CAAC,IAAI,2BAAJ,CAAyB,OAAzB,EAAkC,IAAI,CAAC,KAAL,CAAW,CAAX,CAAlC,EAAiD,OAAjD,CAAD,CAAP;AACD;;AACD,UAAM,QAAQ,GAAG,IAAI,yBAAJ,CAAuB,OAAvB,EAAgC,IAAhC,EAAsC,OAAtC,CAAjB;AACA,WAAO,QAAQ,CAAC,KAAhB;AACD;AACD;;;;;;AAIA,EAAA,oBAAoB,CAAC,OAAD,EAAuB;AACzC,WAAO,IAAI,eAAJ,CAAa,OAAb,CAAP;AACD;;AAjCkC;;;AAoC9B,MAAM,wBAAwB,GAAG,IAAI,wBAAJ,EAAjC;;;;;;;;;;;AC3CP;;AAnBA;;;;;;;;;;;;;;AA2CA;;;;AAIM,SAAU,eAAV,CAA0B,MAA1B,EAAgD;AACpD,MAAI,aAAa,GAAG,cAAc,CAAC,GAAf,CAAmB,MAAM,CAAC,IAA1B,CAApB;;AACA,MAAI,aAAa,KAAK,SAAtB,EAAiC;AAC/B,IAAA,aAAa,GAAG;AACd,MAAA,YAAY,EAAE,IAAI,OAAJ,EADA;AAEd,MAAA,SAAS,EAAE,IAAI,GAAJ;AAFG,KAAhB;AAIA,IAAA,cAAc,CAAC,GAAf,CAAmB,MAAM,CAAC,IAA1B,EAAgC,aAAhC;AACD;;AAED,MAAI,QAAQ,GAAG,aAAa,CAAC,YAAd,CAA2B,GAA3B,CAA+B,MAAM,CAAC,OAAtC,CAAf;;AACA,MAAI,QAAQ,KAAK,SAAjB,EAA4B;AAC1B,WAAO,QAAP;AACD,GAbmD,CAepD;AACA;;;AACA,QAAM,GAAG,GAAG,MAAM,CAAC,OAAP,CAAe,IAAf,CAAoB,gBAApB,CAAZ,CAjBoD,CAmBpD;;AACA,EAAA,QAAQ,GAAG,aAAa,CAAC,SAAd,CAAwB,GAAxB,CAA4B,GAA5B,CAAX;;AACA,MAAI,QAAQ,KAAK,SAAjB,EAA4B;AAC1B;AACA,IAAA,QAAQ,GAAG,IAAI,kBAAJ,CAAa,MAAb,EAAqB,MAAM,CAAC,kBAAP,EAArB,CAAX,CAF0B,CAG1B;;AACA,IAAA,aAAa,CAAC,SAAd,CAAwB,GAAxB,CAA4B,GAA5B,EAAiC,QAAjC;AACD,GA1BmD,CA4BpD;;;AACA,EAAA,aAAa,CAAC,YAAd,CAA2B,GAA3B,CAA+B,MAAM,CAAC,OAAtC,EAA+C,QAA/C;AACA,SAAO,QAAP;AACD;;AAiBM,MAAM,cAAc,GAAG,IAAI,GAAJ,EAAvB;;;;;;;;;;AC7EP;;AACA;;AAEA;;AArBA;;;;;;;;;;;;;;AAcA;;;AAUO,MAAM,KAAK,GAAG,IAAI,OAAJ,EAAd;AAEP;;;;;;;;;;;;;;;;;;AAeO,MAAM,MAAM,GACf,CAAC,MAAD,EACC,SADD,EAEC,OAFD,KAEqC;AACnC,MAAI,IAAI,GAAG,KAAK,CAAC,GAAN,CAAU,SAAV,CAAX;;AACA,MAAI,IAAI,KAAK,SAAb,EAAwB;AACtB,0BAAY,SAAZ,EAAuB,SAAS,CAAC,UAAjC;AACA,IAAA,KAAK,CAAC,GAAN,CAAU,SAAV,EAAqB,IAAI,GAAG,IAAI,eAAJ,CAAY,MAAA,CAAA,MAAA,CAAA;AACjB,MAAA,eAAe,EAAf;AADiB,KAAA,EAEd,OAFc,CAAZ,CAA5B;AAIA,IAAA,IAAI,CAAC,UAAL,CAAgB,SAAhB;AACD;;AACD,EAAA,IAAI,CAAC,QAAL,CAAc,MAAd;AACA,EAAA,IAAI,CAAC,MAAL;AACD,CAfE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACTP;;AACA;;AAGA;;AAEA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AAGA;;AA/CA;;;;;;;;;;;;;;AAcA;;;;;;;;;;;;;;AAcA;;;;AASA;AAkBA;AACA;AACA;AACA,CAAC,MAAM,CAAC,iBAAD,CAAN,KAA8B,MAAM,CAAC,iBAAD,CAAN,GAA4B,EAA1D,CAAD,EAAgE,IAAhE,CAAqE,OAArE;AAEA;;;;;AAIO,MAAM,IAAI,GAAG,CAAC,OAAD,EAAgC,GAAG,MAAnC,KAChB,IAAI,8BAAJ,CAAmB,OAAnB,EAA4B,MAA5B,EAAoC,MAApC,EAA4C,kDAA5C,CADG;AAGP;;;;;;;;AAIO,MAAM,GAAG,GAAG,CAAC,OAAD,EAAgC,GAAG,MAAnC,KACf,IAAI,iCAAJ,CAAsB,OAAtB,EAA+B,MAA/B,EAAuC,KAAvC,EAA8C,kDAA9C,CADG;;;;;;;;;;;;;;;;;;;;;;;;;;ACvEP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,IAAMA,SAAS,GAAG,OAAOC,MAAP,KAAkB,UAAlB,GAA+BA,MAAM,CAACC,GAAtC,GAA4C,UAAAC,GAAG;AAAA,SAAIA,GAAJ;AAAA,CAAjE;AAEA,IAAMC,WAAW,GAAGJ,SAAS,CAAC,eAAD,CAA7B;AACA,IAAMK,UAAU,GAAGL,SAAS,CAAC,cAAD,CAA5B;AAEA,IAAMM,YAAY,GAAGN,SAAS,CAAC,gBAAD,CAA9B;AACA,IAAMO,YAAY,GAAGP,SAAS,CAAC,gBAAD,CAA9B;AACA,IAAMQ,aAAa,GAAGR,SAAS,CAAC,iBAAD,CAA/B;AACA,IAAMS,aAAa,GAAGT,SAAS,CAAC,iBAAD,CAA/B;AAEA,IAAMU,YAAY,GAAG,iBAArB;AAEA,IAAIC,OAAJ;AACA,IAAIC,SAAS,GAAG,CAAhB;;AAEA,SAASC,UAAT,CAAoBC,OAApB,EAA6B;AAC3BH,EAAAA,OAAO,GAAGG,OAAV;AACD;;AAED,SAASC,KAAT,GAAiB;AACfJ,EAAAA,OAAO,GAAG,IAAV;AACAC,EAAAA,SAAS,GAAG,CAAZ;AACD;;AAED,SAASI,MAAT,GAAkB;AAChB,MAAIC,EAAE,GAAGL,SAAT;AACAA,EAAAA,SAAS;AACT,SAAOK,EAAP;AACD;;AAED,IAAMC,KAAK,GAAG,OAAOC,OAAP,IAAgB,UAAhB,GAA6BA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuBC,IAAvB,CAA4BH,OAAO,CAACC,OAAR,EAA5B,CAA7B,GAA8EG,UAA5F;;AAEA,SAASC,SAAT,GAAqB;AACnB,MAAIC,KAAK,GAAG,EAAZ;AACA,MAAIR,EAAJ;;AAEA,WAASS,QAAT,GAAoB;AAClBT,IAAAA,EAAE,GAAG,IAAL;AACA,QAAIU,CAAC,GAAGF,KAAR;AACAA,IAAAA,KAAK,GAAG,EAAR;;AACA,SAAI,IAAIG,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGF,CAAC,CAACG,MAAvB,EAA+BF,CAAC,GAAGC,GAAnC,EAAwCD,CAAC,EAAzC,EAA6C;AAC3CD,MAAAA,CAAC,CAACC,CAAD,CAAD;AACD;AACF;;AAED,SAAO,UAASG,IAAT,EAAe;AACpBN,IAAAA,KAAK,CAACO,IAAN,CAAWD,IAAX;;AACA,QAAGd,EAAE,IAAI,IAAT,EAAe;AACbA,MAAAA,EAAE,GAAGC,KAAK,CAACQ,QAAD,CAAV;AACD;AACF,GALD;AAMD;;AAED,IAAMO,IAAI,GAAGT,SAAS,EAAtB;AACA,IAAMU,KAAK,GAAGV,SAAS,EAAvB;;IAEMW;;;AACJ,qBAAYC,QAAZ,EAAsBC,IAAtB,EAA4BC,IAA5B,EAAkC;AAAA;;AAChC,SAAKF,QAAL,GAAgBA,QAAhB;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,IAAL,GAAYA,IAAI,IAAID,IAApB;AACA,SAAKhC,UAAL,IAAmB,IAAIkC,GAAJ,EAAnB;AACA,SAAKnC,WAAL,IAAoB,IAApB;AACA,SAAKoC,aAAL,GAAqB,KAArB;AACD;;;;6BAEQ;AAAA;;AACP,UAAG,KAAKA,aAAR,EAAuB;AACvBP,MAAAA,IAAI,CAAC,YAAM;AACT,YAAIQ,MAAM,GAAG,KAAI,CAACC,WAAL,CAAiBpC,YAAjB,CAAb;;AACA4B,QAAAA,KAAK,CAAC,YAAM;AACV,UAAA,KAAI,CAACQ,WAAL,CAAiBnC,YAAjB,EAA+BkC,MAA/B;;AAEA,cAAG,KAAI,CAACjC,aAAD,CAAP,EAAwB;AACtB0B,YAAAA,KAAK,CAAC,YAAM;AACV,cAAA,KAAI,CAACQ,WAAL,CAAiBlC,aAAjB;AACD,aAFI,CAAL;AAGD;AACF,SARI,CAAL;AASA,QAAA,KAAI,CAACgC,aAAL,GAAqB,KAArB;AACD,OAZG,CAAJ;AAaA,WAAKA,aAAL,GAAqB,IAArB;AACD;;;gCAEWG,OAAOC,KAAK;AACtB,WAAKxC,WAAL,IAAoBuC,KAApB;;AACA,cAAOA,KAAP;AACE,aAAKpC,YAAL;AAAmB,iBAAO,KAAKsC,MAAL,CAAYD,GAAZ,CAAP;;AACnB,aAAKtC,YAAL;AAAmB,iBAAO,KAAKwC,MAAL,EAAP;;AACnB,aAAKtC,aAAL;AAAoB,iBAAO,KAAKuC,UAAL,CAAgBvC,aAAhB,CAAP;AAHtB;;AAKA,WAAKJ,WAAL,IAAoB,IAApB;AACD;;;2BAEMqC,QAAQ;AACb,2BAAOA,MAAP,EAAe,KAAKJ,IAApB;AACA,WAAKU,UAAL,CAAgBxC,YAAhB;AACD;;;6BAEQ;AACPM,MAAAA,UAAU,CAAC,IAAD,CAAV;AACA,UAAI4B,MAAM,GAAG,KAAKO,IAAL,GACX,KAAKZ,QAAL,CAAca,KAAd,CAAoB,KAAKX,IAAzB,EAA+B,KAAKU,IAApC,CADW,GAEX,KAAKZ,QAAL,CAAcc,IAAd,CAAmB,KAAKZ,IAAxB,EAA8B,KAAKA,IAAnC,CAFF;AAGAvB,MAAAA,KAAK;AACL,aAAO0B,MAAP;AACD;;;+BAEUU,QAAQ;AACjB,UAAIC,OAAO,GAAG,KAAKD,MAAL,CAAd;;AACA,UAAGC,OAAH,EAAY;AACVvC,QAAAA,UAAU,CAAC,IAAD,CAAV;AADU;AAAA;AAAA;;AAAA;AAEV,+BAAkBuC,OAAlB,8HAA2B;AAAA,gBAAnBC,MAAmB;AACzBA,YAAAA,MAAM,CAACH,IAAP,CAAY,IAAZ;AACD;AAJS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKVnC,QAAAA,KAAK;AACN;AACF;;;+BAEU;AACT,UAAIuC,KAAK,GAAG,KAAKjD,UAAL,CAAZ;AACAiD,MAAAA,KAAK,CAACC,OAAN,CAAc,UAACC,IAAD,EAAU;AACtB,YAAI,OAAOA,IAAI,CAACC,QAAZ,KAAyB,UAA7B,EAAyC;AACvCD,UAAAA,IAAI,CAACC,QAAL;AACD;AACF,OAJD;AAKD;;;;;;AAGH,SAASC,WAAT,GAA+B;AAAA,MAAVC,GAAU,uEAAJ,EAAI;AAC7B,SAAOA,GAAG,CAACC,OAAJ,CAAY,GAAZ,MAAqB,CAAC,CAAtB,GAA0BD,GAAG,CAACE,WAAJ,EAA1B,GAA8CF,GAAG,CAACE,WAAJ,GAAkBC,KAAlB,CAAwB,GAAxB,EAA6BC,MAA7B,CAAoC,UAACC,GAAD,EAAMC,IAAN,EAAe;AACtG,WAAOD,GAAG,GAAGA,GAAG,GAAGC,IAAI,CAACC,MAAL,CAAY,CAAZ,EAAeC,WAAf,EAAN,GAAqCF,IAAI,CAACG,KAAL,CAAW,CAAX,CAAxC,GAAwDH,IAAlE;AACD,GAFoD,EAEnD,EAFmD,CAArD;AAGD;;AAED,SAASI,SAAT,CAAmBjC,QAAnB,EAAwF;AAAA,MAA3DkC,WAA2D,uEAA7CC,WAA6C;AAAA,MAAhCC,OAAgC,uEAAtB;AAACC,IAAAA,YAAY,EAAE;AAAf,GAAsB;;AAAA,MAChFC,OADgF;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,0BAEpD;AAC9B,eAAOtC,QAAQ,CAACuC,kBAAT,IAA+B,EAAtC;AACD;AAJmF;;AAMpF,uBAAc;AAAA;;AAAA;;AACZ;;AACA,UAAIH,OAAO,CAACC,YAAR,KAAyB,KAA7B,EAAoC;AAClC,eAAKG,UAAL,GAAkB,IAAIzC,SAAJ,CAAcC,QAAd,iCAAlB;AACD,OAFD,MAEO;AACL,eAAKyC,YAAL,CAAkB;AAAEC,UAAAA,IAAI,EAAE;AAAR,SAAlB;;AACA,eAAKF,UAAL,GAAkB,IAAIzC,SAAJ,CAAcC,QAAd,EAAwB,OAAK2C,UAA7B,iCAAlB;AACD;;AAPW;AAQb;;AAdmF;AAAA;AAAA,0CAgBhE;AAClB,aAAKH,UAAL,CAAgBI,MAAhB;AACD;AAlBmF;AAAA;AAAA,6CAoB7D;AACrB,aAAKJ,UAAL,CAAgBnB,QAAhB;AACD;AAtBmF;AAAA;AAAA,+CAwB3DwB,IAxB2D,EAwBrDC,CAxBqD,EAwBlDC,QAxBkD,EAwBxC;AAC1C,YAAIxB,GAAG,GAAGwB,QAAQ,KAAK,EAAb,GAAkB,IAAlB,GAAyBA,QAAnC;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAkB3B,WAAW,CAACuB,IAAD,CAA7B,EAAqCtB,GAArC;AACD;AA3BmF;;AAAA;AAAA,IAChEW,WADgE;;AA6BtF,WAASgB,cAAT,CAAwBC,YAAxB,EAAsC;AACpC,QAAIC,KAAK,GAAGD,YAAZ;AACA,WAAOE,MAAM,CAACC,MAAP,CAAc;AACnBC,MAAAA,UAAU,EAAE,IADO;AAEnBC,MAAAA,YAAY,EAAE,IAFK;AAGnBC,MAAAA,GAHmB,iBAGb;AACJ,eAAOL,KAAP;AACD,OALkB;AAMnBH,MAAAA,GANmB,eAMfF,QANe,EAML;AACZK,QAAAA,KAAK,GAAGL,QAAR;;AACA,aAAKP,UAAL,CAAgBI,MAAhB;AACD;AATkB,KAAd,CAAP;AAWD;;AAED,MAAMc,KAAK,GAAG,IAAIC,KAAJ,CAAUzB,WAAW,CAAC0B,SAAtB,EAAiC;AAC7CX,IAAAA,GAD6C,eACzCY,MADyC,EACjCC,GADiC,EAC5BV,KAD4B,EACrBW,QADqB,EACX;AAChC,UAAGD,GAAG,IAAID,MAAV,EAAkB;AAChBb,QAAAA,OAAO,CAACC,GAAR,CAAYY,MAAZ,EAAoBC,GAApB,EAAyBV,KAAzB;AACD;;AACD,UAAIY,IAAJ;;AACA,UAAG,QAAOF,GAAP,MAAe,QAAf,IAA2BA,GAAG,CAAC,CAAD,CAAH,KAAW,GAAzC,EAA8C;AAC5CE,QAAAA,IAAI,GAAG;AACLT,UAAAA,UAAU,EAAE,IADP;AAELC,UAAAA,YAAY,EAAE,IAFT;AAGLS,UAAAA,QAAQ,EAAE,IAHL;AAILb,UAAAA,KAAK,EAALA;AAJK,SAAP;AAMD,OAPD,MAOO;AACLY,QAAAA,IAAI,GAAGd,cAAc,CAACE,KAAD,CAArB;AACD;;AACDC,MAAAA,MAAM,CAACa,cAAP,CAAsBH,QAAtB,EAAgCD,GAAhC,EAAqCE,IAArC;;AAEA,UAAGA,IAAI,CAACf,GAAR,EAAa;AACXe,QAAAA,IAAI,CAACf,GAAL,CAASnC,IAAT,CAAciD,QAAd,EAAwBX,KAAxB;AACD;;AAED,aAAO,IAAP;AACD;AAvB4C,GAAjC,CAAd;AA0BAC,EAAAA,MAAM,CAACc,cAAP,CAAsB7B,OAAO,CAACsB,SAA9B,EAAyCF,KAAzC;AAGA,SAAOpB,OAAP;AACD;;IAEK8B,OACJ,cAAYvF,EAAZ,EAAgBwF,EAAhB,EAAoB;AAAA;;AAClB,OAAKxF,EAAL,GAAUA,EAAV;AACA,OAAKwF,EAAL,GAAUA,EAAV;AACD;;;;AAGH,SAASC,GAAT,CAAaF,IAAb,EAA4B;AAAA;;AAC1B,MAAIvF,EAAE,GAAGD,MAAM,EAAf;AACA,MAAIsC,KAAK,GAAG3C,OAAO,CAACN,UAAD,CAAnB;AAEA,MAAImD,IAAI,GAAGF,KAAK,CAACuC,GAAN,CAAU5E,EAAV,CAAX;;AAJ0B,oCAAN+B,IAAM;AAANA,IAAAA,IAAM;AAAA;;AAK1B,MAAG,CAACQ,IAAJ,EAAU;AACRA,IAAAA,IAAI,cAAOgD,IAAP,GAAYvF,EAAZ,EAAgBN,OAAhB,SAA4BqC,IAA5B,EAAJ;AACAM,IAAAA,KAAK,CAAC+B,GAAN,CAAUpE,EAAV,EAAcuC,IAAd;AACD;;AAED,SAAO,SAAAA,IAAI,EAACwB,MAAL,cAAehC,IAAf,CAAP;AACD;;AAED,SAASQ,IAAT,CAAcgD,IAAd,EAAoB;AAClB,SAAOE,GAAG,CAACpF,IAAJ,CAAS,IAAT,EAAekF,IAAf,CAAP;AACD;;AAED,IAAMG,OAAO,GAAGnD,IAAI;AAAA;AAAA;AAAA;;AAClB,kBAAYvC,EAAZ,EAAgBwF,EAAhB,EAAoBG,EAApB,EAAwBC,MAAxB,EAAgC;AAAA;;AAAA;;AAC9B,iFAAM5F,EAAN,EAAUwF,EAAV;AACA,WAAKjB,KAAL,GAAaoB,EAAE,EAAf;AACA,WAAKC,MAAL,GAAcA,MAAd;AAH8B;AAI/B;;AALiB;AAAA;AAAA,2BAOXD,EAPW,EAOPC,MAPO,EAOC;AACjB,UAAG,KAAKC,UAAL,CAAgBD,MAAhB,CAAH,EAA4B;AAC1B,aAAKA,MAAL,GAAcA,MAAd;AACA,aAAKrB,KAAL,GAAaoB,EAAE,EAAf;AACD;;AACD,aAAO,KAAKpB,KAAZ;AACD;AAbiB;AAAA;AAAA,+BAePqB,MAfO,EAeC;AAAA;;AACjB,aAAOA,MAAM,CAACE,IAAP,CAAY,UAACvB,KAAD,EAAQ5D,CAAR;AAAA,eAAc,MAAI,CAACiF,MAAL,CAAYjF,CAAZ,MAAmB4D,KAAjC;AAAA,OAAZ,CAAP;AACD;AAjBiB;;AAAA;AAAA,EAAegB,IAAf,EAApB;;;AAoBA,IAAMQ,WAAW,GAAG,SAAdA,WAAc,CAACJ,EAAD,EAAKK,MAAL;AAAA,SAAgBN,OAAO,CAAC;AAAA,WAAMC,EAAN;AAAA,GAAD,EAAWK,MAAX,CAAvB;AAAA,CAApB;;;;AAEA,SAASC,UAAT,CAAoBT,EAApB,EAAwBU,EAAxB,EAA4B;AAC1B,MAAG,EAAE3G,aAAa,IAAIiG,EAAnB,CAAH,EAA2B;AACzBA,IAAAA,EAAE,CAACjG,aAAD,CAAF,GAAoB,EAApB;AACD;;AACDiG,EAAAA,EAAE,CAACjG,aAAD,CAAF,CAAkBwB,IAAlB,CAAuBmF,EAAvB;AACD;;AAED,IAAMC,SAAS,GAAG5D,IAAI;AAAA;AAAA;AAAA;;AACpB,mBAAYvC,EAAZ,EAAgBwF,EAAhB,EAAoB;AAAA;;AAAA;;AAClB,kFAAMxF,EAAN,EAAUwF,EAAV;AACA,WAAKI,MAAL,GAAc,KAAd;AACAK,IAAAA,UAAU,CAACT,EAAD,iCAAV;AAHkB;AAInB;;AALmB;AAAA;AAAA,2BAObY,QAPa,EAOHR,MAPG,EAOK;AACvB,WAAKQ,QAAL,GAAgBA,QAAhB;AACA,WAAKC,UAAL,GAAkB,KAAKT,MAAvB;AACA,WAAKA,MAAL,GAAcA,MAAd;AACD;AAXmB;AAAA;AAAA,2BAab;AACL,UAAG,KAAKA,MAAR,EAAgB;AACd,YAAG,KAAKC,UAAL,EAAH,EAAsB;AACpB,eAAKS,GAAL;AACD;AACF,OAJD,MAIO;AACL,aAAKA,GAAL;AACD;AACF;AArBmB;AAAA;AAAA,0BAuBd;AACJ,WAAK9D,QAAL;AACA,WAAK+D,SAAL,GAAiB,KAAKH,QAAL,CAAcnE,IAAd,CAAmB,KAAKuD,EAAxB,CAAjB;AACD;AA1BmB;AAAA;AAAA,+BA4BT;AACT,UAAG,KAAKe,SAAR,EAAmB;AACjB,aAAKA,SAAL;AACD;AACF;AAhCmB;AAAA;AAAA,iCAkCP;AAAA;;AACX,aAAO,KAAKF,UAAL,KAAoB,KAApB,IAA6B,KAAKT,MAAL,CAAYE,IAAZ,CAAiB,UAACvB,KAAD,EAAQ5D,CAAR;AAAA,eAAc,MAAI,CAAC0F,UAAL,CAAgB1F,CAAhB,MAAuB4D,KAArC;AAAA,OAAjB,CAApC;AACD;AApCmB;;AAAA;AAAA,EAAegB,IAAf,EAAtB;;AAuCA,IAAMiB,QAAQ,GAAGjE,IAAI;AAAA;AAAA;AAAA;;AACnB,mBAAYvC,EAAZ,EAAgBwF,EAAhB,EAAoBlB,YAApB,EAAkC;AAAA;;AAAA;;AAChC,kFAAMtE,EAAN,EAAUwF,EAAV;AACA,WAAKiB,OAAL,GAAe,OAAKA,OAAL,CAAapG,IAAb,gCAAf;;AACA,WAAKqG,QAAL,CAAcpC,YAAd;;AAHgC;AAIjC;;AALkB;AAAA;AAAA,6BAOV;AACP,aAAO,KAAKvC,IAAZ;AACD;AATkB;AAAA;AAAA,4BAWXwC,KAXW,EAWJ;AACb,UAAI,OAAOA,KAAP,KAAiB,UAArB,EAAiC;AAC/B,YAAMoC,SAAS,GAAGpC,KAAlB;;AAD+B,wCAEP,KAAKxC,IAFE;AAAA,YAExB6E,aAFwB;;AAG/BrC,QAAAA,KAAK,GAAGoC,SAAS,CAACC,aAAD,CAAjB;AACD;;AAED,WAAKF,QAAL,CAAcnC,KAAd;AACA,WAAKiB,EAAL,CAAQzB,MAAR;AACD;AApBkB;AAAA;AAAA,6BAsBVQ,KAtBU,EAsBH;AACd,WAAKxC,IAAL,GAAYyC,MAAM,CAACC,MAAP,CAAc,CAACF,KAAD,EAAQ,KAAKkC,OAAb,CAAd,CAAZ;AACD;AAxBkB;;AAAA;AAAA,EAAelB,IAAf,EAArB;;AA2BA,IAAMsB,UAAU,GAAGtE,IAAI;AAAA;AAAA;AAAA;;AACrB,mBAAYvC,EAAZ,EAAgBwF,EAAhB,EAAoBvB,CAApB,EAAuB6C,YAAvB,EAAqC;AAAA;;AAAA;;AACnC,kFAAM9G,EAAN,EAAUwF,EAAV;AACA,WAAKuB,QAAL,GAAgB,OAAKA,QAAL,CAAc1G,IAAd,gCAAhB;AACA,WAAK2G,KAAL,GAAaF,YAAb;AAHmC;AAIpC;;AALoB;AAAA;AAAA,2BAOdG,OAPc,EAOL;AACd,WAAKA,OAAL,GAAeA,OAAf;AACA,aAAO,CAAC,KAAKD,KAAN,EAAa,KAAKD,QAAlB,CAAP;AACD;AAVoB;AAAA;AAAA,6BAYZG,MAZY,EAYJ;AACf,WAAKF,KAAL,GAAa,KAAKC,OAAL,CAAa,KAAKD,KAAlB,EAAyBE,MAAzB,CAAb;AACA,WAAK1B,EAAL,CAAQzB,MAAR;AACD;AAfoB;;AAAA;AAAA,EAAewB,IAAf,EAAvB;;;IAkBM4B;;;;;AACJ,8BAAYhG,QAAZ,EAAsB6B,IAAtB,EAA4B;AAAA;;AAAA;;AAC1B,6FAAM7B,QAAN,EAAgB6B,IAAhB;AACA,WAAKoE,OAAL,GAAe,IAAf;AAF0B;AAG3B;;;;2BAEM5F,QAAQ;AACb,WAAKH,IAAL,CAAUgG,QAAV,CAAmB7F,MAAnB;AACA,WAAKH,IAAL,CAAUO,MAAV;AACD;;;;EAT8BV;;AAYjC,IAAMoG,GAAG,GAAG,IAAIC,OAAJ,EAAZ;;AAEA,SAASC,SAAT,CAAmBrG,QAAnB,EAA6B;AAC3B,WAASsG,OAAT,GAA0B;AAAA,uCAAN1F,IAAM;AAANA,MAAAA,IAAM;AAAA;;AACxB,WAAO,UAAAiB,IAAI,EAAI;AACb,UAAI0E,IAAI,GAAGJ,GAAG,CAAC1C,GAAJ,CAAQ5B,IAAR,CAAX;;AACA,UAAG,CAAC0E,IAAJ,EAAU;AACRA,QAAAA,IAAI,GAAG,IAAIP,kBAAJ,CAAuBhG,QAAvB,EAAiC6B,IAAjC,CAAP;AACAsE,QAAAA,GAAG,CAAClD,GAAJ,CAAQpB,IAAR,EAAc0E,IAAd;AACD;;AACDA,MAAAA,IAAI,CAAC3F,IAAL,GAAYA,IAAZ;AACA2F,MAAAA,IAAI,CAAC3D,MAAL;AACD,KARD;AASD;;AAED,SAAO,wBAAU0D,OAAV,CAAP;AACD;;AAED,SAASE,WAAT,CAAqBnC,EAArB,EAAyBoC,QAAzB,EAAmC;AACjC,MAAG,EAAEpI,aAAa,IAAIgG,EAAnB,CAAH,EAA2B;AACzBA,IAAAA,EAAE,CAAChG,aAAD,CAAF,GAAoB,EAApB;AACD;;AACDgG,EAAAA,EAAE,CAAChG,aAAD,CAAF,CAAkBuB,IAAlB,CAAuB6G,QAAvB;AACD;;AAED,IAAMC,UAAU,GAAGtF,IAAI;AAAA;AAAA;AAAA;;AACrB,mBAAYvC,EAAZ,EAAgBwF,EAAhB,EAAoB;AAAA;;AAAA;;AAClB,mFAAMxF,EAAN,EAAUwF,EAAV;AACAmC,IAAAA,WAAW,CAACnC,EAAD,kCAAX;AACA,YAAKsC,QAAL,GAAgB,QAAKA,QAAL,CAAczH,IAAd,iCAAhB;AAHkB;AAInB;;AALoB;AAAA;AAAA,2BAOd0H,OAPc,EAOL;AACd,UAAI,KAAKvC,EAAL,CAAQ4B,OAAZ,EAAqB;AACnB,cAAM,IAAIY,KAAJ,CAAU,wCAAV,CAAN;AACD;;AAED,UAAI,KAAKD,OAAL,KAAiBA,OAArB,EAA8B;AAC5B,aAAKE,UAAL,CAAgBF,OAAhB;;AACA,aAAKA,OAAL,GAAeA,OAAf;AACD;;AAED,aAAO,KAAKxD,KAAZ;AACD;AAlBoB;AAAA;AAAA,6BAoBZA,KApBY,EAoBL;AACd,WAAKA,KAAL,GAAaA,KAAb;AACA,WAAKiB,EAAL,CAAQzB,MAAR;AACD;AAvBoB;AAAA;AAAA,+BAyBVgE,OAzBU,EAyBD;AAClB,UAAMG,MAAM,GAAG;AAAEH,QAAAA,OAAO,EAAPA,OAAF;AAAW3B,QAAAA,QAAQ,EAAE,KAAK0B;AAA1B,OAAf;AAEA,WAAKtC,EAAL,CAAQnE,IAAR,CAAa8G,aAAb,CAA2B,IAAIC,WAAJ,CAAgB3I,YAAhB,EAA8B;AACvDyI,QAAAA,MAAM,EAANA,MADuD;AAC/C;AACRG,QAAAA,OAAO,EAAE,IAF8C;AAExC;AACfC,QAAAA,UAAU,EAAE,IAH2C;AAGrC;AAClBC,QAAAA,QAAQ,EAAE,IAJ6C,CAIvC;;AAJuC,OAA9B,CAA3B;AAHkB,UAUVC,WAVU,GAUaN,MAVb,CAUVM,WAVU;AAAA,UAUGjE,KAVH,GAUa2D,MAVb,CAUG3D,KAVH;AAYlB,WAAKA,KAAL,GAAaiE,WAAW,GAAGjE,KAAH,GAAWwD,OAAO,CAACU,YAA3C;AAEA,WAAKC,YAAL,GAAoBF,WAApB;AACD;AAxCoB;AAAA;AAAA,+BA0CV;AACT,UAAI,KAAKE,YAAT,EAAuB;AACrB,aAAKA,YAAL;AACD;AACF;AA9CoB;;AAAA;AAAA,EAAenD,IAAf,EAAvB;;;AAiDA,IAAMoD,aAAa,GAAG,SAAhBA,aAAgB,CAACF,YAAD,EAAkB;AACtC,MAAMV,OAAO,GAAG,EAAhB;;AAEAA,EAAAA,OAAO,CAACa,QAAR;AAAA;AAAA;AAAA;;AACE,uBAAc;AAAA;;AAAA;;AACZ;AACA,cAAKC,SAAL,GAAiB,EAAjB;;AAEA,cAAKC,YAAL,GAAoB,UAACC,KAAD,EAAW;AAAA,YACrBb,MADqB,GACVa,KADU,CACrBb,MADqB;;AAG7B,YAAIA,MAAM,CAACH,OAAP,KAAmBA,OAAvB,EAAgC;AAC9BG,UAAAA,MAAM,CAAC3D,KAAP,GAAe,QAAKA,KAApB;;AAEA2D,UAAAA,MAAM,CAACM,WAAP,GAAqB,YAAM;AACzB,gBAAMQ,KAAK,GAAG,QAAKH,SAAL,CAAelG,OAAf,CAAuBuF,MAAM,CAAC9B,QAA9B,CAAd;;AAEA,gBAAI4C,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,sBAAKH,SAAL,CAAeI,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AACD;AACF,WAND;;AAQA,kBAAKH,SAAL,CAAe9H,IAAf,CAAoBmH,MAAM,CAAC9B,QAA3B;;AAEA2C,UAAAA,KAAK,CAACG,eAAN;AACD;AACF,OAlBD;;AAoBA,cAAKC,gBAAL,CAAsB1J,YAAtB,EAAoC,QAAKqJ,YAAzC;;AAxBY;AAyBb;;AA1BH;AAAA;AAAA,6CA4ByB;AACrB,aAAKM,mBAAL,CAAyB3J,YAAzB,EAAuC,KAAKqJ,YAA5C;AACD;AA9BH;AAAA;AAAA,wBAgCYvE,KAhCZ,EAgCmB;AACf,aAAK8E,MAAL,GAAc9E,KAAd;AACA,aAAKsE,SAAL,CAAevG,OAAf,CAAuB,UAAA8D,QAAQ;AAAA,iBAAIA,QAAQ,CAAC7B,KAAD,CAAZ;AAAA,SAA/B;AACD,OAnCH;AAAA,0BAqCc;AACV,eAAO,KAAK8E,MAAZ;AACD;AAvCH;;AAAA;AAAA,qBAAiC/F,WAAjC;;AA0CAyE,EAAAA,OAAO,CAACuB,QAAR,GAAmBlG,SAAS,CAAC,gBAAiC;AAAA,QAAbmG,SAAa,QAArB1H,MAAqB;AAC5D,QAAM2H,OAAO,GAAG3B,UAAU,CAACE,OAAD,CAA1B;AAEA,WAAOwB,SAAS,CAACC,OAAD,CAAhB;AACD,GAJ2B,CAA5B;AAMAzB,EAAAA,OAAO,CAACU,YAAR,GAAuBA,YAAvB;AAEA,SAAOV,OAAP;AACD,CAtDD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrbA,IAAA,qBAAA,GAAA,OAAA,CAAA,qBAAA,CAAA;AAEA;;;;;;;;;;AAQA,IAAM,eAAe,GAAG,qBAAA,CAAA,IAAA;AAAI;AAAA,UAAA,MAAA,EAAA;AACZ,EAAA,SAAA,CAAA,OAAA,EAAA,MAAA,CAAA;;AAEZ,WAAA,OAAA,CAAY,EAAZ,EAAgB,SAAhB,EAA2B,QAA3B,EAAmC;AAAnC,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,EAAM,EAAN,EAAU,SAAV,KAAoB,IADtB;;AAEE,IAAA,KAAI,CAAC,SAAL,GAAiB,QAAjB;;AACD;;AAED,EAAA,OAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA,CAAiB,CAAjB;;AAEA,EAAA,OAAA,CAAA,SAAA,CAAA,QAAA,GAAA,YAAA;AACE,SAAK,SAAL;AACD,GAFD;;AAGF,SAAA,OAAA;AAZA,CAD0B,CACZ,qBAAA,CAAA,IADY,CAAJ,CAAxB;AAgBS,OAAA,CAAA,eAAA,GAAA,eAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1BT,IAAA,qBAAA,GAAA,OAAA,CAAA,qBAAA,CAAA;AAEA;;;;;;;;;AAOA,IAAM,gBAAgB,GAAG,qBAAA,CAAA,IAAA;AAAI;AAAA,UAAA,MAAA,EAAA;AACb,EAAA,SAAA,CAAA,OAAA,EAAA,MAAA,CAAA;;AAEZ,WAAA,OAAA,CAAY,EAAZ,EAAgB,SAAhB,EAAyB;AAAzB,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,EAAM,EAAN,EAAU,SAAV,KAAoB,IADtB;;AAEE,IAAA,KAAI,CAAC,UAAL,GAAkB,SAAlB;;AACD;;AAED,EAAA,OAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACE,WAAO,KAAK,UAAL,CAAgB,MAAhB,CAAuB,IAAvB,CAA4B,KAAK,UAAjC,CAAP;AACD,GAFD;;AAGF,SAAA,OAAA;AAVA,CAD2B,CACb,qBAAA,CAAA,IADa,CAAJ,CAAzB;AAcS,OAAA,CAAA,gBAAA,GAAA,gBAAA;;;;;;;;;ACvBM,SAAS0B,wBAAT,CAAkCC,IAAlC,EAAwC;AACtD,MAAIlI,MAAJ;AACA,MAAIxC,MAAM,GAAG0K,IAAI,CAAC1K,MAAlB;;AAEA,MAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AACjC,QAAIA,MAAM,CAAC2K,UAAX,EAAuB;AACtBnI,MAAAA,MAAM,GAAGxC,MAAM,CAAC2K,UAAhB;AACA,KAFD,MAEO;AACNnI,MAAAA,MAAM,GAAGxC,MAAM,CAAC,YAAD,CAAf;AACAA,MAAAA,MAAM,CAAC2K,UAAP,GAAoBnI,MAApB;AACA;AACD,GAPD,MAOO;AACNA,IAAAA,MAAM,GAAG,cAAT;AACA;;AAED,SAAOA,MAAP;AACA;;AAAA;;;;;;;;;;ACfD;;;;AADA;AAGA,IAAIkI,IAAJ;;AAEA,IAAI,OAAOE,IAAP,KAAgB,WAApB,EAAiC;AAC/BF,EAAAA,IAAI,GAAGE,IAAP;AACD,CAFD,MAEO,IAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AACxCH,EAAAA,IAAI,GAAGG,MAAP;AACD,CAFM,MAEA,IAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AACxCJ,EAAAA,IAAI,GAAGI,MAAP;AACD,CAFM,MAEA,IAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AACxCL,EAAAA,IAAI,GAAGK,MAAP;AACD,CAFM,MAEA;AACLL,EAAAA,IAAI,GAAGM,QAAQ,CAAC,aAAD,CAAR,EAAP;AACD;;AAED,IAAIxI,MAAM,GAAG,uBAASkI,IAAT,CAAb;eACelI;;;AClBf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"router-test.7ab2b07e.map","sourceRoot":"../src/_html-web","sourcesContent":["/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {Part} from './part.js';\n\nconst directives = new WeakMap<object, true>();\n\n// tslint:disable-next-line:no-any\nexport type DirectiveFactory = (...args: any[]) => object;\n\nexport type DirectiveFn = (part: Part) => void;\n\n/**\n * Brands a function as a directive so that lit-html will call the function\n * during template rendering, rather than passing as a value.\n *\n * @param f The directive factory function. Must be a function that returns a\n * function of the signature `(part: Part) => void`. The returned function will\n * be called with the part object\n *\n * @example\n *\n * ```\n * import {directive, html} from 'lit-html';\n *\n * const immutable = directive((v) => (part) => {\n *   if (part.value !== v) {\n *     part.setValue(v)\n *   }\n * });\n * ```\n */\n// tslint:disable-next-line:no-any\nexport const directive = <F extends DirectiveFactory>(f: F): F =>\n    ((...args: unknown[]) => {\n      const d = f(...args);\n      directives.set(d, true);\n      return d;\n    }) as F;\n\nexport const isDirective = (o: unknown): o is DirectiveFn => {\n  return typeof o === 'function' && directives.has(o);\n};\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\ninterface MaybePolyfilledCe extends CustomElementRegistry {\n  polyfillWrapFlushCallback?: object;\n}\n\n/**\n * True if the custom elements polyfill is in use.\n */\nexport const isCEPolyfill = window.customElements !== undefined &&\n    (window.customElements as MaybePolyfilledCe).polyfillWrapFlushCallback !==\n        undefined;\n\n/**\n * Reparents nodes, starting from `startNode` (inclusive) to `endNode`\n * (exclusive), into another container (could be the same container), before\n * `beforeNode`. If `beforeNode` is null, it appends the nodes to the\n * container.\n */\nexport const reparentNodes =\n    (container: Node,\n     start: Node|null,\n     end: Node|null = null,\n     before: Node|null = null): void => {\n      let node = start;\n      while (node !== end) {\n        const n = node!.nextSibling;\n        container.insertBefore(node!, before as Node);\n        node = n;\n      }\n    };\n\n/**\n * Removes nodes, starting from `startNode` (inclusive) to `endNode`\n * (exclusive), from `container`.\n */\nexport const removeNodes =\n    (container: Node, startNode: Node|null, endNode: Node|null = null):\n        void => {\n          let node = startNode;\n          while (node !== endNode) {\n            const n = node!.nextSibling;\n            container.removeChild(node!);\n            node = n;\n          }\n        };\n","/**\n * @license\n * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\n/**\n * The Part interface represents a dynamic part of a template instance rendered\n * by lit-html.\n */\nexport interface Part {\n  value: unknown;\n\n  /**\n   * Sets the current part value, but does not write it to the DOM.\n   * @param value The value that will be committed.\n   */\n  setValue(value: unknown): void;\n\n  /**\n   * Commits the current part value, cause it to actually be written to the DOM.\n   */\n  commit(): void;\n}\n\n/**\n * A sentinel value that signals that a value was handled by a directive and\n * should not be written to the DOM.\n */\nexport const noChange: object = {};\n\n/**\n * A sentinel value that signals a NodePart to fully clear its content.\n */\nexport const nothing = {};\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {TemplateResult} from './template-result.js';\n\n/**\n * An expression marker with embedded unique key to avoid collision with\n * possible text in templates.\n */\nexport const marker = `{{lit-${String(Math.random()).slice(2)}}}`;\n\n/**\n * An expression marker used text-positions, multi-binding attributes, and\n * attributes with markup-like text values.\n */\nexport const nodeMarker = `<!--${marker}-->`;\n\nexport const markerRegex = new RegExp(`${marker}|${nodeMarker}`);\n\n/**\n * Suffix appended to all bound attribute names.\n */\nexport const boundAttributeSuffix = '$lit$';\n\n/**\n * An updateable Template that tracks the location of dynamic parts.\n */\nexport class Template {\n  parts: TemplatePart[] = [];\n  element: HTMLTemplateElement;\n\n  constructor(result: TemplateResult, element: HTMLTemplateElement) {\n    this.element = element;\n    let index = -1;\n    let partIndex = 0;\n    const nodesToRemove: Node[] = [];\n    const _prepareTemplate = (template: HTMLTemplateElement) => {\n      const content = template.content;\n      // Edge needs all 4 parameters present; IE11 needs 3rd parameter to be\n      // null\n      const walker = document.createTreeWalker(\n          content,\n          133 /* NodeFilter.SHOW_{ELEMENT|COMMENT|TEXT} */,\n          null,\n          false);\n      // Keeps track of the last index associated with a part. We try to delete\n      // unnecessary nodes, but we never want to associate two different parts\n      // to the same index. They must have a constant node between.\n      let lastPartIndex = 0;\n      while (walker.nextNode()) {\n        index++;\n        const node = walker.currentNode as Element | Comment | Text;\n        if (node.nodeType === 1 /* Node.ELEMENT_NODE */) {\n          if ((node as Element).hasAttributes()) {\n            const attributes = (node as Element).attributes;\n            // Per\n            // https://developer.mozilla.org/en-US/docs/Web/API/NamedNodeMap,\n            // attributes are not guaranteed to be returned in document order.\n            // In particular, Edge/IE can return them out of order, so we cannot\n            // assume a correspondance between part index and attribute index.\n            let count = 0;\n            for (let i = 0; i < attributes.length; i++) {\n              if (attributes[i].value.indexOf(marker) >= 0) {\n                count++;\n              }\n            }\n            while (count-- > 0) {\n              // Get the template literal section leading up to the first\n              // expression in this attribute\n              const stringForPart = result.strings[partIndex];\n              // Find the attribute name\n              const name = lastAttributeNameRegex.exec(stringForPart)![2];\n              // Find the corresponding attribute\n              // All bound attributes have had a suffix added in\n              // TemplateResult#getHTML to opt out of special attribute\n              // handling. To look up the attribute value we also need to add\n              // the suffix.\n              const attributeLookupName =\n                  name.toLowerCase() + boundAttributeSuffix;\n              const attributeValue =\n                  (node as Element).getAttribute(attributeLookupName)!;\n              const strings = attributeValue.split(markerRegex);\n              this.parts.push({type: 'attribute', index, name, strings});\n              (node as Element).removeAttribute(attributeLookupName);\n              partIndex += strings.length - 1;\n            }\n          }\n          if ((node as Element).tagName === 'TEMPLATE') {\n            _prepareTemplate(node as HTMLTemplateElement);\n          }\n        } else if (node.nodeType === 3 /* Node.TEXT_NODE */) {\n          const data = (node as Text).data!;\n          if (data.indexOf(marker) >= 0) {\n            const parent = node.parentNode!;\n            const strings = data.split(markerRegex);\n            const lastIndex = strings.length - 1;\n            // Generate a new text node for each literal section\n            // These nodes are also used as the markers for node parts\n            for (let i = 0; i < lastIndex; i++) {\n              parent.insertBefore(\n                  (strings[i] === '') ? createMarker() :\n                                        document.createTextNode(strings[i]),\n                  node);\n              this.parts.push({type: 'node', index: ++index});\n            }\n            // If there's no text, we must insert a comment to mark our place.\n            // Else, we can trust it will stick around after cloning.\n            if (strings[lastIndex] === '') {\n              parent.insertBefore(createMarker(), node);\n              nodesToRemove.push(node);\n            } else {\n              (node as Text).data = strings[lastIndex];\n            }\n            // We have a part for each match found\n            partIndex += lastIndex;\n          }\n        } else if (node.nodeType === 8 /* Node.COMMENT_NODE */) {\n          if ((node as Comment).data === marker) {\n            const parent = node.parentNode!;\n            // Add a new marker node to be the startNode of the Part if any of\n            // the following are true:\n            //  * We don't have a previousSibling\n            //  * The previousSibling is already the start of a previous part\n            if (node.previousSibling === null || index === lastPartIndex) {\n              index++;\n              parent.insertBefore(createMarker(), node);\n            }\n            lastPartIndex = index;\n            this.parts.push({type: 'node', index});\n            // If we don't have a nextSibling, keep this node so we have an end.\n            // Else, we can remove it to save future costs.\n            if (node.nextSibling === null) {\n              (node as Comment).data = '';\n            } else {\n              nodesToRemove.push(node);\n              index--;\n            }\n            partIndex++;\n          } else {\n            let i = -1;\n            while ((i = (node as Comment).data!.indexOf(marker, i + 1)) !==\n                   -1) {\n              // Comment node has a binding marker inside, make an inactive part\n              // The binding won't work, but subsequent bindings will\n              // TODO (justinfagnani): consider whether it's even worth it to\n              // make bindings in comments work\n              this.parts.push({type: 'node', index: -1});\n            }\n          }\n        }\n      }\n    };\n    _prepareTemplate(element);\n    // Remove text binding nodes after the walk to not disturb the TreeWalker\n    for (const n of nodesToRemove) {\n      n.parentNode!.removeChild(n);\n    }\n  }\n}\n\n/**\n * A placeholder for a dynamic expression in an HTML template.\n *\n * There are two built-in part types: AttributePart and NodePart. NodeParts\n * always represent a single dynamic expression, while AttributeParts may\n * represent as many expressions are contained in the attribute.\n *\n * A Template's parts are mutable, so parts can be replaced or modified\n * (possibly to implement different template semantics). The contract is that\n * parts can only be replaced, not removed, added or reordered, and parts must\n * always consume the correct number of values in their `update()` method.\n *\n * TODO(justinfagnani): That requirement is a little fragile. A\n * TemplateInstance could instead be more careful about which values it gives\n * to Part.update().\n */\nexport type TemplatePart = {\n  type: 'node',\n  index: number\n}|{type: 'attribute', index: number, name: string, strings: string[]};\n\nexport const isTemplatePartActive = (part: TemplatePart) => part.index !== -1;\n\n// Allows `document.createComment('')` to be renamed for a\n// small manual size-savings.\nexport const createMarker = () => document.createComment('');\n\n/**\n * This regex extracts the attribute name preceding an attribute-position\n * expression. It does this by matching the syntax allowed for attributes\n * against the string literal directly preceding the expression, assuming that\n * the expression is in an attribute-value position.\n *\n * See attributes in the HTML spec:\n * https://www.w3.org/TR/html5/syntax.html#attributes-0\n *\n * \"\\0-\\x1F\\x7F-\\x9F\" are Unicode control characters\n *\n * \" \\x09\\x0a\\x0c\\x0d\" are HTML space characters:\n * https://www.w3.org/TR/html5/infrastructure.html#space-character\n *\n * So an attribute is:\n *  * The name: any character except a control character, space character, ('),\n *    (\"), \">\", \"=\", or \"/\"\n *  * Followed by zero or more space characters\n *  * Followed by \"=\"\n *  * Followed by zero or more space characters\n *  * Followed by:\n *    * Any character except space, ('), (\"), \"<\", \">\", \"=\", (`), or\n *    * (\") then any non-(\"), or\n *    * (') then any non-(')\n */\nexport const lastAttributeNameRegex =\n    /([ \\x09\\x0a\\x0c\\x0d])([^\\0-\\x1F\\x7F-\\x9F \\x09\\x0a\\x0c\\x0d\"'>=/]+)([ \\x09\\x0a\\x0c\\x0d]*=[ \\x09\\x0a\\x0c\\x0d]*(?:[^ \\x09\\x0a\\x0c\\x0d\"'`<>=]*|\"[^\"]*|'[^']*))$/;\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {isCEPolyfill} from './dom.js';\nimport {Part} from './part.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateProcessor} from './template-processor.js';\nimport {isTemplatePartActive, Template} from './template.js';\n\n/**\n * An instance of a `Template` that can be attached to the DOM and updated\n * with new values.\n */\nexport class TemplateInstance {\n  _parts: Array<Part|undefined> = [];\n  processor: TemplateProcessor;\n  options: RenderOptions;\n  template: Template;\n\n  constructor(\n      template: Template, processor: TemplateProcessor,\n      options: RenderOptions) {\n    this.template = template;\n    this.processor = processor;\n    this.options = options;\n  }\n\n  update(values: unknown[]) {\n    let i = 0;\n    for (const part of this._parts) {\n      if (part !== undefined) {\n        part.setValue(values[i]);\n      }\n      i++;\n    }\n    for (const part of this._parts) {\n      if (part !== undefined) {\n        part.commit();\n      }\n    }\n  }\n\n  _clone(): DocumentFragment {\n    // When using the Custom Elements polyfill, clone the node, rather than\n    // importing it, to keep the fragment in the template's document. This\n    // leaves the fragment inert so custom elements won't upgrade and\n    // potentially modify their contents by creating a polyfilled ShadowRoot\n    // while we traverse the tree.\n    const fragment = isCEPolyfill ?\n        this.template.element.content.cloneNode(true) as DocumentFragment :\n        document.importNode(this.template.element.content, true);\n\n    const parts = this.template.parts;\n    let partIndex = 0;\n    let nodeIndex = 0;\n    const _prepareInstance = (fragment: DocumentFragment) => {\n      // Edge needs all 4 parameters present; IE11 needs 3rd parameter to be\n      // null\n      const walker = document.createTreeWalker(\n          fragment,\n          133 /* NodeFilter.SHOW_{ELEMENT|COMMENT|TEXT} */,\n          null,\n          false);\n      let node = walker.nextNode();\n      // Loop through all the nodes and parts of a template\n      while (partIndex < parts.length && node !== null) {\n        const part = parts[partIndex];\n        // Consecutive Parts may have the same node index, in the case of\n        // multiple bound attributes on an element. So each iteration we either\n        // increment the nodeIndex, if we aren't on a node with a part, or the\n        // partIndex if we are. By not incrementing the nodeIndex when we find a\n        // part, we allow for the next part to be associated with the current\n        // node if neccessasry.\n        if (!isTemplatePartActive(part)) {\n          this._parts.push(undefined);\n          partIndex++;\n        } else if (nodeIndex === part.index) {\n          if (part.type === 'node') {\n            const part = this.processor.handleTextExpression(this.options);\n            part.insertAfterNode(node.previousSibling!);\n            this._parts.push(part);\n          } else {\n            this._parts.push(...this.processor.handleAttributeExpressions(\n                node as Element, part.name, part.strings, this.options));\n          }\n          partIndex++;\n        } else {\n          nodeIndex++;\n          if (node.nodeName === 'TEMPLATE') {\n            _prepareInstance((node as HTMLTemplateElement).content);\n          }\n          node = walker.nextNode();\n        }\n      }\n    };\n    _prepareInstance(fragment);\n    if (isCEPolyfill) {\n      document.adoptNode(fragment);\n      customElements.upgrade(fragment);\n    }\n    return fragment;\n  }\n}\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {reparentNodes} from './dom.js';\nimport {TemplateProcessor} from './template-processor.js';\nimport {boundAttributeSuffix, lastAttributeNameRegex, marker, nodeMarker} from './template.js';\n\n/**\n * The return type of `html`, which holds a Template and the values from\n * interpolated expressions.\n */\nexport class TemplateResult {\n  strings: TemplateStringsArray;\n  values: unknown[];\n  type: string;\n  processor: TemplateProcessor;\n\n  constructor(\n      strings: TemplateStringsArray, values: unknown[], type: string,\n      processor: TemplateProcessor) {\n    this.strings = strings;\n    this.values = values;\n    this.type = type;\n    this.processor = processor;\n  }\n\n  /**\n   * Returns a string of HTML used to create a `<template>` element.\n   */\n  getHTML(): string {\n    const endIndex = this.strings.length - 1;\n    let html = '';\n    for (let i = 0; i < endIndex; i++) {\n      const s = this.strings[i];\n      // This exec() call does two things:\n      // 1) Appends a suffix to the bound attribute name to opt out of special\n      // attribute value parsing that IE11 and Edge do, like for style and\n      // many SVG attributes. The Template class also appends the same suffix\n      // when looking up attributes to create Parts.\n      // 2) Adds an unquoted-attribute-safe marker for the first expression in\n      // an attribute. Subsequent attribute expressions will use node markers,\n      // and this is safe since attributes with multiple expressions are\n      // guaranteed to be quoted.\n      const match = lastAttributeNameRegex.exec(s);\n      if (match) {\n        // We're starting a new bound attribute.\n        // Add the safe attribute suffix, and use unquoted-attribute-safe\n        // marker.\n        html += s.substr(0, match.index) + match[1] + match[2] +\n            boundAttributeSuffix + match[3] + marker;\n      } else {\n        // We're either in a bound node, or trailing bound attribute.\n        // Either way, nodeMarker is safe to use.\n        html += s + nodeMarker;\n      }\n    }\n    return html + this.strings[endIndex];\n  }\n\n  getTemplateElement(): HTMLTemplateElement {\n    const template = document.createElement('template');\n    template.innerHTML = this.getHTML();\n    return template;\n  }\n}\n\n/**\n * A TemplateResult for SVG fragments.\n *\n * This class wraps HTMl in an `<svg>` tag in order to parse its contents in the\n * SVG namespace, then modifies the template to remove the `<svg>` tag so that\n * clones only container the original fragment.\n */\nexport class SVGTemplateResult extends TemplateResult {\n  getHTML(): string {\n    return `<svg>${super.getHTML()}</svg>`;\n  }\n\n  getTemplateElement(): HTMLTemplateElement {\n    const template = super.getTemplateElement();\n    const content = template.content;\n    const svgElement = content.firstChild!;\n    content.removeChild(svgElement);\n    reparentNodes(content, svgElement.firstChild);\n    return template;\n  }\n}\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {isDirective} from './directive.js';\nimport {removeNodes} from './dom.js';\nimport {noChange, nothing, Part} from './part.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateInstance} from './template-instance.js';\nimport {TemplateResult} from './template-result.js';\nimport {createMarker} from './template.js';\n\n// https://tc39.github.io/ecma262/#sec-typeof-operator\nexport type Primitive = null|undefined|boolean|number|string|Symbol|bigint;\nexport const isPrimitive = (value: unknown): value is Primitive => {\n  return (\n      value === null ||\n      !(typeof value === 'object' || typeof value === 'function'));\n};\n\n/**\n * Sets attribute values for AttributeParts, so that the value is only set once\n * even if there are multiple parts for an attribute.\n */\nexport class AttributeCommitter {\n  element: Element;\n  name: string;\n  strings: string[];\n  parts: AttributePart[];\n  dirty = true;\n\n  constructor(element: Element, name: string, strings: string[]) {\n    this.element = element;\n    this.name = name;\n    this.strings = strings;\n    this.parts = [];\n    for (let i = 0; i < strings.length - 1; i++) {\n      this.parts[i] = this._createPart();\n    }\n  }\n\n  /**\n   * Creates a single part. Override this to create a differnt type of part.\n   */\n  protected _createPart(): AttributePart {\n    return new AttributePart(this);\n  }\n\n  protected _getValue(): unknown {\n    const strings = this.strings;\n    const l = strings.length - 1;\n    let text = '';\n\n    for (let i = 0; i < l; i++) {\n      text += strings[i];\n      const part = this.parts[i];\n      if (part !== undefined) {\n        const v = part.value;\n        if (v != null &&\n            (Array.isArray(v) ||\n             // tslint:disable-next-line:no-any\n             typeof v !== 'string' && (v as any)[Symbol.iterator])) {\n          for (const t of v as Iterable<unknown>) {\n            text += typeof t === 'string' ? t : String(t);\n          }\n        } else {\n          text += typeof v === 'string' ? v : String(v);\n        }\n      }\n    }\n\n    text += strings[l];\n    return text;\n  }\n\n  commit(): void {\n    if (this.dirty) {\n      this.dirty = false;\n      this.element.setAttribute(this.name, this._getValue() as string);\n    }\n  }\n}\n\nexport class AttributePart implements Part {\n  committer: AttributeCommitter;\n  value: unknown = undefined;\n\n  constructor(comitter: AttributeCommitter) {\n    this.committer = comitter;\n  }\n\n  setValue(value: unknown): void {\n    if (value !== noChange && (!isPrimitive(value) || value !== this.value)) {\n      this.value = value;\n      // If the value is a not a directive, dirty the committer so that it'll\n      // call setAttribute. If the value is a directive, it'll dirty the\n      // committer if it calls setValue().\n      if (!isDirective(value)) {\n        this.committer.dirty = true;\n      }\n    }\n  }\n\n  commit() {\n    while (isDirective(this.value)) {\n      const directive = this.value;\n      this.value = noChange;\n      directive(this);\n    }\n    if (this.value === noChange) {\n      return;\n    }\n    this.committer.commit();\n  }\n}\n\nexport class NodePart implements Part {\n  options: RenderOptions;\n  startNode!: Node;\n  endNode!: Node;\n  value: unknown = undefined;\n  _pendingValue: unknown = undefined;\n\n  constructor(options: RenderOptions) {\n    this.options = options;\n  }\n\n  /**\n   * Inserts this part into a container.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  appendInto(container: Node) {\n    this.startNode = container.appendChild(createMarker());\n    this.endNode = container.appendChild(createMarker());\n  }\n\n  /**\n   * Inserts this part between `ref` and `ref`'s next sibling. Both `ref` and\n   * its next sibling must be static, unchanging nodes such as those that appear\n   * in a literal section of a template.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  insertAfterNode(ref: Node) {\n    this.startNode = ref;\n    this.endNode = ref.nextSibling!;\n  }\n\n  /**\n   * Appends this part into a parent part.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  appendIntoPart(part: NodePart) {\n    part._insert(this.startNode = createMarker());\n    part._insert(this.endNode = createMarker());\n  }\n\n  /**\n   * Appends this part after `ref`\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  insertAfterPart(ref: NodePart) {\n    ref._insert(this.startNode = createMarker());\n    this.endNode = ref.endNode;\n    ref.endNode = this.startNode;\n  }\n\n  setValue(value: unknown): void {\n    this._pendingValue = value;\n  }\n\n  commit() {\n    while (isDirective(this._pendingValue)) {\n      const directive = this._pendingValue;\n      this._pendingValue = noChange;\n      directive(this);\n    }\n    const value = this._pendingValue;\n    if (value === noChange) {\n      return;\n    }\n    if (isPrimitive(value)) {\n      if (value !== this.value) {\n        this._commitText(value);\n      }\n    } else if (value instanceof TemplateResult) {\n      this._commitTemplateResult(value);\n    } else if (value instanceof Node) {\n      this._commitNode(value);\n    } else if (\n        Array.isArray(value) ||\n        // tslint:disable-next-line:no-any\n        (value as any)[Symbol.iterator]) {\n      this._commitIterable(value as Iterable<unknown>);\n    } else if (value === nothing) {\n      this.value = nothing;\n      this.clear();\n    } else {\n      // Fallback, will render the string representation\n      this._commitText(value);\n    }\n  }\n\n  private _insert(node: Node) {\n    this.endNode.parentNode!.insertBefore(node, this.endNode);\n  }\n\n  private _commitNode(value: Node): void {\n    if (this.value === value) {\n      return;\n    }\n    this.clear();\n    this._insert(value);\n    this.value = value;\n  }\n\n  private _commitText(value: unknown): void {\n    const node = this.startNode.nextSibling!;\n    value = value == null ? '' : value;\n    if (node === this.endNode.previousSibling &&\n        node.nodeType === 3 /* Node.TEXT_NODE */) {\n      // If we only have a single text node between the markers, we can just\n      // set its value, rather than replacing it.\n      // TODO(justinfagnani): Can we just check if this.value is primitive?\n      (node as Text).data = value as string;\n    } else {\n      this._commitNode(document.createTextNode(\n          typeof value === 'string' ? value : String(value)));\n    }\n    this.value = value;\n  }\n\n  private _commitTemplateResult(value: TemplateResult): void {\n    const template = this.options.templateFactory(value);\n    if (this.value instanceof TemplateInstance &&\n        this.value.template === template) {\n      this.value.update(value.values);\n    } else {\n      // Make sure we propagate the template processor from the TemplateResult\n      // so that we use its syntax extension, etc. The template factory comes\n      // from the render function options so that it can control template\n      // caching and preprocessing.\n      const instance =\n          new TemplateInstance(template, value.processor, this.options);\n      const fragment = instance._clone();\n      instance.update(value.values);\n      this._commitNode(fragment);\n      this.value = instance;\n    }\n  }\n\n  private _commitIterable(value: Iterable<unknown>): void {\n    // For an Iterable, we create a new InstancePart per item, then set its\n    // value to the item. This is a little bit of overhead for every item in\n    // an Iterable, but it lets us recurse easily and efficiently update Arrays\n    // of TemplateResults that will be commonly returned from expressions like:\n    // array.map((i) => html`${i}`), by reusing existing TemplateInstances.\n\n    // If _value is an array, then the previous render was of an\n    // iterable and _value will contain the NodeParts from the previous\n    // render. If _value is not an array, clear this part and make a new\n    // array for NodeParts.\n    if (!Array.isArray(this.value)) {\n      this.value = [];\n      this.clear();\n    }\n\n    // Lets us keep track of how many items we stamped so we can clear leftover\n    // items from a previous render\n    const itemParts = this.value as NodePart[];\n    let partIndex = 0;\n    let itemPart: NodePart|undefined;\n\n    for (const item of value) {\n      // Try to reuse an existing part\n      itemPart = itemParts[partIndex];\n\n      // If no existing part, create a new one\n      if (itemPart === undefined) {\n        itemPart = new NodePart(this.options);\n        itemParts.push(itemPart);\n        if (partIndex === 0) {\n          itemPart.appendIntoPart(this);\n        } else {\n          itemPart.insertAfterPart(itemParts[partIndex - 1]);\n        }\n      }\n      itemPart.setValue(item);\n      itemPart.commit();\n      partIndex++;\n    }\n\n    if (partIndex < itemParts.length) {\n      // Truncate the parts array so _value reflects the current state\n      itemParts.length = partIndex;\n      this.clear(itemPart && itemPart!.endNode);\n    }\n  }\n\n  clear(startNode: Node = this.startNode) {\n    removeNodes(\n        this.startNode.parentNode!, startNode.nextSibling!, this.endNode);\n  }\n}\n\n/**\n * Implements a boolean attribute, roughly as defined in the HTML\n * specification.\n *\n * If the value is truthy, then the attribute is present with a value of\n * ''. If the value is falsey, the attribute is removed.\n */\nexport class BooleanAttributePart implements Part {\n  element: Element;\n  name: string;\n  strings: string[];\n  value: unknown = undefined;\n  _pendingValue: unknown = undefined;\n\n  constructor(element: Element, name: string, strings: string[]) {\n    if (strings.length !== 2 || strings[0] !== '' || strings[1] !== '') {\n      throw new Error(\n          'Boolean attributes can only contain a single expression');\n    }\n    this.element = element;\n    this.name = name;\n    this.strings = strings;\n  }\n\n  setValue(value: unknown): void {\n    this._pendingValue = value;\n  }\n\n  commit() {\n    while (isDirective(this._pendingValue)) {\n      const directive = this._pendingValue;\n      this._pendingValue = noChange;\n      directive(this);\n    }\n    if (this._pendingValue === noChange) {\n      return;\n    }\n    const value = !!this._pendingValue;\n    if (this.value !== value) {\n      if (value) {\n        this.element.setAttribute(this.name, '');\n      } else {\n        this.element.removeAttribute(this.name);\n      }\n    }\n    this.value = value;\n    this._pendingValue = noChange;\n  }\n}\n\n/**\n * Sets attribute values for PropertyParts, so that the value is only set once\n * even if there are multiple parts for a property.\n *\n * If an expression controls the whole property value, then the value is simply\n * assigned to the property under control. If there are string literals or\n * multiple expressions, then the strings are expressions are interpolated into\n * a string first.\n */\nexport class PropertyCommitter extends AttributeCommitter {\n  single: boolean;\n\n  constructor(element: Element, name: string, strings: string[]) {\n    super(element, name, strings);\n    this.single =\n        (strings.length === 2 && strings[0] === '' && strings[1] === '');\n  }\n\n  protected _createPart(): PropertyPart {\n    return new PropertyPart(this);\n  }\n\n  _getValue() {\n    if (this.single) {\n      return this.parts[0].value;\n    }\n    return super._getValue();\n  }\n\n  commit(): void {\n    if (this.dirty) {\n      this.dirty = false;\n      // tslint:disable-next-line:no-any\n      (this.element as any)[this.name] = this._getValue();\n    }\n  }\n}\n\nexport class PropertyPart extends AttributePart {}\n\n// Detect event listener options support. If the `capture` property is read\n// from the options object, then options are supported. If not, then the thrid\n// argument to add/removeEventListener is interpreted as the boolean capture\n// value so we should only pass the `capture` property.\nlet eventOptionsSupported = false;\n\ntry {\n  const options = {\n    get capture() {\n      eventOptionsSupported = true;\n      return false;\n    }\n  };\n  // tslint:disable-next-line:no-any\n  window.addEventListener('test', options as any, options);\n  // tslint:disable-next-line:no-any\n  window.removeEventListener('test', options as any, options);\n} catch (_e) {\n}\n\n\ntype EventHandlerWithOptions =\n    EventListenerOrEventListenerObject&Partial<AddEventListenerOptions>;\nexport class EventPart implements Part {\n  element: Element;\n  eventName: string;\n  eventContext?: EventTarget;\n  value: undefined|EventHandlerWithOptions = undefined;\n  _options?: AddEventListenerOptions;\n  _pendingValue: undefined|EventHandlerWithOptions = undefined;\n  _boundHandleEvent: (event: Event) => void;\n\n  constructor(element: Element, eventName: string, eventContext?: EventTarget) {\n    this.element = element;\n    this.eventName = eventName;\n    this.eventContext = eventContext;\n    this._boundHandleEvent = (e) => this.handleEvent(e);\n  }\n\n  setValue(value: undefined|EventHandlerWithOptions): void {\n    this._pendingValue = value;\n  }\n\n  commit() {\n    while (isDirective(this._pendingValue)) {\n      const directive = this._pendingValue;\n      this._pendingValue = noChange as EventHandlerWithOptions;\n      directive(this);\n    }\n    if (this._pendingValue === noChange) {\n      return;\n    }\n\n    const newListener = this._pendingValue;\n    const oldListener = this.value;\n    const shouldRemoveListener = newListener == null ||\n        oldListener != null &&\n            (newListener.capture !== oldListener.capture ||\n             newListener.once !== oldListener.once ||\n             newListener.passive !== oldListener.passive);\n    const shouldAddListener =\n        newListener != null && (oldListener == null || shouldRemoveListener);\n\n    if (shouldRemoveListener) {\n      this.element.removeEventListener(\n          this.eventName, this._boundHandleEvent, this._options);\n    }\n    if (shouldAddListener) {\n      this._options = getOptions(newListener);\n      this.element.addEventListener(\n          this.eventName, this._boundHandleEvent, this._options);\n    }\n    this.value = newListener;\n    this._pendingValue = noChange as EventHandlerWithOptions;\n  }\n\n  handleEvent(event: Event) {\n    if (typeof this.value === 'function') {\n      this.value.call(this.eventContext || this.element, event);\n    } else {\n      (this.value as EventListenerObject).handleEvent(event);\n    }\n  }\n}\n\n// We copy options because of the inconsistent behavior of browsers when reading\n// the third argument of add/removeEventListener. IE11 doesn't support options\n// at all. Chrome 41 only reads `capture` if the argument is an object.\nconst getOptions = (o: AddEventListenerOptions|undefined) => o &&\n    (eventOptionsSupported ?\n         {capture: o.capture, passive: o.passive, once: o.once} :\n         o.capture as AddEventListenerOptions);\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {Part} from './part.js';\nimport {AttributeCommitter, BooleanAttributePart, EventPart, NodePart, PropertyCommitter} from './parts.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateProcessor} from './template-processor.js';\n\n/**\n * Creates Parts when a template is instantiated.\n */\nexport class DefaultTemplateProcessor implements TemplateProcessor {\n  /**\n   * Create parts for an attribute-position binding, given the event, attribute\n   * name, and string literals.\n   *\n   * @param element The element containing the binding\n   * @param name  The attribute name\n   * @param strings The string literals. There are always at least two strings,\n   *   event for fully-controlled bindings with a single expression.\n   */\n  handleAttributeExpressions(\n      element: Element, name: string, strings: string[],\n      options: RenderOptions): Part[] {\n    const prefix = name[0];\n    if (prefix === '.') {\n      const comitter = new PropertyCommitter(element, name.slice(1), strings);\n      return comitter.parts;\n    }\n    if (prefix === '@') {\n      return [new EventPart(element, name.slice(1), options.eventContext)];\n    }\n    if (prefix === '?') {\n      return [new BooleanAttributePart(element, name.slice(1), strings)];\n    }\n    const comitter = new AttributeCommitter(element, name, strings);\n    return comitter.parts;\n  }\n  /**\n   * Create parts for a text-position binding.\n   * @param templateFactory\n   */\n  handleTextExpression(options: RenderOptions) {\n    return new NodePart(options);\n  }\n}\n\nexport const defaultTemplateProcessor = new DefaultTemplateProcessor();\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {TemplateResult} from './template-result.js';\nimport {marker, Template} from './template.js';\n\n/**\n * A function type that creates a Template from a TemplateResult.\n *\n * This is a hook into the template-creation process for rendering that\n * requires some modification of templates before they're used, like ShadyCSS,\n * which must add classes to elements and remove styles.\n *\n * Templates should be cached as aggressively as possible, so that many\n * TemplateResults produced from the same expression only do the work of\n * creating the Template the first time.\n *\n * Templates are usually cached by TemplateResult.strings and\n * TemplateResult.type, but may be cached by other keys if this function\n * modifies the template.\n *\n * Note that currently TemplateFactories must not add, remove, or reorder\n * expressions, because there is no way to describe such a modification\n * to render() so that values are interpolated to the correct place in the\n * template instances.\n */\nexport type TemplateFactory = (result: TemplateResult) => Template;\n\n/**\n * The default TemplateFactory which caches Templates keyed on\n * result.type and result.strings.\n */\nexport function templateFactory(result: TemplateResult) {\n  let templateCache = templateCaches.get(result.type);\n  if (templateCache === undefined) {\n    templateCache = {\n      stringsArray: new WeakMap<TemplateStringsArray, Template>(),\n      keyString: new Map<string, Template>()\n    };\n    templateCaches.set(result.type, templateCache);\n  }\n\n  let template = templateCache.stringsArray.get(result.strings);\n  if (template !== undefined) {\n    return template;\n  }\n\n  // If the TemplateStringsArray is new, generate a key from the strings\n  // This key is shared between all templates with identical content\n  const key = result.strings.join(marker);\n\n  // Check if we already have a Template for this key\n  template = templateCache.keyString.get(key);\n  if (template === undefined) {\n    // If we have not seen this key before, create a new Template\n    template = new Template(result, result.getTemplateElement());\n    // Cache the Template for this key\n    templateCache.keyString.set(key, template);\n  }\n\n  // Cache all future queries for this TemplateStringsArray\n  templateCache.stringsArray.set(result.strings, template);\n  return template;\n}\n\n/**\n * The first argument to JS template tags retain identity across multiple\n * calls to a tag for the same literal, so we can cache work done per literal\n * in a Map.\n *\n * Safari currently has a bug which occasionally breaks this behaviour, so we\n * need to cache the Template at two levels. We first cache the\n * TemplateStringsArray, and if that fails, we cache a key constructed by\n * joining the strings array.\n */\nexport type templateCache = {\n  stringsArray: WeakMap<TemplateStringsArray, Template>;\n  keyString: Map<string, Template>;\n};\n\nexport const templateCaches = new Map<string, templateCache>();\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {removeNodes} from './dom.js';\nimport {NodePart} from './parts.js';\nimport {RenderOptions} from './render-options.js';\nimport {templateFactory} from './template-factory.js';\nimport {TemplateResult} from './template-result.js';\n\nexport const parts = new WeakMap<Node, NodePart>();\n\n/**\n * Renders a template to a container.\n *\n * To update a container with new values, reevaluate the template literal and\n * call `render` with the new result.\n *\n * @param result a TemplateResult created by evaluating a template tag like\n *     `html` or `svg`.\n * @param container A DOM parent to render to. The entire contents are either\n *     replaced, or efficiently updated if the same result type was previous\n *     rendered there.\n * @param options RenderOptions for the entire render tree rendered to this\n *     container. Render options must *not* change between renders to the same\n *     container, as those changes will not effect previously rendered DOM.\n */\nexport const render =\n    (result: TemplateResult,\n     container: Element|DocumentFragment,\n     options?: Partial<RenderOptions>) => {\n      let part = parts.get(container);\n      if (part === undefined) {\n        removeNodes(container, container.firstChild);\n        parts.set(container, part = new NodePart({\n                               templateFactory,\n                               ...options,\n                             }));\n        part.appendInto(container);\n      }\n      part.setValue(result);\n      part.commit();\n    };\n","/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n *\n * Main lit-html module.\n *\n * Main exports:\n *\n * -  [[html]]\n * -  [[svg]]\n * -  [[render]]\n *\n * @module lit-html\n * @preferred\n */\n\n/**\n * Do not remove this comment; it keeps typedoc from misplacing the module\n * docs.\n */\nimport {defaultTemplateProcessor} from './lib/default-template-processor.js';\nimport {SVGTemplateResult, TemplateResult} from './lib/template-result.js';\n\nexport {DefaultTemplateProcessor, defaultTemplateProcessor} from './lib/default-template-processor.js';\nexport {directive, DirectiveFn, isDirective} from './lib/directive.js';\n// TODO(justinfagnani): remove line when we get NodePart moving methods\nexport {removeNodes, reparentNodes} from './lib/dom.js';\nexport {noChange, nothing, Part} from './lib/part.js';\nexport {AttributeCommitter, AttributePart, BooleanAttributePart, EventPart, isPrimitive, NodePart, PropertyCommitter, PropertyPart} from './lib/parts.js';\nexport {RenderOptions} from './lib/render-options.js';\nexport {parts, render} from './lib/render.js';\nexport {templateCaches, templateFactory} from './lib/template-factory.js';\nexport {TemplateInstance} from './lib/template-instance.js';\nexport {TemplateProcessor} from './lib/template-processor.js';\nexport {SVGTemplateResult, TemplateResult} from './lib/template-result.js';\nexport {createMarker, isTemplatePartActive, Template} from './lib/template.js';\n\ndeclare global {\n  interface Window {\n    litHtmlVersions: string[];\n  }\n}\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for lit-html usage.\n// TODO(justinfagnani): inject version number at build time\n(window['litHtmlVersions'] || (window['litHtmlVersions'] = [])).push('1.0.0');\n\n/**\n * Interprets a template literal as an HTML template that can efficiently\n * render to and update a container.\n */\nexport const html = (strings: TemplateStringsArray, ...values: unknown[]) =>\n    new TemplateResult(strings, values, 'html', defaultTemplateProcessor);\n\n/**\n * Interprets a template literal as an SVG template that can efficiently\n * render to and update a container.\n */\nexport const svg = (strings: TemplateStringsArray, ...values: unknown[]) =>\n    new SVGTemplateResult(strings, values, 'svg', defaultTemplateProcessor);\n","import { render, directive } from 'lit-html';\nexport { html, render } from 'lit-html';\n\nconst symbolFor = typeof Symbol === 'function' ? Symbol.for : str => str;\n\nconst phaseSymbol = symbolFor('haunted.phase');\nconst hookSymbol = symbolFor('haunted.hook');\n\nconst updateSymbol = symbolFor('haunted.update');\nconst commitSymbol = symbolFor('haunted.commit');\nconst effectsSymbol = symbolFor('haunted.effects');\nconst contextSymbol = symbolFor('haunted.context');\n\nconst contextEvent = 'haunted.context';\n\nlet current;\nlet currentId = 0;\n\nfunction setCurrent(element) {\n  current = element;\n}\n\nfunction clear() {\n  current = null;\n  currentId = 0;\n}\n\nfunction notify() {\n  let id = currentId;\n  currentId++;\n  return id;\n}\n\nconst defer = typeof Promise=='function' ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\n\nfunction scheduler() {\n  let tasks = [];\n  let id;\n\n  function runTasks() {\n    id = null;\n    let t = tasks;\n    tasks = [];\n    for(var i = 0, len = t.length; i < len; i++) {\n      t[i]();\n    }\n  }\n\n  return function(task) {\n    tasks.push(task);\n    if(id == null) {\n      id = defer(runTasks);\n    }\n  };\n}\n\nconst read = scheduler();\nconst write = scheduler();\n\nclass Container {\n  constructor(renderer, frag, host) {\n    this.renderer = renderer;\n    this.frag = frag;\n    this.host = host || frag;\n    this[hookSymbol] = new Map();\n    this[phaseSymbol] = null;\n    this._updateQueued = false;\n  }\n\n  update() {\n    if(this._updateQueued) return;\n    read(() => {\n      let result = this.handlePhase(updateSymbol);\n      write(() => {\n        this.handlePhase(commitSymbol, result);\n\n        if(this[effectsSymbol]) {\n          write(() => {\n            this.handlePhase(effectsSymbol);\n          });\n        }\n      });\n      this._updateQueued = false;\n    });\n    this._updateQueued = true;\n  }\n\n  handlePhase(phase, arg) {\n    this[phaseSymbol] = phase;\n    switch(phase) {\n      case commitSymbol: return this.commit(arg);\n      case updateSymbol: return this.render();\n      case effectsSymbol: return this.runEffects(effectsSymbol);\n    }\n    this[phaseSymbol] = null;\n  }\n\n  commit(result) {\n    render(result, this.frag);\n    this.runEffects(commitSymbol);\n  }\n\n  render() {\n    setCurrent(this);\n    let result = this.args ?\n      this.renderer.apply(this.host, this.args) :\n      this.renderer.call(this.host, this.host);\n    clear();\n    return result;\n  }\n\n  runEffects(symbol) {\n    let effects = this[symbol];\n    if(effects) {\n      setCurrent(this);\n      for(let effect of effects) {\n        effect.call(this);\n      }\n      clear();\n    }\n  }\n\n  teardown() {\n    let hooks = this[hookSymbol];\n    hooks.forEach((hook) => {\n      if (typeof hook.teardown === 'function') {\n        hook.teardown();\n      }\n    });\n  }\n}\n\nfunction toCamelCase(val = '') {\n  return val.indexOf('-') === -1 ? val.toLowerCase() : val.toLowerCase().split('-').reduce((out, part) => {\n    return out ? out + part.charAt(0).toUpperCase() + part.slice(1) : part;\n  },'') \n}\n\nfunction component(renderer, BaseElement = HTMLElement, options = {useShadowDOM: true}) {\n  class Element extends BaseElement {\n    static get observedAttributes() {\n      return renderer.observedAttributes || [];\n    }\n\n    constructor() {\n      super();\n      if (options.useShadowDOM === false) {\n        this._container = new Container(renderer, this);\n      } else {\n        this.attachShadow({ mode: 'open' });\n        this._container = new Container(renderer, this.shadowRoot, this);        \n      }\n    }\n\n    connectedCallback() {\n      this._container.update();\n    }\n\n    disconnectedCallback() {\n      this._container.teardown();\n    }\n\n    attributeChangedCallback(name, _, newValue) {\n      let val = newValue === '' ? true : newValue;\n      Reflect.set(this, toCamelCase(name), val);\n    }\n  }\n  function reflectiveProp(initialValue) {\n    let value = initialValue;\n    return Object.freeze({\n      enumerable: true,\n      configurable: true,\n      get() {\n        return value;\n      },\n      set(newValue) {\n        value = newValue;\n        this._container.update();\n      }\n    })\n  }\n\n  const proto = new Proxy(BaseElement.prototype, {\n    set(target, key, value, receiver) {\n      if(key in target) {\n        Reflect.set(target, key, value);\n      }\n      let desc;\n      if(typeof key === 'symbol' || key[0] === '_') {\n        desc = {\n          enumerable: true,\n          configurable: true,\n          writable: true,\n          value\n        }; \n      } else {\n        desc = reflectiveProp(value);\n      }\n      Object.defineProperty(receiver, key, desc);\n\n      if(desc.set) {\n        desc.set.call(receiver, value);\n      }\n\n      return true;\n    }\n  });\n\n  Object.setPrototypeOf(Element.prototype, proto);\n\n\n  return Element;\n}\n\nclass Hook {\n  constructor(id, el) {\n    this.id = id;\n    this.el = el;\n  }\n}\n\nfunction use(Hook, ...args) {\n  let id = notify();\n  let hooks = current[hookSymbol];\n  \n  let hook = hooks.get(id);\n  if(!hook) {\n    hook = new Hook(id, current, ...args);\n    hooks.set(id, hook);\n  }\n\n  return hook.update(...args);\n}\n\nfunction hook(Hook) {\n  return use.bind(null, Hook);\n}\n\nconst useMemo = hook(class extends Hook {\n  constructor(id, el, fn, values) {\n    super(id, el);\n    this.value = fn();\n    this.values = values;\n  }\n\n  update(fn, values) {\n    if(this.hasChanged(values)) {\n      this.values = values;\n      this.value = fn();\n    }\n    return this.value;\n  }\n\n  hasChanged(values) {\n    return values.some((value, i) => this.values[i] !== value);\n  }\n});\n\nconst useCallback = (fn, inputs) => useMemo(() => fn, inputs);\n\nfunction setEffects(el, cb) {\n  if(!(effectsSymbol in el)) {\n    el[effectsSymbol] = [];\n  }\n  el[effectsSymbol].push(cb);\n}\n\nconst useEffect = hook(class extends Hook {\n  constructor(id, el) {\n    super(id, el);\n    this.values = false;\n    setEffects(el, this);\n  }\n\n  update(callback, values) {\n    this.callback = callback;\n    this.lastValues = this.values;\n    this.values = values;\n  }\n\n  call() {\n    if(this.values) {\n      if(this.hasChanged()) {\n        this.run();\n      }\n    } else {\n      this.run();\n    }\n  }\n\n  run() {\n    this.teardown();\n    this._teardown = this.callback.call(this.el);\n  }\n\n  teardown() {\n    if(this._teardown) {\n      this._teardown();\n    }\n  }\n\n  hasChanged() {\n    return this.lastValues === false || this.values.some((value, i) => this.lastValues[i] !== value);\n  }\n});\n\nconst useState = hook(class extends Hook {\n  constructor(id, el, initialValue) {\n    super(id, el);\n    this.updater = this.updater.bind(this);\n    this.makeArgs(initialValue);\n  }\n\n  update() {\n    return this.args;\n  }\n\n  updater(value) {\n    if (typeof value === \"function\") {\n      const updaterFn = value;\n      const [previousValue] = this.args;\n      value = updaterFn(previousValue);\n    }\n\n    this.makeArgs(value);\n    this.el.update();\n  }\n\n  makeArgs(value) {\n    this.args = Object.freeze([value, this.updater]);\n  }\n});\n\nconst useReducer = hook(class extends Hook {\n  constructor(id, el, _, initialState) {\n    super(id, el);\n    this.dispatch = this.dispatch.bind(this);\n    this.state = initialState;\n  }\n\n  update(reducer) {\n    this.reducer = reducer;\n    return [this.state, this.dispatch];\n  }\n\n  dispatch(action) {\n    this.state = this.reducer(this.state, action);\n    this.el.update();\n  }\n});\n\nclass DirectiveContainer extends Container {\n  constructor(renderer, part) {\n    super(renderer, part);\n    this.virtual = true;\n  }\n\n  commit(result) {\n    this.host.setValue(result);\n    this.host.commit();\n  }\n}\n\nconst map = new WeakMap();\n\nfunction withHooks(renderer) {\n  function factory(...args) {\n    return part => {\n      let cont = map.get(part);\n      if(!cont) {\n        cont = new DirectiveContainer(renderer, part);\n        map.set(part, cont);\n      }\n      cont.args = args;\n      cont.update();\n    };\n  }\n\n  return directive(factory);\n}\n\nfunction setContexts(el, consumer) {\n  if(!(contextSymbol in el)) {\n    el[contextSymbol] = [];\n  }\n  el[contextSymbol].push(consumer);\n}\n\nconst useContext = hook(class extends Hook {\n  constructor(id, el) {\n    super(id, el);\n    setContexts(el, this);\n    this._updater = this._updater.bind(this);\n  }\n\n  update(Context) {\n    if (this.el.virtual) {\n      throw new Error('can\\'t be used with virtual components');\n    }\n\n    if (this.Context !== Context) {\n      this._subscribe(Context);\n      this.Context = Context;\n    }\n\n    return this.value;\n  }\n\n  _updater(value) {\n    this.value = value;\n    this.el.update();\n  }\n\n  _subscribe(Context) {\n    const detail = { Context, callback: this._updater };\n\n    this.el.host.dispatchEvent(new CustomEvent(contextEvent, {\n      detail, // carrier\n      bubbles: true, // to bubble up in tree\n      cancelable: true, // to be able to cancel\n      composed: true, // to pass ShadowDOM boundaries\n    }));\n\n    const { unsubscribe, value } = detail;\n\n    this.value = unsubscribe ? value : Context.defaultValue;\n\n    this._unsubscribe = unsubscribe;\n  }\n\n  teardown() {\n    if (this._unsubscribe) {\n      this._unsubscribe();\n    }\n  }\n});\n\nconst createContext = (defaultValue) => {\n  const Context = {};\n  \n  Context.Provider = class extends HTMLElement {\n    constructor() {\n      super();\n      this.listeners = [];\n  \n      this.eventHandler = (event) => {\n        const { detail } = event;\n      \n        if (detail.Context === Context) {\n          detail.value = this.value;\n      \n          detail.unsubscribe = () => {\n            const index = this.listeners.indexOf(detail.callback);\n\n            if (index > -1) {\n              this.listeners.splice(index, 1);\n            }\n          };\n\n          this.listeners.push(detail.callback);\n  \n          event.stopPropagation();\n        }\n      };\n  \n      this.addEventListener(contextEvent, this.eventHandler);\n    }\n  \n    disconnectedCallback() {\n      this.removeEventListener(contextEvent, this.eventHandler);\n    }\n\n    set value(value) {\n      this._value = value;\n      this.listeners.forEach(callback => callback(value));\n    }\n\n    get value() {\n      return this._value;\n    }\n  };\n\n  Context.Consumer = component(function ({ render: render$$1 }) {\n    const context = useContext(Context);\n\n    return render$$1(context);\n  });\n\n  Context.defaultValue = defaultValue;\n\n  return Context;\n};\n\nexport { component, useCallback, useEffect, useState, useReducer, useMemo, withHooks, withHooks as virtual, useContext, createContext, hook, Hook };\n","import { hook, Hook } from \"haunted-w-microtask\";\n\n/**\n * Purpose: Provided callback will be called when containerement is disconnected from DOM.\n *          Useful for doing cleanup.\n * Example Usage:\n * ```\n * useDisconnected(callback)\n * ```\n */\nconst useDisconnected = hook(\n  class extends Hook {\n    _callback: Function;\n    constructor(id, container, callback) {\n      super(id, container);\n      this._callback = callback;\n    }\n\n    update(): void {}\n\n    teardown(): void {\n      this._callback();\n    }\n  }\n);\n\nexport { useDisconnected };\n","import { hook, Hook } from \"haunted-w-microtask\";\n\n/**\n * Purpose: Returns a function that will queue the element for updating\n * Example Usage:\n * ```\n * const updateFn = useTriggerUpdate();\n * ```\n */\nconst useTriggerUpdate = hook(\n  class extends Hook {\n    _container: { update: Function };\n    constructor(id, container) {\n      super(id, container);\n      this._container = container;\n    }\n\n    update(): Function {\n      return this._container.update.bind(this._container);\n    }\n  }\n);\n\nexport { useTriggerUpdate };\n","export default function symbolObservablePonyfill(root) {\n\tvar result;\n\tvar Symbol = root.Symbol;\n\n\tif (typeof Symbol === 'function') {\n\t\tif (Symbol.observable) {\n\t\t\tresult = Symbol.observable;\n\t\t} else {\n\t\t\tresult = Symbol('observable');\n\t\t\tSymbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n};\n","/* global window */\nimport ponyfill from './ponyfill.js';\n\nvar root;\n\nif (typeof self !== 'undefined') {\n  root = self;\n} else if (typeof window !== 'undefined') {\n  root = window;\n} else if (typeof global !== 'undefined') {\n  root = global;\n} else if (typeof module !== 'undefined') {\n  root = module;\n} else {\n  root = Function('return this')();\n}\n\nvar result = ponyfill(root);\nexport default result;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar makeOptions = function (opts) {\r\n    if (opts === void 0) { opts = {}; }\r\n    return ({\r\n        arrayFormat: opts.arrayFormat || 'none',\r\n        booleanFormat: opts.booleanFormat || 'none',\r\n        nullFormat: opts.nullFormat || 'default'\r\n    });\r\n};\r\nvar encodeValue = function (value) { return encodeURIComponent(value); };\r\nvar decodeValue = function (value) { return decodeURIComponent(value); };\r\nvar encodeBoolean = function (name, value, opts) {\r\n    if (opts.booleanFormat === 'empty-true' && value) {\r\n        return name;\r\n    }\r\n    var encodedValue;\r\n    if (opts.booleanFormat === 'unicode') {\r\n        encodedValue = value ? '✓' : '✗';\r\n    }\r\n    else {\r\n        encodedValue = value.toString();\r\n    }\r\n    return name + \"=\" + encodedValue;\r\n};\r\nvar encodeNull = function (name, opts) {\r\n    if (opts.nullFormat === 'hidden') {\r\n        return '';\r\n    }\r\n    if (opts.nullFormat === 'string') {\r\n        return name + \"=null\";\r\n    }\r\n    return name;\r\n};\r\nvar getNameEncoder = function (opts) {\r\n    if (opts.arrayFormat === 'index') {\r\n        return function (name, index) { return name + \"[\" + index + \"]\"; };\r\n    }\r\n    if (opts.arrayFormat === 'brackets') {\r\n        return function (name) { return name + \"[]\"; };\r\n    }\r\n    return function (name) { return name; };\r\n};\r\nvar encodeArray = function (name, arr, opts) {\r\n    var encodeName = getNameEncoder(opts);\r\n    return arr\r\n        .map(function (val, index) { return encodeName(name, index) + \"=\" + encodeValue(val); })\r\n        .join('&');\r\n};\r\nvar encode = function (name, value, opts) {\r\n    if (value === null) {\r\n        return encodeNull(name, opts);\r\n    }\r\n    if (typeof value === 'boolean') {\r\n        return encodeBoolean(name, value, opts);\r\n    }\r\n    if (Array.isArray(value)) {\r\n        return encodeArray(name, value, opts);\r\n    }\r\n    return name + \"=\" + encodeValue(value);\r\n};\r\nvar decode = function (value, opts) {\r\n    if (value === undefined) {\r\n        return opts.booleanFormat === 'empty-true' ? true : null;\r\n    }\r\n    if (opts.booleanFormat === 'string') {\r\n        if (value === 'true') {\r\n            return true;\r\n        }\r\n        if (value === 'false') {\r\n            return false;\r\n        }\r\n    }\r\n    else if (opts.booleanFormat === 'unicode') {\r\n        if (decodeValue(value) === '✓') {\r\n            return true;\r\n        }\r\n        if (decodeValue(value) === '✗') {\r\n            return false;\r\n        }\r\n    }\r\n    else if (opts.nullFormat === 'string') {\r\n        if (value === 'null') {\r\n            return null;\r\n        }\r\n    }\r\n    return decodeValue(value);\r\n};\n\nvar getSearch = function (path) {\r\n    var pos = path.indexOf('?');\r\n    if (pos === -1) {\r\n        return path;\r\n    }\r\n    return path.slice(pos + 1);\r\n};\r\nvar isSerialisable = function (val) { return val !== undefined; };\r\nvar parseName = function (name) {\r\n    var bracketPosition = name.indexOf('[');\r\n    var hasBrackets = bracketPosition !== -1;\r\n    return {\r\n        hasBrackets: hasBrackets,\r\n        name: hasBrackets ? name.slice(0, bracketPosition) : name\r\n    };\r\n};\n\n/**\r\n * Parse a querystring and return an object of parameters\r\n */\r\nvar parse = function (path, opts) {\r\n    var options = makeOptions(opts);\r\n    return getSearch(path)\r\n        .split('&')\r\n        .reduce(function (params, param) {\r\n        var _a = param.split('='), rawName = _a[0], value = _a[1];\r\n        var _b = parseName(rawName), hasBrackets = _b.hasBrackets, name = _b.name;\r\n        var currentValue = params[name];\r\n        var decodedValue = decode(value, options);\r\n        if (currentValue === undefined) {\r\n            params[name] = hasBrackets ? [decodedValue] : decodedValue;\r\n        }\r\n        else {\r\n            params[name] = [].concat(currentValue, decodedValue);\r\n        }\r\n        return params;\r\n    }, {});\r\n};\r\n/**\r\n * Build a querystring from an object of parameters\r\n */\r\nvar build = function (params, opts) {\r\n    var options = makeOptions(opts);\r\n    return Object.keys(params)\r\n        .filter(function (paramName) { return isSerialisable(params[paramName]); })\r\n        .map(function (paramName) { return encode(paramName, params[paramName], options); })\r\n        .filter(Boolean)\r\n        .join('&');\r\n};\r\n/**\r\n * Remove a list of parameters from a querystring\r\n */\r\nvar omit = function (path, paramsToOmit, opts) {\r\n    var options = makeOptions(opts);\r\n    var searchPart = getSearch(path);\r\n    if (searchPart === '') {\r\n        return {\r\n            querystring: '',\r\n            removedParams: {}\r\n        };\r\n    }\r\n    var _a = path.split('&').reduce(function (_a, chunk) {\r\n        var left = _a[0], right = _a[1];\r\n        var rawName = chunk.split('=')[0];\r\n        var name = parseName(rawName).name;\r\n        return paramsToOmit.indexOf(name) === -1\r\n            ? [left.concat(chunk), right]\r\n            : [left, right.concat(chunk)];\r\n    }, [[], []]), kept = _a[0], removed = _a[1];\r\n    return {\r\n        querystring: kept.join('&'),\r\n        removedParams: parse(removed.join('&'), options)\r\n    };\r\n};\r\n/**\r\n * Remove a list of parameters from a querystring\r\n */\r\nvar keep = function (path, paramsToKeep, opts) {\r\n    var options = makeOptions(opts);\r\n    var searchPart = getSearch(path);\r\n    if (searchPart === '') {\r\n        return {\r\n            keptParams: {},\r\n            querystring: ''\r\n        };\r\n    }\r\n    var _a = path.split('&').reduce(function (_a, chunk) {\r\n        var left = _a[0], right = _a[1];\r\n        var rawName = chunk.split('=')[0];\r\n        var name = parseName(rawName).name;\r\n        return paramsToKeep.indexOf(name) >= 0\r\n            ? [left.concat(chunk), right]\r\n            : [left, right.concat(chunk)];\r\n    }, [[], []]), kept = _a[0], removed = _a[1];\r\n    return {\r\n        keptParams: parse(kept.join('&'), options),\r\n        querystring: kept.join('&')\r\n    };\r\n};\n\nexports.parse = parse;\nexports.build = build;\nexports.omit = omit;\nexports.keep = keep;\n","import { build, parse } from 'search-params';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n};\n\nvar defaultOrConstrained = function (match) {\r\n    return '(' +\r\n        (match ? match.replace(/(^<|>$)/g, '') : \"[a-zA-Z0-9-_.~%':|=+\\\\*@]+\") +\r\n        ')';\r\n};\r\nvar rules = [\r\n    {\r\n        name: 'url-parameter',\r\n        pattern: /^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,\r\n        regex: function (match) {\r\n            return new RegExp(defaultOrConstrained(match[2]));\r\n        }\r\n    },\r\n    {\r\n        name: 'url-parameter-splat',\r\n        pattern: /^\\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,\r\n        regex: /([^?]*)/\r\n    },\r\n    {\r\n        name: 'url-parameter-matrix',\r\n        pattern: /^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,\r\n        regex: function (match) {\r\n            return new RegExp(';' + match[1] + '=' + defaultOrConstrained(match[2]));\r\n        }\r\n    },\r\n    {\r\n        name: 'query-parameter',\r\n        pattern: /^(?:\\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/\r\n    },\r\n    {\r\n        name: 'delimiter',\r\n        pattern: /^(\\/|\\?)/,\r\n        regex: function (match) { return new RegExp('\\\\' + match[0]); }\r\n    },\r\n    {\r\n        name: 'sub-delimiter',\r\n        pattern: /^(!|&|-|_|\\.|;)/,\r\n        regex: function (match) { return new RegExp(match[0]); }\r\n    },\r\n    {\r\n        name: 'fragment',\r\n        pattern: /^([0-9a-zA-Z]+)/,\r\n        regex: function (match) { return new RegExp(match[0]); }\r\n    }\r\n];\n\nvar tokenise = function (str, tokens) {\r\n    if (tokens === void 0) { tokens = []; }\r\n    // Look for a matching rule\r\n    var matched = rules.some(function (rule) {\r\n        var match = str.match(rule.pattern);\r\n        if (!match) {\r\n            return false;\r\n        }\r\n        tokens.push({\r\n            type: rule.name,\r\n            match: match[0],\r\n            val: match.slice(1, 2),\r\n            otherVal: match.slice(2),\r\n            regex: rule.regex instanceof Function ? rule.regex(match) : rule.regex\r\n        });\r\n        if (match[0].length < str.length) {\r\n            tokens = tokenise(str.substr(match[0].length), tokens);\r\n        }\r\n        return true;\r\n    });\r\n    // If no rules matched, throw an error (possible malformed path)\r\n    if (!matched) {\r\n        throw new Error(\"Could not parse path '\" + str + \"'\");\r\n    }\r\n    return tokens;\r\n};\n\nvar identity = function (_) { return _; };\r\nvar exists = function (val) { return val !== undefined && val !== null; };\r\nvar optTrailingSlash = function (source, strictTrailingSlash) {\r\n    if (strictTrailingSlash) {\r\n        return source;\r\n    }\r\n    if (source === '\\\\/') {\r\n        return source;\r\n    }\r\n    return source.replace(/\\\\\\/$/, '') + '(?:\\\\/)?';\r\n};\r\nvar upToDelimiter = function (source, delimiter) {\r\n    if (!delimiter) {\r\n        return source;\r\n    }\r\n    return /(\\/)$/.test(source) ? source : source + '(\\\\/|\\\\?|\\\\.|;|$)';\r\n};\r\nvar appendQueryParam = function (params, param, val) {\r\n    if (val === void 0) { val = ''; }\r\n    var existingVal = params[param];\r\n    if (existingVal === undefined) {\r\n        params[param] = val;\r\n    }\r\n    else {\r\n        params[param] = Array.isArray(existingVal)\r\n            ? existingVal.concat(val)\r\n            : [existingVal, val];\r\n    }\r\n    return params;\r\n};\r\nvar Path = /** @class */ (function () {\r\n    function Path(path) {\r\n        if (!path) {\r\n            throw new Error('Missing path in Path constructor');\r\n        }\r\n        this.path = path;\r\n        this.tokens = tokenise(path);\r\n        this.hasUrlParams =\r\n            this.tokens.filter(function (t) { return /^url-parameter/.test(t.type); }).length > 0;\r\n        this.hasSpatParam =\r\n            this.tokens.filter(function (t) { return /splat$/.test(t.type); }).length > 0;\r\n        this.hasMatrixParams =\r\n            this.tokens.filter(function (t) { return /matrix$/.test(t.type); }).length > 0;\r\n        this.hasQueryParams =\r\n            this.tokens.filter(function (t) { return /^query-parameter/.test(t.type); }).length > 0;\r\n        // Extract named parameters from tokens\r\n        this.spatParams = this.getParams('url-parameter-splat');\r\n        this.urlParams = this.getParams(/^url-parameter/);\r\n        // Query params\r\n        this.queryParams = this.getParams('query-parameter');\r\n        // All params\r\n        this.params = this.urlParams.concat(this.queryParams);\r\n        // Check if hasQueryParams\r\n        // Regular expressions for url part only (full and partial match)\r\n        this.source = this.tokens\r\n            .filter(function (t) { return t.regex !== undefined; })\r\n            .map(function (r) { return r.regex.source; })\r\n            .join('');\r\n    }\r\n    Path.createPath = function (path) {\r\n        return new Path(path);\r\n    };\r\n    Path.prototype.isQueryParam = function (name) {\r\n        return this.queryParams.indexOf(name) !== -1;\r\n    };\r\n    Path.prototype.test = function (path, opts) {\r\n        var _this = this;\r\n        var options = __assign({ strictTrailingSlash: false, queryParams: {} }, opts);\r\n        // trailingSlash: falsy => non optional, truthy => optional\r\n        var source = optTrailingSlash(this.source, options.strictTrailingSlash);\r\n        // Check if exact match\r\n        var match = this.urlTest(path, source + (this.hasQueryParams ? '(\\\\?.*$|$)' : '$'), opts);\r\n        // If no match, or no query params, no need to go further\r\n        if (!match || !this.hasQueryParams) {\r\n            return match;\r\n        }\r\n        // Extract query params\r\n        var queryParams = parse(path, options.queryParams);\r\n        var unexpectedQueryParams = Object.keys(queryParams).filter(function (p) { return !_this.isQueryParam(p); });\r\n        if (unexpectedQueryParams.length === 0) {\r\n            // Extend url match\r\n            Object.keys(queryParams).forEach(function (p) { return (match[p] = queryParams[p]); });\r\n            return match;\r\n        }\r\n        return null;\r\n    };\r\n    Path.prototype.partialTest = function (path, opts) {\r\n        var _this = this;\r\n        var options = __assign({ delimited: true, queryParams: {} }, opts);\r\n        // Check if partial match (start of given path matches regex)\r\n        // trailingSlash: falsy => non optional, truthy => optional\r\n        var source = upToDelimiter(this.source, options.delimited);\r\n        var match = this.urlTest(path, source, options);\r\n        if (!match) {\r\n            return match;\r\n        }\r\n        if (!this.hasQueryParams) {\r\n            return match;\r\n        }\r\n        var queryParams = parse(path, options.queryParams);\r\n        Object.keys(queryParams)\r\n            .filter(function (p) { return _this.isQueryParam(p); })\r\n            .forEach(function (p) { return appendQueryParam(match, p, queryParams[p]); });\r\n        return match;\r\n    };\r\n    Path.prototype.build = function (params, opts) {\r\n        var _this = this;\r\n        if (params === void 0) { params = {}; }\r\n        var options = __assign({ ignoreConstraints: false, ignoreSearch: false, queryParams: {} }, opts);\r\n        var encodedUrlParams = Object.keys(params)\r\n            .filter(function (p) { return !_this.isQueryParam(p); })\r\n            .reduce(function (acc, key) {\r\n            if (!exists(params[key])) {\r\n                return acc;\r\n            }\r\n            var val = params[key];\r\n            var encode = _this.isQueryParam(key) ? identity : encodeURI;\r\n            if (typeof val === 'boolean') {\r\n                acc[key] = val;\r\n            }\r\n            else if (Array.isArray(val)) {\r\n                acc[key] = val.map(encode);\r\n            }\r\n            else {\r\n                acc[key] = encode(val);\r\n            }\r\n            return acc;\r\n        }, {});\r\n        // Check all params are provided (not search parameters which are optional)\r\n        if (this.urlParams.some(function (p) { return !exists(params[p]); })) {\r\n            var missingParameters = this.urlParams.filter(function (p) { return !exists(params[p]); });\r\n            throw new Error(\"Cannot build path: '\" +\r\n                this.path +\r\n                \"' requires missing parameters { \" +\r\n                missingParameters.join(', ') +\r\n                ' }');\r\n        }\r\n        // Check constraints\r\n        if (!options.ignoreConstraints) {\r\n            var constraintsPassed = this.tokens\r\n                .filter(function (t) {\r\n                return /^url-parameter/.test(t.type) && !/-splat$/.test(t.type);\r\n            })\r\n                .every(function (t) {\r\n                return new RegExp('^' + defaultOrConstrained(t.otherVal[0]) + '$').test(encodedUrlParams[t.val]);\r\n            });\r\n            if (!constraintsPassed) {\r\n                throw new Error(\"Some parameters of '\" + this.path + \"' are of invalid format\");\r\n            }\r\n        }\r\n        var base = this.tokens\r\n            .filter(function (t) { return /^query-parameter/.test(t.type) === false; })\r\n            .map(function (t) {\r\n            if (t.type === 'url-parameter-matrix') {\r\n                return \";\" + t.val + \"=\" + encodedUrlParams[t.val[0]];\r\n            }\r\n            return /^url-parameter/.test(t.type)\r\n                ? encodedUrlParams[t.val[0]]\r\n                : t.match;\r\n        })\r\n            .join('');\r\n        if (options.ignoreSearch) {\r\n            return base;\r\n        }\r\n        var searchParams = this.queryParams\r\n            .filter(function (p) { return Object.keys(params).indexOf(p) !== -1; })\r\n            .reduce(function (sparams, paramName) {\r\n            sparams[paramName] = params[paramName];\r\n            return sparams;\r\n        }, {});\r\n        var searchPart = build(searchParams, options.queryParams);\r\n        return searchPart ? base + '?' + searchPart : base;\r\n    };\r\n    Path.prototype.getParams = function (type) {\r\n        var predicate = type instanceof RegExp\r\n            ? function (t) { return type.test(t.type); }\r\n            : function (t) { return t.type === type; };\r\n        return this.tokens.filter(predicate).map(function (t) { return t.val[0]; });\r\n    };\r\n    Path.prototype.urlTest = function (path, source, _a) {\r\n        var _this = this;\r\n        var _b = (_a === void 0 ? {} : _a).caseSensitive, caseSensitive = _b === void 0 ? false : _b;\r\n        var regex = new RegExp('^' + source, caseSensitive ? '' : 'i');\r\n        var match = path.match(regex);\r\n        if (!match) {\r\n            return null;\r\n        }\r\n        else if (!this.urlParams.length) {\r\n            return {};\r\n        }\r\n        // Reduce named params to key-value pairs\r\n        return match\r\n            .slice(1, this.urlParams.length + 1)\r\n            .reduce(function (params, m, i) {\r\n            params[_this.urlParams[i]] = decodeURIComponent(m);\r\n            return params;\r\n        }, {});\r\n    };\r\n    return Path;\r\n}());\n\nexport default Path;\nexport { Path };\n","import { build, omit, parse } from 'search-params';\nimport { Path } from 'path-parser';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n};\n\nvar getMetaFromSegments = function (segments) {\r\n    var accName = '';\r\n    return segments.reduce(function (meta, segment) {\r\n        var urlParams = segment.parser.urlParams.reduce(function (params, p) {\r\n            params[p] = 'url';\r\n            return params;\r\n        }, {});\r\n        var allParams = segment.parser.queryParams.reduce(function (params, p) {\r\n            params[p] = 'query';\r\n            return params;\r\n        }, urlParams);\r\n        if (segment.name !== undefined) {\r\n            accName = accName ? accName + '.' + segment.name : segment.name;\r\n            meta[accName] = allParams;\r\n        }\r\n        return meta;\r\n    }, {});\r\n};\r\nvar buildStateFromMatch = function (match) {\r\n    if (!match || !match.segments || !match.segments.length) {\r\n        return null;\r\n    }\r\n    var name = match.segments\r\n        .map(function (segment) { return segment.name; })\r\n        .filter(function (name) { return name; })\r\n        .join('.');\r\n    var params = match.params;\r\n    return {\r\n        name: name,\r\n        params: params,\r\n        meta: getMetaFromSegments(match.segments)\r\n    };\r\n};\r\nvar buildPathFromSegments = function (segments, params, options) {\r\n    if (params === void 0) { params = {}; }\r\n    if (options === void 0) { options = {}; }\r\n    if (!segments) {\r\n        return null;\r\n    }\r\n    var _a = options.queryParamsMode, queryParamsMode = _a === void 0 ? 'default' : _a, _b = options.trailingSlashMode;\r\n    var searchParams = [];\r\n    var nonSearchParams = [];\r\n    for (var _i = 0, segments_1 = segments; _i < segments_1.length; _i++) {\r\n        var segment = segments_1[_i];\r\n        var parser = segment.parser;\r\n        searchParams.push.apply(searchParams, parser.queryParams);\r\n        nonSearchParams.push.apply(nonSearchParams, parser.urlParams);\r\n        nonSearchParams.push.apply(nonSearchParams, parser.spatParams);\r\n    }\r\n    if (queryParamsMode === 'loose') {\r\n        var extraParams = Object.keys(params).reduce(function (acc, p) {\r\n            return searchParams.indexOf(p) === -1 &&\r\n                nonSearchParams.indexOf(p) === -1\r\n                ? acc.concat(p)\r\n                : acc;\r\n        }, []);\r\n        searchParams.push.apply(searchParams, extraParams);\r\n    }\r\n    var searchParamsObject = searchParams.reduce(function (acc, paramName) {\r\n        if (Object.keys(params).indexOf(paramName) !== -1) {\r\n            acc[paramName] = params[paramName];\r\n        }\r\n        return acc;\r\n    }, {});\r\n    var searchPart = build(searchParamsObject, options.queryParams);\r\n    var path = segments\r\n        .reduce(function (path, segment) {\r\n        var segmentPath = segment.parser.build(params, {\r\n            ignoreSearch: true,\r\n            queryParams: options.queryParams\r\n        });\r\n        return segment.absolute ? segmentPath : path + segmentPath;\r\n    }, '')\r\n        .replace(/\\/\\/{1,}/g, '/');\r\n    var finalPath = path;\r\n    if (options.trailingSlashMode === 'always') {\r\n        finalPath = /\\/$/.test(path) ? path : path + \"/\";\r\n    }\r\n    else if (options.trailingSlashMode === 'never' && path !== '/') {\r\n        finalPath = /\\/$/.test(path) ? path.slice(0, -1) : path;\r\n    }\r\n    return finalPath + (searchPart ? '?' + searchPart : '');\r\n};\r\nvar getPathFromSegments = function (segments) {\r\n    return segments ? segments.map(function (segment) { return segment.path; }).join('') : null;\r\n};\n\nvar getPath = function (path) { return path.split('?')[0]; };\r\nvar getSearch = function (path) { return path.split('?')[1] || ''; };\r\nvar matchChildren = function (nodes, pathSegment, currentMatch, options, consumedBefore) {\r\n    if (options === void 0) { options = {}; }\r\n    var _a = options.queryParamsMode, queryParamsMode = _a === void 0 ? 'default' : _a, _b = options.strictTrailingSlash, strictTrailingSlash = _b === void 0 ? false : _b, _c = options.strongMatching, strongMatching = _c === void 0 ? true : _c, _d = options.caseSensitive, caseSensitive = _d === void 0 ? false : _d;\r\n    var isRoot = nodes.length === 1 && nodes[0].name === '';\r\n    var _loop_1 = function (child) {\r\n        // Partially match path\r\n        var match;\r\n        var remainingPath = void 0;\r\n        var segment = pathSegment;\r\n        if (consumedBefore === '/' && child.path === '/') {\r\n            // when we encounter repeating slashes we add the slash\r\n            // back to the URL to make it de facto pathless\r\n            segment = '/' + pathSegment;\r\n        }\r\n        if (!child.children.length) {\r\n            match = child.parser.test(segment, {\r\n                caseSensitive: caseSensitive,\r\n                strictTrailingSlash: strictTrailingSlash,\r\n                queryParams: options.queryParams\r\n            });\r\n        }\r\n        if (!match) {\r\n            match = child.parser.partialTest(segment, {\r\n                delimited: strongMatching,\r\n                caseSensitive: caseSensitive,\r\n                queryParams: options.queryParams\r\n            });\r\n        }\r\n        if (match) {\r\n            // Remove consumed segment from path\r\n            var consumedPath = child.parser.build(match, {\r\n                ignoreSearch: true\r\n            });\r\n            if (!strictTrailingSlash && !child.children.length) {\r\n                consumedPath = consumedPath.replace(/\\/$/, '');\r\n            }\r\n            // Can't create a regexp from the path because it might contain a\r\n            // regexp character.\r\n            if (segment.toLowerCase().indexOf(consumedPath.toLowerCase()) === 0) {\r\n                remainingPath = segment.slice(consumedPath.length);\r\n            }\r\n            else {\r\n                remainingPath = segment;\r\n            }\r\n            if (!strictTrailingSlash && !child.children.length) {\r\n                remainingPath = remainingPath.replace(/^\\/\\?/, '?');\r\n            }\r\n            var querystring = omit(getSearch(segment.replace(consumedPath, '')), child.parser.queryParams, options.queryParams).querystring;\r\n            remainingPath =\r\n                getPath(remainingPath) + (querystring ? \"?\" + querystring : '');\r\n            if (!strictTrailingSlash &&\r\n                !isRoot &&\r\n                remainingPath === '/' &&\r\n                !/\\/$/.test(consumedPath)) {\r\n                remainingPath = '';\r\n            }\r\n            currentMatch.segments.push(child);\r\n            Object.keys(match).forEach(function (param) { return (currentMatch.params[param] = match[param]); });\r\n            if (!isRoot && !remainingPath.length) {\r\n                return { value: currentMatch };\r\n            }\r\n            if (!isRoot &&\r\n                queryParamsMode !== 'strict' &&\r\n                remainingPath.indexOf('?') === 0) {\r\n                // unmatched queryParams in non strict mode\r\n                var remainingQueryParams_1 = parse(remainingPath.slice(1), options.queryParams);\r\n                Object.keys(remainingQueryParams_1).forEach(function (name) {\r\n                    return (currentMatch.params[name] = remainingQueryParams_1[name]);\r\n                });\r\n                return { value: currentMatch };\r\n            }\r\n            // Continue matching on non absolute children\r\n            var children = child.getNonAbsoluteChildren();\r\n            // If no children to match against but unmatched path left\r\n            if (!children.length) {\r\n                return { value: null };\r\n            }\r\n            return { value: matchChildren(children, remainingPath, currentMatch, options, consumedPath) };\r\n        }\r\n    };\r\n    // for (child of node.children) {\r\n    for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\r\n        var child = nodes_1[_i];\r\n        var state_1 = _loop_1(child);\r\n        if (typeof state_1 === \"object\")\r\n            return state_1.value;\r\n    }\r\n    return null;\r\n};\n\nfunction sortChildren(children) {\r\n    var originalChildren = children.slice(0);\r\n    return children.sort(sortPredicate(originalChildren));\r\n}\r\nvar sortPredicate = function (originalChildren) { return function (left, right) {\r\n    var leftPath = left.path\r\n        .replace(/<.*?>/g, '')\r\n        .split('?')[0]\r\n        .replace(/(.+)\\/$/, '$1');\r\n    var rightPath = right.path\r\n        .replace(/<.*?>/g, '')\r\n        .split('?')[0]\r\n        .replace(/(.+)\\/$/, '$1');\r\n    // '/' last\r\n    if (leftPath === '/') {\r\n        return 1;\r\n    }\r\n    if (rightPath === '/') {\r\n        return -1;\r\n    }\r\n    // Spat params last\r\n    if (left.parser.hasSpatParam) {\r\n        return 1;\r\n    }\r\n    if (right.parser.hasSpatParam) {\r\n        return -1;\r\n    }\r\n    // No spat, number of segments (less segments last)\r\n    var leftSegments = (leftPath.match(/\\//g) || []).length;\r\n    var rightSegments = (rightPath.match(/\\//g) || []).length;\r\n    if (leftSegments < rightSegments) {\r\n        return 1;\r\n    }\r\n    if (leftSegments > rightSegments) {\r\n        return -1;\r\n    }\r\n    // Same number of segments, number of URL params ascending\r\n    var leftParamsCount = left.parser.urlParams.length;\r\n    var rightParamsCount = right.parser.urlParams.length;\r\n    if (leftParamsCount < rightParamsCount) {\r\n        return -1;\r\n    }\r\n    if (leftParamsCount > rightParamsCount) {\r\n        return 1;\r\n    }\r\n    // Same number of segments and params, last segment length descending\r\n    var leftParamLength = (leftPath.split('/').slice(-1)[0] || '').length;\r\n    var rightParamLength = (rightPath.split('/').slice(-1)[0] || '').length;\r\n    if (leftParamLength < rightParamLength) {\r\n        return 1;\r\n    }\r\n    if (leftParamLength > rightParamLength) {\r\n        return -1;\r\n    }\r\n    // Same last segment length, preserve definition order. Note that we\r\n    // cannot just return 0, as sort is not guaranteed to be a stable sort.\r\n    return originalChildren.indexOf(left) - originalChildren.indexOf(right);\r\n}; };\n\nvar defaultBuildOptions = {\r\n    queryParamsMode: 'default',\r\n    trailingSlashMode: 'default'\r\n};\r\nvar defaultMatchOptions = __assign({}, defaultBuildOptions, { strongMatching: true });\r\nvar RouteNode = /** @class */ (function () {\r\n    function RouteNode(name, path, childRoutes, cb, parent, finalSort, sort) {\r\n        if (name === void 0) { name = ''; }\r\n        if (path === void 0) { path = ''; }\r\n        if (childRoutes === void 0) { childRoutes = []; }\r\n        if (finalSort === void 0) { finalSort = true; }\r\n        this.name = name;\r\n        this.absolute = /^~/.test(path);\r\n        this.path = this.absolute ? path.slice(1) : path;\r\n        this.parser = this.path ? new Path(this.path) : null;\r\n        this.children = [];\r\n        this.parent = parent;\r\n        this.checkParents();\r\n        this.add(childRoutes, cb, finalSort ? false : sort !== false);\r\n        if (finalSort) {\r\n            this.sortDescendants();\r\n        }\r\n        return this;\r\n    }\r\n    RouteNode.prototype.getParentSegments = function (segments) {\r\n        if (segments === void 0) { segments = []; }\r\n        return this.parent && this.parent.parser\r\n            ? this.parent.getParentSegments(segments.concat(this.parent))\r\n            : segments.reverse();\r\n    };\r\n    RouteNode.prototype.setParent = function (parent) {\r\n        this.parent = parent;\r\n        this.checkParents();\r\n    };\r\n    RouteNode.prototype.setPath = function (path) {\r\n        if (path === void 0) { path = ''; }\r\n        this.path = path;\r\n        this.parser = path ? new Path(path) : null;\r\n    };\r\n    RouteNode.prototype.add = function (route, cb, sort) {\r\n        var _this = this;\r\n        if (sort === void 0) { sort = true; }\r\n        if (route === undefined || route === null) {\r\n            return;\r\n        }\r\n        if (route instanceof Array) {\r\n            route.forEach(function (r) { return _this.add(r, cb, sort); });\r\n            return;\r\n        }\r\n        if (!(route instanceof RouteNode) && !(route instanceof Object)) {\r\n            throw new Error('RouteNode.add() expects routes to be an Object or an instance of RouteNode.');\r\n        }\r\n        else if (route instanceof RouteNode) {\r\n            route.setParent(this);\r\n            this.addRouteNode(route, sort);\r\n        }\r\n        else {\r\n            if (!route.name || !route.path) {\r\n                throw new Error('RouteNode.add() expects routes to have a name and a path defined.');\r\n            }\r\n            var routeNode = new RouteNode(route.name, route.path, route.children, cb, this, false, sort);\r\n            var fullName = routeNode\r\n                .getParentSegments([routeNode])\r\n                .map(function (_) { return _.name; })\r\n                .join('.');\r\n            if (cb) {\r\n                cb(__assign({}, route, { name: fullName }));\r\n            }\r\n            this.addRouteNode(routeNode, sort);\r\n        }\r\n        return this;\r\n    };\r\n    RouteNode.prototype.addNode = function (name, path) {\r\n        this.add(new RouteNode(name, path));\r\n        return this;\r\n    };\r\n    RouteNode.prototype.getPath = function (routeName) {\r\n        return getPathFromSegments(this.getSegmentsByName(routeName));\r\n    };\r\n    RouteNode.prototype.getNonAbsoluteChildren = function () {\r\n        return this.children.filter(function (child) { return !child.absolute; });\r\n    };\r\n    RouteNode.prototype.sortChildren = function () {\r\n        if (this.children.length) {\r\n            sortChildren(this.children);\r\n        }\r\n    };\r\n    RouteNode.prototype.sortDescendants = function () {\r\n        this.sortChildren();\r\n        this.children.forEach(function (child) { return child.sortDescendants(); });\r\n    };\r\n    RouteNode.prototype.buildPath = function (routeName, params, options) {\r\n        if (params === void 0) { params = {}; }\r\n        if (options === void 0) { options = {}; }\r\n        var path = buildPathFromSegments(this.getSegmentsByName(routeName), params, options);\r\n        return path;\r\n    };\r\n    RouteNode.prototype.buildState = function (name, params) {\r\n        if (params === void 0) { params = {}; }\r\n        var segments = this.getSegmentsByName(name);\r\n        if (!segments || !segments.length) {\r\n            return null;\r\n        }\r\n        return {\r\n            name: name,\r\n            params: params,\r\n            meta: getMetaFromSegments(segments)\r\n        };\r\n    };\r\n    RouteNode.prototype.matchPath = function (path, options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (path === '' && !options.strictTrailingSlash) {\r\n            path = '/';\r\n        }\r\n        var match = this.getSegmentsMatchingPath(path, options);\r\n        if (match) {\r\n            var matchedSegments = match.segments;\r\n            if (matchedSegments[0].absolute) {\r\n                var firstSegmentParams = matchedSegments[0].getParentSegments();\r\n                matchedSegments.reverse();\r\n                matchedSegments.push.apply(matchedSegments, firstSegmentParams);\r\n                matchedSegments.reverse();\r\n            }\r\n            var lastSegment = matchedSegments[matchedSegments.length - 1];\r\n            var lastSegmentSlashChild = lastSegment.findSlashChild();\r\n            if (lastSegmentSlashChild) {\r\n                matchedSegments.push(lastSegmentSlashChild);\r\n            }\r\n        }\r\n        return buildStateFromMatch(match);\r\n    };\r\n    RouteNode.prototype.addRouteNode = function (route, sort) {\r\n        if (sort === void 0) { sort = true; }\r\n        var names = route.name.split('.');\r\n        if (names.length === 1) {\r\n            // Check duplicated routes\r\n            if (this.children.map(function (child) { return child.name; }).indexOf(route.name) !==\r\n                -1) {\r\n                throw new Error(\"Alias \\\"\" + route.name + \"\\\" is already defined in route node\");\r\n            }\r\n            // Check duplicated paths\r\n            if (this.children.map(function (child) { return child.path; }).indexOf(route.path) !==\r\n                -1) {\r\n                throw new Error(\"Path \\\"\" + route.path + \"\\\" is already defined in route node\");\r\n            }\r\n            this.children.push(route);\r\n            if (sort) {\r\n                this.sortChildren();\r\n            }\r\n        }\r\n        else {\r\n            // Locate parent node\r\n            var segments = this.getSegmentsByName(names.slice(0, -1).join('.'));\r\n            if (segments) {\r\n                route.name = names[names.length - 1];\r\n                segments[segments.length - 1].add(route);\r\n            }\r\n            else {\r\n                throw new Error(\"Could not add route named '\" + route.name + \"', parent is missing.\");\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    RouteNode.prototype.checkParents = function () {\r\n        if (this.absolute && this.hasParentsParams()) {\r\n            throw new Error('[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters');\r\n        }\r\n    };\r\n    RouteNode.prototype.hasParentsParams = function () {\r\n        if (this.parent && this.parent.parser) {\r\n            var parser = this.parent.parser;\r\n            var hasParams = parser.hasUrlParams ||\r\n                parser.hasSpatParam ||\r\n                parser.hasMatrixParams ||\r\n                parser.hasQueryParams;\r\n            return hasParams || this.parent.hasParentsParams();\r\n        }\r\n        return false;\r\n    };\r\n    RouteNode.prototype.findAbsoluteChildren = function () {\r\n        return this.children.reduce(function (absoluteChildren, child) {\r\n            return absoluteChildren\r\n                .concat(child.absolute ? child : [])\r\n                .concat(child.findAbsoluteChildren());\r\n        }, []);\r\n    };\r\n    RouteNode.prototype.findSlashChild = function () {\r\n        var slashChildren = this.getNonAbsoluteChildren().filter(function (child) { return child.parser && /^\\/(\\?|$)/.test(child.parser.path); });\r\n        return slashChildren[0];\r\n    };\r\n    RouteNode.prototype.getSegmentsByName = function (routeName) {\r\n        var findSegmentByName = function (name, routes) {\r\n            var filteredRoutes = routes.filter(function (r) { return r.name === name; });\r\n            return filteredRoutes.length ? filteredRoutes[0] : undefined;\r\n        };\r\n        var segments = [];\r\n        var routes = this.parser ? [this] : this.children;\r\n        var names = (this.parser ? [''] : []).concat(routeName.split('.'));\r\n        var matched = names.every(function (name) {\r\n            var segment = findSegmentByName(name, routes);\r\n            if (segment) {\r\n                routes = segment.children;\r\n                segments.push(segment);\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        return matched ? segments : null;\r\n    };\r\n    RouteNode.prototype.getSegmentsMatchingPath = function (path, options) {\r\n        var topLevelNodes = this.parser ? [this] : this.children;\r\n        var startingNodes = topLevelNodes.reduce(function (nodes, node) { return nodes.concat(node, node.findAbsoluteChildren()); }, []);\r\n        var currentMatch = {\r\n            segments: [],\r\n            params: {}\r\n        };\r\n        var finalMatch = matchChildren(startingNodes, path, currentMatch, options);\r\n        if (finalMatch &&\r\n            finalMatch.segments.length === 1 &&\r\n            finalMatch.segments[0].name === '') {\r\n            return null;\r\n        }\r\n        return finalMatch;\r\n    };\r\n    return RouteNode;\r\n}());\n\nexport default RouteNode;\n","var nameToIDs = function (name) {\r\n    return name\r\n        .split('.')\r\n        .reduce(function (ids, name) {\r\n        return ids.concat(ids.length ? ids[ids.length - 1] + '.' + name : name);\r\n    }, []);\r\n};\r\nvar exists = function (val) { return val !== undefined && val !== null; };\r\nvar hasMetaParams = function (state) { return state && state.meta && state.meta.params; };\r\nvar extractSegmentParams = function (name, state) {\r\n    if (!hasMetaParams(state) || !exists(state.meta.params[name]))\r\n        return {};\r\n    return Object.keys(state.meta.params[name]).reduce(function (params, p) {\r\n        params[p] = state.params[p];\r\n        return params;\r\n    }, {});\r\n};\r\nfunction transitionPath(toState, fromState) {\r\n    var toStateOptions = (toState.meta && toState.meta && toState.meta.options) || {};\r\n    var fromStateIds = fromState ? nameToIDs(fromState.name) : [];\r\n    var toStateIds = nameToIDs(toState.name);\r\n    var maxI = Math.min(fromStateIds.length, toStateIds.length);\r\n    function pointOfDifference() {\r\n        var i;\r\n        var _loop_1 = function () {\r\n            var left = fromStateIds[i];\r\n            var right = toStateIds[i];\r\n            if (left !== right)\r\n                return { value: i };\r\n            var leftParams = extractSegmentParams(left, toState);\r\n            var rightParams = extractSegmentParams(right, fromState);\r\n            if (Object.keys(leftParams).length !==\r\n                Object.keys(rightParams).length)\r\n                return { value: i };\r\n            if (Object.keys(leftParams).length === 0)\r\n                return \"continue\";\r\n            var different = Object.keys(leftParams).some(function (p) { return rightParams[p] !== leftParams[p]; });\r\n            if (different) {\r\n                return { value: i };\r\n            }\r\n        };\r\n        for (i = 0; i < maxI; i += 1) {\r\n            var state_1 = _loop_1();\r\n            if (typeof state_1 === \"object\")\r\n                return state_1.value;\r\n        }\r\n        return i;\r\n    }\r\n    var i;\r\n    if (!fromState || toStateOptions.reload) {\r\n        i = 0;\r\n    }\r\n    else if (!hasMetaParams(fromState) && !hasMetaParams(toState)) {\r\n        i = 0;\r\n    }\r\n    else {\r\n        i = pointOfDifference();\r\n    }\r\n    var toDeactivate = fromStateIds.slice(i).reverse();\r\n    var toActivate = toStateIds.slice(i);\r\n    var intersection = fromState && i > 0 ? fromStateIds[i - 1] : '';\r\n    return {\r\n        intersection: intersection,\r\n        toDeactivate: toDeactivate,\r\n        toActivate: toActivate\r\n    };\r\n}\n\nfunction shouldUpdateNode(nodeName) {\r\n    return function (toState, fromSate) {\r\n        var _a = transitionPath(toState, fromSate), intersection = _a.intersection, toActivate = _a.toActivate, toDeactivateReversed = _a.toDeactivate;\r\n        var toDeactivate = toDeactivateReversed.slice().reverse();\r\n        if (toState.meta.options && toState.meta.options.reload) {\r\n            return true;\r\n        }\r\n        if (nodeName === intersection) {\r\n            return true;\r\n        }\r\n        if (toActivate.indexOf(nodeName) === -1) {\r\n            return false;\r\n        }\r\n        var matching = true;\r\n        for (var i = 0; i < toActivate.length; i += 1) {\r\n            var activatedSegment = toActivate[i];\r\n            var sameLevelDeactivatedSegment = toDeactivate[i];\r\n            matching = activatedSegment === sameLevelDeactivatedSegment;\r\n            if (matching && activatedSegment === nodeName) {\r\n                return true;\r\n            }\r\n            if (!matching) {\r\n                return false;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n}\n\nexport default transitionPath;\nexport { shouldUpdateNode, nameToIDs };\n","import $$observable from 'symbol-observable';\nimport RouteNode from 'route-node';\nexport { default as RouteNode } from 'route-node';\nimport transitionPath, { nameToIDs } from 'router5-transition-path';\nexport { default as transitionPath } from 'router5-transition-path';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nvar defaultOptions = {\r\n    trailingSlashMode: 'default',\r\n    queryParamsMode: 'default',\r\n    strictTrailingSlash: false,\r\n    autoCleanUp: true,\r\n    allowNotFound: false,\r\n    strongMatching: true,\r\n    rewritePathOnMatch: true,\r\n    caseSensitive: false\r\n};\r\nfunction withOptions(options) {\r\n    return function (router) {\r\n        var routerOptions = __assign({}, defaultOptions, options);\r\n        router.getOptions = function () { return routerOptions; };\r\n        router.setOption = function (option, value) {\r\n            routerOptions[option] = value;\r\n            return router;\r\n        };\r\n        return router;\r\n    };\r\n}\n\nvar errorCodes = {\r\n    ROUTER_NOT_STARTED: 'NOT_STARTED',\r\n    NO_START_PATH_OR_STATE: 'NO_START_PATH_OR_STATE',\r\n    ROUTER_ALREADY_STARTED: 'ALREADY_STARTED',\r\n    ROUTE_NOT_FOUND: 'ROUTE_NOT_FOUND',\r\n    SAME_STATES: 'SAME_STATES',\r\n    CANNOT_DEACTIVATE: 'CANNOT_DEACTIVATE',\r\n    CANNOT_ACTIVATE: 'CANNOT_ACTIVATE',\r\n    TRANSITION_ERR: 'TRANSITION_ERR',\r\n    TRANSITION_CANCELLED: 'CANCELLED'\r\n};\r\nvar constants = {\r\n    UNKNOWN_ROUTE: '@@router5/UNKNOWN_ROUTE',\r\n    ROUTER_START: '$start',\r\n    ROUTER_STOP: '$stop',\r\n    TRANSITION_START: '$$start',\r\n    TRANSITION_CANCEL: '$$cancel',\r\n    TRANSITION_SUCCESS: '$$success',\r\n    TRANSITION_ERROR: '$$error'\r\n};\n\nfunction withRoutes(routes) {\r\n    return function (router) {\r\n        router.forward = function (fromRoute, toRoute) {\r\n            router.config.forwardMap[fromRoute] = toRoute;\r\n            return router;\r\n        };\r\n        var rootNode = routes instanceof RouteNode\r\n            ? routes\r\n            : new RouteNode('', '', routes, onRouteAdded);\r\n        function onRouteAdded(route) {\r\n            if (route.canActivate)\r\n                router.canActivate(route.name, route.canActivate);\r\n            if (route.forwardTo)\r\n                router.forward(route.name, route.forwardTo);\r\n            if (route.decodeParams)\r\n                router.config.decoders[route.name] = route.decodeParams;\r\n            if (route.encodeParams)\r\n                router.config.encoders[route.name] = route.encodeParams;\r\n            if (route.defaultParams)\r\n                router.config.defaultParams[route.name] = route.defaultParams;\r\n        }\r\n        router.rootNode = rootNode;\r\n        router.add = function (routes, finalSort) {\r\n            rootNode.add(routes, onRouteAdded, !finalSort);\r\n            if (finalSort) {\r\n                rootNode.sortDescendants();\r\n            }\r\n            return router;\r\n        };\r\n        router.addNode = function (name, path, canActivateHandler) {\r\n            rootNode.addNode(name, path);\r\n            if (canActivateHandler)\r\n                router.canActivate(name, canActivateHandler);\r\n            return router;\r\n        };\r\n        router.isActive = function (name, params, strictEquality, ignoreQueryParams) {\r\n            if (params === void 0) { params = {}; }\r\n            if (strictEquality === void 0) { strictEquality = false; }\r\n            if (ignoreQueryParams === void 0) { ignoreQueryParams = true; }\r\n            var activeState = router.getState();\r\n            if (!activeState)\r\n                return false;\r\n            if (strictEquality || activeState.name === name) {\r\n                return router.areStatesEqual(router.makeState(name, params), activeState, ignoreQueryParams);\r\n            }\r\n            return router.areStatesDescendants(router.makeState(name, params), activeState);\r\n        };\r\n        router.buildPath = function (route, params) {\r\n            if (route === constants.UNKNOWN_ROUTE) {\r\n                return params.path;\r\n            }\r\n            var paramsWithDefault = __assign({}, router.config.defaultParams[route], params);\r\n            var _a = router.getOptions(), trailingSlashMode = _a.trailingSlashMode, queryParamsMode = _a.queryParamsMode, queryParams = _a.queryParams;\r\n            var encodedParams = router.config.encoders[route]\r\n                ? router.config.encoders[route](paramsWithDefault)\r\n                : paramsWithDefault;\r\n            return router.rootNode.buildPath(route, encodedParams, {\r\n                trailingSlashMode: trailingSlashMode,\r\n                queryParamsMode: queryParamsMode,\r\n                queryParams: queryParams\r\n            });\r\n        };\r\n        router.matchPath = function (path, source) {\r\n            var options = router.getOptions();\r\n            var match = router.rootNode.matchPath(path, options);\r\n            if (match) {\r\n                var name_1 = match.name, params = match.params, meta = match.meta;\r\n                var decodedParams = router.config.decoders[name_1]\r\n                    ? router.config.decoders[name_1](params)\r\n                    : params;\r\n                var _a = router.forwardState(name_1, decodedParams), routeName = _a.name, routeParams = _a.params;\r\n                var builtPath = options.rewritePathOnMatch === false\r\n                    ? path\r\n                    : router.buildPath(routeName, routeParams);\r\n                return router.makeState(routeName, routeParams, builtPath, {\r\n                    params: meta,\r\n                    source: source\r\n                });\r\n            }\r\n            return null;\r\n        };\r\n        router.setRootPath = function (rootPath) {\r\n            router.rootNode.setPath(rootPath);\r\n        };\r\n        return router;\r\n    };\r\n}\n\nfunction withDependencies(dependencies) {\r\n    return function (router) {\r\n        var routerDependencies = dependencies;\r\n        router.setDependency = function (dependencyName, dependency) {\r\n            routerDependencies[dependencyName] = dependency;\r\n            return router;\r\n        };\r\n        router.setDependencies = function (deps) {\r\n            Object.keys(deps).forEach(function (name) {\r\n                return router.setDependency(name, deps[name]);\r\n            });\r\n            return router;\r\n        };\r\n        router.getDependencies = function () { return routerDependencies; };\r\n        router.getInjectables = function () { return [router, router.getDependencies()]; };\r\n        router.executeFactory = function (factoryFunction) {\r\n            return factoryFunction.apply(void 0, router.getInjectables());\r\n        };\r\n        return router;\r\n    };\r\n}\n\nfunction withState(router) {\r\n    var stateId = 0;\r\n    var routerState = null;\r\n    router.getState = function () { return routerState; };\r\n    router.setState = function (state) {\r\n        routerState = state;\r\n    };\r\n    router.makeState = function (name, params, path, meta, forceId) { return ({\r\n        name: name,\r\n        params: __assign({}, router.config.defaultParams[name], params),\r\n        path: path,\r\n        meta: meta\r\n            ? __assign({}, meta, { id: forceId === undefined ? ++stateId : forceId }) : undefined\r\n    }); };\r\n    router.makeNotFoundState = function (path, options) {\r\n        return router.makeState(constants.UNKNOWN_ROUTE, { path: path }, path, {\r\n            options: options\r\n        });\r\n    };\r\n    router.areStatesEqual = function (state1, state2, ignoreQueryParams) {\r\n        if (ignoreQueryParams === void 0) { ignoreQueryParams = true; }\r\n        if (state1.name !== state2.name)\r\n            return false;\r\n        var getUrlParams = function (name) {\r\n            return router.rootNode\r\n                //@ts-ignore\r\n                .getSegmentsByName(name)\r\n                .map(function (segment) { return segment.parser['urlParams']; })\r\n                .reduce(function (params, p) { return params.concat(p); }, []);\r\n        };\r\n        var state1Params = ignoreQueryParams\r\n            ? getUrlParams(state1.name)\r\n            : Object.keys(state1.params);\r\n        var state2Params = ignoreQueryParams\r\n            ? getUrlParams(state2.name)\r\n            : Object.keys(state2.params);\r\n        return (state1Params.length === state2Params.length &&\r\n            state1Params.every(function (p) { return state1.params[p] === state2.params[p]; }));\r\n    };\r\n    router.areStatesDescendants = function (parentState, childState) {\r\n        var regex = new RegExp('^' + parentState.name + '\\\\.(.*)$');\r\n        if (!regex.test(childState.name))\r\n            return false;\r\n        // If child state name extends parent state name, and all parent state params\r\n        // are in child state params.\r\n        return Object.keys(parentState.params).every(function (p) { return parentState.params[p] === childState.params[p]; });\r\n    };\r\n    router.forwardState = function (routeName, routeParams) {\r\n        var name = router.config.forwardMap[routeName] || routeName;\r\n        var params = __assign({}, router.config.defaultParams[routeName], router.config.defaultParams[name], routeParams);\r\n        return {\r\n            name: name,\r\n            params: params\r\n        };\r\n    };\r\n    router.buildState = function (routeName, routeParams) {\r\n        var _a = router.forwardState(routeName, routeParams), name = _a.name, params = _a.params;\r\n        return router.rootNode.buildState(name, params);\r\n    };\r\n    return router;\r\n}\n\nvar eventsMap = {\r\n    onStart: constants.ROUTER_START,\r\n    onStop: constants.ROUTER_STOP,\r\n    onTransitionSuccess: constants.TRANSITION_SUCCESS,\r\n    onTransitionStart: constants.TRANSITION_START,\r\n    onTransitionError: constants.TRANSITION_ERROR,\r\n    onTransitionCancel: constants.TRANSITION_CANCEL\r\n};\r\nfunction withPlugins(router) {\r\n    var routerPlugins = [];\r\n    router.getPlugins = function () { return routerPlugins; };\r\n    router.usePlugin = function () {\r\n        var plugins = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            plugins[_i] = arguments[_i];\r\n        }\r\n        var removePluginFns = plugins.map(function (plugin) {\r\n            routerPlugins.push(plugin);\r\n            return startPlugin(plugin);\r\n        });\r\n        return function () {\r\n            routerPlugins = routerPlugins.filter(function (plugin) { return plugins.indexOf(plugin) === -1; });\r\n            removePluginFns.forEach(function (removePlugin) { return removePlugin(); });\r\n        };\r\n    };\r\n    function startPlugin(plugin) {\r\n        var appliedPlugin = router.executeFactory(plugin);\r\n        var removeEventListeners = Object.keys(eventsMap)\r\n            .map(function (methodName) {\r\n            if (appliedPlugin[methodName]) {\r\n                return router.addEventListener(eventsMap[methodName], appliedPlugin[methodName]);\r\n            }\r\n        })\r\n            .filter(Boolean);\r\n        return function () {\r\n            removeEventListeners.forEach(function (removeListener) { return removeListener(); });\r\n            if (appliedPlugin.teardown) {\r\n                appliedPlugin.teardown();\r\n            }\r\n        };\r\n    }\r\n    return router;\r\n}\n\nfunction withMiddleware(router) {\r\n    var middlewareFactories = [];\r\n    var middlewareFunctions = [];\r\n    router.useMiddleware = function () {\r\n        var middlewares = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            middlewares[_i] = arguments[_i];\r\n        }\r\n        var removePluginFns = middlewares.map(function (middleware) {\r\n            var middlewareFunction = router.executeFactory(middleware);\r\n            middlewareFactories.push(middleware);\r\n            middlewareFunctions.push(middlewareFunction);\r\n            return function () {\r\n                middlewareFactories = middlewareFactories.filter(function (m) { return m !== middleware; });\r\n                middlewareFunctions = middlewareFunctions.filter(function (m) { return m !== middlewareFunction; });\r\n            };\r\n        });\r\n        return function () { return removePluginFns.forEach(function (fn) { return fn(); }); };\r\n    };\r\n    router.clearMiddleware = function () {\r\n        middlewareFactories = [];\r\n        middlewareFunctions = [];\r\n        return router;\r\n    };\r\n    router.getMiddlewareFactories = function () { return middlewareFactories; };\r\n    router.getMiddlewareFunctions = function () { return middlewareFunctions; };\r\n    return router;\r\n}\n\nfunction withObservability(router) {\r\n    var callbacks = {};\r\n    router.invokeEventListeners = function (eventName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        (callbacks[eventName] || []).forEach(function (cb) { return cb.apply(void 0, args); });\r\n    };\r\n    router.removeEventListener = function (eventName, cb) {\r\n        callbacks[eventName] = callbacks[eventName].filter(function (_cb) { return _cb !== cb; });\r\n    };\r\n    router.addEventListener = function (eventName, cb) {\r\n        callbacks[eventName] = (callbacks[eventName] || []).concat(cb);\r\n        return function () { return router.removeEventListener(eventName, cb); };\r\n    };\r\n    function subscribe(listener) {\r\n        var isObject = typeof listener === 'object';\r\n        var finalListener = isObject ? listener.next.bind(listener) : listener;\r\n        var unsubscribeHandler = router.addEventListener(constants.TRANSITION_SUCCESS, function (toState, fromState) {\r\n            finalListener({\r\n                route: toState,\r\n                previousRoute: fromState\r\n            });\r\n        });\r\n        return isObject\r\n            ? { unsubscribe: unsubscribeHandler }\r\n            : unsubscribeHandler;\r\n    }\r\n    function observable() {\r\n        var _a;\r\n        return _a = {\r\n                subscribe: function (observer) {\r\n                    if (typeof observer !== 'object' || observer === null) {\r\n                        throw new TypeError('Expected the observer to be an object.');\r\n                    }\r\n                    return subscribe(observer);\r\n                }\r\n            },\r\n            _a[$$observable] = function () {\r\n                return this;\r\n            },\r\n            _a;\r\n    }\r\n    router.subscribe = subscribe;\r\n    //@ts-ignore\r\n    router[$$observable] = observable;\r\n    //@ts-ignore\r\n    router['@@observable'] = observable;\r\n    return router;\r\n}\n\nfunction resolve(functions, _a, callback) {\r\n    var isCancelled = _a.isCancelled, toState = _a.toState, fromState = _a.fromState, _b = _a.errorKey, errorKey = _b === void 0 ? undefined : _b;\r\n    var remainingFunctions = Array.isArray(functions)\r\n        ? functions\r\n        : Object.keys(functions);\r\n    var isState = function (obj) {\r\n        return typeof obj === 'object' &&\r\n            obj.name !== undefined &&\r\n            obj.params !== undefined &&\r\n            obj.path !== undefined;\r\n    };\r\n    var hasStateChanged = function (toState, fromState) {\r\n        return fromState.name !== toState.name ||\r\n            fromState.params !== toState.params ||\r\n            fromState.path !== toState.path;\r\n    };\r\n    var mergeStates = function (toState, fromState) { return (__assign({}, fromState, toState, { meta: __assign({}, fromState.meta, toState.meta) })); };\r\n    var processFn = function (stepFn, errBase, state, _done) {\r\n        var done = function (err, newState) {\r\n            if (err) {\r\n                _done(err);\r\n            }\r\n            else if (newState && newState !== state && isState(newState)) {\r\n                if (hasStateChanged(newState, state)) {\r\n                    console.error('[router5][transition] Warning: state values (name, params, path) were changed during transition process.');\r\n                }\r\n                _done(null, mergeStates(newState, state));\r\n            }\r\n            else {\r\n                _done(null, state);\r\n            }\r\n        };\r\n        var res = stepFn.call(null, state, fromState, done);\r\n        if (isCancelled()) {\r\n            done(null);\r\n        }\r\n        else if (typeof res === 'boolean') {\r\n            done(res ? null : errBase);\r\n        }\r\n        else if (isState(res)) {\r\n            done(null, res);\r\n        }\r\n        else if (res && typeof res.then === 'function') {\r\n            res.then(function (resVal) {\r\n                if (resVal instanceof Error)\r\n                    done({ error: resVal }, null);\r\n                else\r\n                    done(null, resVal);\r\n            }, function (err) {\r\n                if (err instanceof Error) {\r\n                    console.error(err.stack || err);\r\n                    done(__assign({}, errBase, { promiseError: err }), null);\r\n                }\r\n                else {\r\n                    done(typeof err === 'object'\r\n                        ? __assign({}, errBase, err) : errBase, null);\r\n                }\r\n            });\r\n        }\r\n        // else: wait for done to be called\r\n    };\r\n    var next = function (err, state) {\r\n        var _a;\r\n        if (isCancelled()) {\r\n            callback();\r\n        }\r\n        else if (err) {\r\n            callback(err);\r\n        }\r\n        else {\r\n            if (!remainingFunctions.length) {\r\n                callback(null, state);\r\n            }\r\n            else {\r\n                var isMapped = typeof remainingFunctions[0] === 'string';\r\n                var errBase = errorKey && isMapped\r\n                    ? (_a = {}, _a[errorKey] = remainingFunctions[0], _a) : {};\r\n                var stepFn = isMapped\r\n                    ? functions[remainingFunctions[0]]\r\n                    : remainingFunctions[0];\r\n                remainingFunctions = remainingFunctions.slice(1);\r\n                processFn(stepFn, errBase, state, next);\r\n            }\r\n        }\r\n    };\r\n    next(null, toState);\r\n}\n\nfunction transition(router, toState, fromState, opts, callback) {\r\n    var cancelled = false;\r\n    var completed = false;\r\n    var options = router.getOptions();\r\n    var _a = router.getLifecycleFunctions(), canDeactivateFunctions = _a[0], canActivateFunctions = _a[1];\r\n    var middlewareFunctions = router.getMiddlewareFunctions();\r\n    var isCancelled = function () { return cancelled; };\r\n    var cancel = function () {\r\n        if (!cancelled && !completed) {\r\n            cancelled = true;\r\n            callback({ code: errorCodes.TRANSITION_CANCELLED }, null);\r\n        }\r\n    };\r\n    var done = function (err, state) {\r\n        completed = true;\r\n        if (isCancelled()) {\r\n            return;\r\n        }\r\n        if (!err && options.autoCleanUp) {\r\n            var activeSegments_1 = nameToIDs(toState.name);\r\n            Object.keys(canDeactivateFunctions).forEach(function (name) {\r\n                if (activeSegments_1.indexOf(name) === -1)\r\n                    router.clearCanDeactivate(name);\r\n            });\r\n        }\r\n        callback(err, state || toState);\r\n    };\r\n    var makeError = function (base, err) { return (__assign({}, base, (err instanceof Object ? err : { error: err }))); };\r\n    var isUnknownRoute = toState.name === constants.UNKNOWN_ROUTE;\r\n    var asyncBase = { isCancelled: isCancelled, toState: toState, fromState: fromState };\r\n    var _b = transitionPath(toState, fromState), toDeactivate = _b.toDeactivate, toActivate = _b.toActivate;\r\n    var canDeactivate = !fromState || opts.forceDeactivate\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            var canDeactivateFunctionMap = toDeactivate\r\n                .filter(function (name) { return canDeactivateFunctions[name]; })\r\n                .reduce(function (fnMap, name) {\r\n                var _a;\r\n                return (__assign({}, fnMap, (_a = {}, _a[name] = canDeactivateFunctions[name], _a)));\r\n            }, {});\r\n            resolve(canDeactivateFunctionMap, __assign({}, asyncBase, { errorKey: 'segment' }), function (err) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.CANNOT_DEACTIVATE }, err)\r\n                    : null);\r\n            });\r\n        };\r\n    var canActivate = isUnknownRoute\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            var canActivateFunctionMap = toActivate\r\n                .filter(function (name) { return canActivateFunctions[name]; })\r\n                .reduce(function (fnMap, name) {\r\n                var _a;\r\n                return (__assign({}, fnMap, (_a = {}, _a[name] = canActivateFunctions[name], _a)));\r\n            }, {});\r\n            resolve(canActivateFunctionMap, __assign({}, asyncBase, { errorKey: 'segment' }), function (err) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.CANNOT_ACTIVATE }, err)\r\n                    : null);\r\n            });\r\n        };\r\n    var middleware = !middlewareFunctions.length\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            return resolve(middlewareFunctions, __assign({}, asyncBase), function (err, state) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.TRANSITION_ERR }, err)\r\n                    : null, state || toState);\r\n            });\r\n        };\r\n    var pipeline = []\r\n        .concat(canDeactivate)\r\n        .concat(canActivate)\r\n        .concat(middleware);\r\n    resolve(pipeline, asyncBase, done);\r\n    return cancel;\r\n}\n\nvar noop = function (err, state) { };\r\nfunction withNavigation(router) {\r\n    var cancelCurrentTransition;\r\n    router.navigate = navigate;\r\n    router.navigate = navigate;\r\n    router.navigateToDefault = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var opts = typeof args[0] === 'object' ? args[0] : {};\r\n        var done = args.length === 2\r\n            ? args[1]\r\n            : typeof args[0] === 'function'\r\n                ? args[0]\r\n                : noop;\r\n        var options = router.getOptions();\r\n        if (options.defaultRoute) {\r\n            return navigate(options.defaultRoute, options.defaultParams, opts, done);\r\n        }\r\n        return function () { };\r\n    };\r\n    router.cancel = function () {\r\n        if (cancelCurrentTransition) {\r\n            cancelCurrentTransition('navigate');\r\n            cancelCurrentTransition = null;\r\n        }\r\n        return router;\r\n    };\r\n    function navigate() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var name = args[0];\r\n        var lastArg = args[args.length - 1];\r\n        var done = typeof lastArg === 'function' ? lastArg : noop;\r\n        var params = typeof args[1] === 'object' ? args[1] : {};\r\n        var opts = typeof args[2] === 'object' ? args[2] : {};\r\n        if (!router.isStarted()) {\r\n            done({ code: errorCodes.ROUTER_NOT_STARTED });\r\n            return;\r\n        }\r\n        var route = router.buildState(name, params);\r\n        if (!route) {\r\n            var err = { code: errorCodes.ROUTE_NOT_FOUND };\r\n            done(err);\r\n            router.invokeEventListeners(constants.TRANSITION_ERROR, null, router.getState(), err);\r\n            return;\r\n        }\r\n        var toState = router.makeState(route.name, route.params, router.buildPath(route.name, route.params), { params: route.meta, options: opts });\r\n        var sameStates = router.getState()\r\n            ? router.areStatesEqual(router.getState(), toState, false)\r\n            : false;\r\n        // Do not proceed further if states are the same and no reload\r\n        // (no deactivation and no callbacks)\r\n        if (sameStates && !opts.reload && !opts.force) {\r\n            var err = { code: errorCodes.SAME_STATES };\r\n            done(err);\r\n            router.invokeEventListeners(constants.TRANSITION_ERROR, toState, router.getState(), err);\r\n            return;\r\n        }\r\n        var fromState = router.getState();\r\n        if (opts.skipTransition) {\r\n            done(null, toState);\r\n            return noop;\r\n        }\r\n        // Transition\r\n        return router.transitionToState(toState, fromState, opts, function (err, state) {\r\n            if (err) {\r\n                if (err.redirect) {\r\n                    var _a = err.redirect, name_1 = _a.name, params_1 = _a.params;\r\n                    navigate(name_1, params_1, __assign({}, opts, { force: true, redirected: true }), done);\r\n                }\r\n                else {\r\n                    done(err);\r\n                }\r\n            }\r\n            else {\r\n                router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, fromState, opts);\r\n                done(null, state);\r\n            }\r\n        });\r\n    }\r\n    router.transitionToState = function (toState, fromState, options, done) {\r\n        if (options === void 0) { options = {}; }\r\n        if (done === void 0) { done = noop; }\r\n        router.cancel();\r\n        router.invokeEventListeners(constants.TRANSITION_START, toState, fromState);\r\n        cancelCurrentTransition = transition(router, toState, fromState, options, function (err, state) {\r\n            cancelCurrentTransition = null;\r\n            state = state || toState;\r\n            if (err) {\r\n                if (err.code === errorCodes.TRANSITION_CANCELLED) {\r\n                    router.invokeEventListeners(constants.TRANSITION_CANCEL, toState, fromState);\r\n                }\r\n                else {\r\n                    router.invokeEventListeners(constants.TRANSITION_ERROR, toState, fromState, err);\r\n                }\r\n                done(err);\r\n            }\r\n            else {\r\n                router.setState(state);\r\n                done(null, state);\r\n            }\r\n        });\r\n        return cancelCurrentTransition;\r\n    };\r\n    return router;\r\n}\n\nvar noop$1 = function () { };\r\nfunction withRouterLifecycle(router) {\r\n    var started = false;\r\n    router.isStarted = function () { return started; };\r\n    //@ts-ignore\r\n    router.start = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var options = router.getOptions();\r\n        var lastArg = args[args.length - 1];\r\n        var done = typeof lastArg === 'function' ? lastArg : noop$1;\r\n        var startPathOrState = typeof args[0] !== 'function' ? args[0] : undefined;\r\n        if (started) {\r\n            done({ code: errorCodes.ROUTER_ALREADY_STARTED });\r\n            return router;\r\n        }\r\n        var startPath, startState;\r\n        started = true;\r\n        router.invokeEventListeners(constants.ROUTER_START);\r\n        // callback\r\n        var cb = function (err, state, invokeErrCb) {\r\n            if (invokeErrCb === void 0) { invokeErrCb = true; }\r\n            if (!err)\r\n                router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, null, { replace: true });\r\n            if (err && invokeErrCb)\r\n                router.invokeEventListeners(constants.TRANSITION_ERROR, state, null, err);\r\n            done(err, state);\r\n        };\r\n        if (startPathOrState === undefined && !options.defaultRoute) {\r\n            return cb({ code: errorCodes.NO_START_PATH_OR_STATE });\r\n        }\r\n        if (typeof startPathOrState === 'string') {\r\n            startPath = startPathOrState;\r\n        }\r\n        else if (typeof startPathOrState === 'object') {\r\n            startState = startPathOrState;\r\n        }\r\n        if (!startState) {\r\n            // If no supplied start state, get start state\r\n            startState =\r\n                startPath === undefined ? null : router.matchPath(startPath);\r\n            // Navigate to default function\r\n            var navigateToDefault_1 = function () {\r\n                return router.navigateToDefault({ replace: true }, done);\r\n            };\r\n            var redirect_1 = function (route) {\r\n                return router.navigate(route.name, route.params, { replace: true, reload: true, redirected: true }, done);\r\n            };\r\n            var transitionToState = function (state) {\r\n                router.transitionToState(state, router.getState(), {}, function (err, state) {\r\n                    if (!err)\r\n                        cb(null, state);\r\n                    else if (err.redirect)\r\n                        redirect_1(err.redirect);\r\n                    else if (options.defaultRoute)\r\n                        navigateToDefault_1();\r\n                    else\r\n                        cb(err, null, false);\r\n                });\r\n            };\r\n            // If matched start path\r\n            if (startState) {\r\n                transitionToState(startState);\r\n            }\r\n            else if (options.defaultRoute) {\r\n                // If default, navigate to default\r\n                navigateToDefault_1();\r\n            }\r\n            else if (options.allowNotFound) {\r\n                transitionToState(router.makeNotFoundState(startPath, { replace: true }));\r\n            }\r\n            else {\r\n                // No start match, no default => do nothing\r\n                cb({ code: errorCodes.ROUTE_NOT_FOUND, path: startPath }, null);\r\n            }\r\n        }\r\n        else {\r\n            // Initialise router with provided start state\r\n            router.setState(startState);\r\n            cb(null, startState);\r\n        }\r\n        return router;\r\n    };\r\n    router.stop = function () {\r\n        if (started) {\r\n            router.setState(null);\r\n            started = false;\r\n            router.invokeEventListeners(constants.ROUTER_STOP);\r\n        }\r\n        return router;\r\n    };\r\n    return router;\r\n}\n\nvar toFunction = function (val) { return (typeof val === 'function' ? val : function () { return function () { return val; }; }); };\r\nfunction withRouteLifecycle(router) {\r\n    var canDeactivateFactories = {};\r\n    var canActivateFactories = {};\r\n    var canDeactivateFunctions = {};\r\n    var canActivateFunctions = {};\r\n    router.getLifecycleFactories = function () {\r\n        return [canDeactivateFactories, canActivateFactories];\r\n    };\r\n    router.getLifecycleFunctions = function () {\r\n        return [canDeactivateFunctions, canActivateFunctions];\r\n    };\r\n    router.canDeactivate = function (name, canDeactivateHandler) {\r\n        var factory = toFunction(canDeactivateHandler);\r\n        canDeactivateFactories[name] = factory;\r\n        canDeactivateFunctions[name] = router.executeFactory(factory);\r\n        return router;\r\n    };\r\n    router.clearCanDeactivate = function (name) {\r\n        canDeactivateFactories[name] = undefined;\r\n        canDeactivateFunctions[name] = undefined;\r\n        return router;\r\n    };\r\n    router.canActivate = function (name, canActivateHandler) {\r\n        var factory = toFunction(canActivateHandler);\r\n        canActivateFactories[name] = factory;\r\n        canActivateFunctions[name] = router.executeFactory(factory);\r\n        return router;\r\n    };\r\n    return router;\r\n}\n\nvar pipe = function () {\r\n    var fns = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        fns[_i] = arguments[_i];\r\n    }\r\n    return function (arg) {\r\n        return fns.reduce(function (prev, fn) { return fn(prev); }, arg);\r\n    };\r\n};\r\nvar createRouter = function (routes, options, dependencies) {\r\n    if (routes === void 0) { routes = []; }\r\n    if (options === void 0) { options = {}; }\r\n    if (dependencies === void 0) { dependencies = {}; }\r\n    var config = {\r\n        decoders: {},\r\n        encoders: {},\r\n        defaultParams: {},\r\n        forwardMap: {}\r\n    };\r\n    return pipe(withOptions(options), withDependencies(dependencies), withObservability, withState, withRouterLifecycle, withRouteLifecycle, withNavigation, withPlugins, withMiddleware, withRoutes(routes))({ config: config });\r\n};\n\nfunction cloneRouter(router, dependencies) {\r\n    var clonedRouter = createRouter(router.rootNode, router.getOptions(), dependencies);\r\n    clonedRouter.useMiddleware.apply(clonedRouter, router.getMiddlewareFactories());\r\n    clonedRouter.usePlugin.apply(clonedRouter, router.getPlugins());\r\n    clonedRouter.config = router.config;\r\n    var _a = router.getLifecycleFactories(), canDeactivateFactories = _a[0], canActivateFactories = _a[1];\r\n    Object.keys(canDeactivateFactories).forEach(function (name) {\r\n        return clonedRouter.canDeactivate(name, canDeactivateFactories[name]);\r\n    });\r\n    Object.keys(canActivateFactories).forEach(function (name) {\r\n        return clonedRouter.canActivate(name, canActivateFactories[name]);\r\n    });\r\n    return clonedRouter;\r\n}\n\nexport default createRouter;\nexport { createRouter, cloneRouter, constants, errorCodes };\n","import { errorCodes, constants } from 'router5';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nvar value = function (arg) { return function () { return arg; }; };\r\nvar noop = function () { };\r\nvar isBrowser = typeof window !== 'undefined' && window.history;\r\nvar getBase = function () { return window.location.pathname; };\r\nvar supportsPopStateOnHashChange = function () {\r\n    return window.navigator.userAgent.indexOf('Trident') === -1;\r\n};\r\nvar pushState = function (state, title, path) {\r\n    return window.history.pushState(state, title, path);\r\n};\r\nvar replaceState = function (state, title, path) {\r\n    return window.history.replaceState(state, title, path);\r\n};\r\nvar addPopstateListener = function (fn, opts) {\r\n    var shouldAddHashChangeListener = opts.useHash && !supportsPopStateOnHashChange();\r\n    window.addEventListener('popstate', fn);\r\n    if (shouldAddHashChangeListener) {\r\n        window.addEventListener('hashchange', fn);\r\n    }\r\n    return function () {\r\n        window.removeEventListener('popstate', fn);\r\n        if (shouldAddHashChangeListener) {\r\n            window.removeEventListener('hashchange', fn);\r\n        }\r\n    };\r\n};\r\nvar getLocation = function (opts) {\r\n    var path = opts.useHash\r\n        ? window.location.hash.replace(new RegExp('^#' + opts.hashPrefix), '')\r\n        : window.location.pathname.replace(new RegExp('^' + opts.base), '');\r\n    // Fix issue with browsers that don't URL encode characters (Edge)\r\n    var correctedPath = safelyEncodePath(path);\r\n    return (correctedPath || '/') + window.location.search;\r\n};\r\nvar safelyEncodePath = function (path) {\r\n    try {\r\n        return encodeURI(decodeURI(path));\r\n    }\r\n    catch (_) {\r\n        return path;\r\n    }\r\n};\r\nvar getState = function () { return window.history.state; };\r\nvar getHash = function () { return window.location.hash; };\r\nvar browser = {};\r\nif (isBrowser) {\r\n    browser = {\r\n        getBase: getBase,\r\n        pushState: pushState,\r\n        replaceState: replaceState,\r\n        addPopstateListener: addPopstateListener,\r\n        getLocation: getLocation,\r\n        getState: getState,\r\n        getHash: getHash\r\n    };\r\n}\r\nelse {\r\n    browser = {\r\n        getBase: value(''),\r\n        pushState: noop,\r\n        replaceState: noop,\r\n        addPopstateListener: noop,\r\n        getLocation: value(''),\r\n        getState: value(null),\r\n        getHash: value('')\r\n    };\r\n}\r\nvar safeBrowser = browser;\n\nvar defaultOptions = {\r\n    forceDeactivate: true,\r\n    useHash: false,\r\n    hashPrefix: '',\r\n    base: '',\r\n    mergeState: false,\r\n    preserveHash: true\r\n};\r\nvar source = 'popstate';\r\nfunction browserPluginFactory(opts, browser) {\r\n    if (browser === void 0) { browser = safeBrowser; }\r\n    var options = __assign({}, defaultOptions, opts);\r\n    var transitionOptions = {\r\n        forceDeactivate: options.forceDeactivate,\r\n        source: source\r\n    };\r\n    var removePopStateListener;\r\n    return function browserPlugin(router) {\r\n        var routerOptions = router.getOptions();\r\n        var routerStart = router.start;\r\n        router.buildUrl = function (route, params) {\r\n            var base = options.base || '';\r\n            var prefix = options.useHash ? \"#\" + options.hashPrefix : '';\r\n            var path = router.buildPath(route, params);\r\n            if (path === null)\r\n                return null;\r\n            return base + prefix + path;\r\n        };\r\n        var urlToPath = function (url) {\r\n            var match = url.match(/^(?:http|https):\\/\\/(?:[0-9a-z_\\-.:]+?)(?=\\/)(.*)$/);\r\n            var path = match ? match[1] : url;\r\n            var pathParts = path.match(/^(.+?)(#.+?)?(\\?.+)?$/);\r\n            if (!pathParts)\r\n                throw new Error(\"[router5] Could not parse url \" + url);\r\n            var pathname = pathParts[1];\r\n            var hash = pathParts[2] || '';\r\n            var search = pathParts[3] || '';\r\n            return ((options.useHash\r\n                ? hash.replace(new RegExp('^#' + options.hashPrefix), '')\r\n                : options.base\r\n                    ? pathname.replace(new RegExp('^' + options.base), '')\r\n                    : pathname) + search);\r\n        };\r\n        router.matchUrl = function (url) { return router.matchPath(urlToPath(url)); };\r\n        router.start = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            if (args.length === 0 || typeof args[0] === 'function') {\r\n                routerStart.apply(void 0, [browser.getLocation(options)].concat(args));\r\n            }\r\n            else {\r\n                routerStart.apply(void 0, args);\r\n            }\r\n            return router;\r\n        };\r\n        router.replaceHistoryState = function (name, params, title) {\r\n            if (params === void 0) { params = {}; }\r\n            if (title === void 0) { title = ''; }\r\n            var route = router.buildState(name, params);\r\n            var state = router.makeState(route.name, route.params, router.buildPath(route.name, route.params), { params: route.meta });\r\n            var url = router.buildUrl(name, params);\r\n            router.lastKnownState = state;\r\n            browser.replaceState(state, title, url);\r\n        };\r\n        function updateBrowserState(state, url, replace) {\r\n            var trimmedState = state\r\n                ? {\r\n                    meta: state.meta,\r\n                    name: state.name,\r\n                    params: state.params,\r\n                    path: state.path\r\n                }\r\n                : state;\r\n            var finalState = options.mergeState === true\r\n                ? __assign({}, browser.getState(), trimmedState) : trimmedState;\r\n            if (replace)\r\n                browser.replaceState(finalState, '', url);\r\n            else\r\n                browser.pushState(finalState, '', url);\r\n        }\r\n        function onPopState(evt) {\r\n            var routerState = router.getState();\r\n            // Do nothing if no state or if last know state is poped state (it should never happen)\r\n            var newState = !evt.state || !evt.state.name;\r\n            var state = newState\r\n                ? router.matchPath(browser.getLocation(options), source)\r\n                : router.makeState(evt.state.name, evt.state.params, evt.state.path, __assign({}, evt.state.meta, { source: source }), evt.state.meta.id);\r\n            var defaultRoute = routerOptions.defaultRoute, defaultParams = routerOptions.defaultParams;\r\n            if (!state) {\r\n                // If current state is already the default route, we will have a double entry\r\n                // Navigating back and forth will emit SAME_STATES error\r\n                defaultRoute &&\r\n                    router.navigateToDefault(__assign({}, transitionOptions, { reload: true, replace: true }));\r\n                return;\r\n            }\r\n            if (routerState &&\r\n                router.areStatesEqual(state, routerState, false)) {\r\n                return;\r\n            }\r\n            router.transitionToState(state, routerState, transitionOptions, function (err, toState) {\r\n                if (err) {\r\n                    if (err.redirect) {\r\n                        var _a = err.redirect, name_1 = _a.name, params = _a.params;\r\n                        router.navigate(name_1, params, __assign({}, transitionOptions, { replace: true, force: true, redirected: true }));\r\n                    }\r\n                    else if (err.code === errorCodes.CANNOT_DEACTIVATE) {\r\n                        var url = router.buildUrl(routerState.name, routerState.params);\r\n                        if (!newState) {\r\n                            // Keep history state unchanged but use current URL\r\n                            updateBrowserState(state, url, true);\r\n                        }\r\n                        // else do nothing or history will be messed up\r\n                        // TODO: history.back()?\r\n                    }\r\n                    else {\r\n                        // Force navigation to default state\r\n                        defaultRoute &&\r\n                            router.navigate(defaultRoute, defaultParams, __assign({}, transitionOptions, { reload: true, replace: true }));\r\n                    }\r\n                }\r\n                else {\r\n                    router.invokeEventListeners(constants.TRANSITION_SUCCESS, toState, routerState, { replace: true });\r\n                }\r\n            });\r\n        }\r\n        function onStart() {\r\n            if (options.useHash && !options.base) {\r\n                // Guess base\r\n                options.base = browser.getBase();\r\n            }\r\n            removePopStateListener = browser.addPopstateListener(onPopState, options);\r\n        }\r\n        function teardown() {\r\n            if (removePopStateListener) {\r\n                removePopStateListener();\r\n                removePopStateListener = undefined;\r\n            }\r\n        }\r\n        function onTransitionSuccess(toState, fromState, opts) {\r\n            var historyState = browser.getState();\r\n            var hasState = historyState &&\r\n                historyState.meta &&\r\n                historyState.name &&\r\n                historyState.params;\r\n            var statesAreEqual = fromState && router.areStatesEqual(fromState, toState, false);\r\n            var replace = opts.replace || !hasState || statesAreEqual;\r\n            var url = router.buildUrl(toState.name, toState.params);\r\n            if (fromState === null &&\r\n                options.useHash === false &&\r\n                options.preserveHash === true) {\r\n                url += browser.getHash();\r\n            }\r\n            updateBrowserState(toState, url, replace);\r\n        }\r\n        return {\r\n            onStart: onStart,\r\n            onStop: teardown,\r\n            teardown: teardown,\r\n            onTransitionSuccess: onTransitionSuccess,\r\n            onPopState: onPopState\r\n        };\r\n    };\r\n}\n\nexport default browserPluginFactory;\n","import { useState, useMemo } from \"haunted-w-microtask\";\nimport { useDisconnected } from \"./use-disconnected\";\nimport { useTriggerUpdate } from \"./use-trigger-update\";\n\nimport createRouter from 'router5'\nimport browserPlugin from 'router5-plugin-browser'\n\n// router5 doesn't want lots of individual instances, so use a singleton\nconst router = createRouter([{name: 'default', path: '*route'}])\nrouter.usePlugin(browserPlugin({\n  useHash: true\n}));\nrouter.start();\n\nexport function useRouter(options): any {\n  const [timesDisconnected, setTimesDisconnected] = useState(0);\n  const triggerUpdate = useTriggerUpdate();\n\n  const routerApi = useMemo(function() {\n    \n    let route = \"\"; // the current partial route that this component cares about\n\n    // router5 passes state into the handler with no hash.  \n    // If default route is defined with it, we need to add it back when processing\n    let useHash = options.defaultRoute[0] === '#';\n\n    const handler = (routerState): void => {\n      let _route = routerState.route.path;\n\n      // If a defined route matches the current route, use it.\n      if (options.routes[_route.replace(options.baseRoute, '')] ||\n          options.routes[('#'+_route).replace(options.baseRoute, '')]) {\n        route = _route\n        triggerUpdate();\n        return;\n      }\n      \n      // If a defined route is a base for the current route, do return the base.\n      // This is for parent routers to relax and be okay with what their kids are doing.\n      const partialPath = Object.keys(options.routes).reduce((out, routePath) => {\n        return _route.indexOf(routePath) === 0 ||\n               ('#'+_route).indexOf(routePath) === 0 ? routePath : out;\n      }, \"\");      \n      if (partialPath) {\n        route = partialPath;\n        triggerUpdate();\n        return;\n      }\n\n      // At this point, if this our baseRoute matches the currentRoute, it means \n      // the current route is invalid and we should handle it by redirecting to our default route.\n      if (_route.indexOf(options.baseRoute) === 0 ||\n          ('#'+_route).indexOf(options.baseRoute) === 0) {\n        route = options.baseRoute + options.defaultRoute;        \n        triggerUpdate();\n        //router.navigate(route, {}, {replace:true});\n        window.location.hash = route;\n      }\n    }\n\n    //subscribe to future changes\n    const routerUnsubscribe = router.subscribe(handler);\n    \n    //invoke the handler for the current route\n    handler({\n      route: router.getState()\n    });\n\n    //return methods to be invoked elsewhere\n    return {\n      getRoute : () => {\n        // TODO: currently having to do some gymnastics to manage where '#' should be returned\n        let tempRoute = route;\n        if (tempRoute[0] !== '#' && options.baseRoute[0] === '#') {\n          tempRoute = '#'+tempRoute;\n        } else if (useHash && tempRoute[0] !== '#') {\n          tempRoute = '#'+tempRoute;\n        }\n        return tempRoute.replace(options.baseRoute, '')\n      },\n      unsubscribe: routerUnsubscribe\n    };\n\n    // using timesDisconnected as a memo is one way to manage subscribing/unsubscribing\n  }, [timesDisconnected]); \n\n  useDisconnected(() => {\n    routerApi.unsubscribe();\n    setTimesDisconnected(timesDisconnected + 1);\n  });\n  \n  return routerApi.getRoute(); //return the valid partial route that the component will care about\n};\n","/* eslint-disable */\n\nimport { component, html } from \"haunted-w-microtask\";\n\nimport { useRouter } from './use-router';\n\nconst routes = {\n    \"/child-route-A\": html`<h2>I am child 1 route A</h2>`,\n    \"/child-route-B\": html`<h2>I am child 1 route B</h2>`\n};\n\nfunction ChildOne({baseRoute}) {\n  const route = useRouter({\n    id: \"childRouter\",\n    routes: routes,\n    defaultRoute: \"/child-route-A\",\n    baseRoute: baseRoute\n  });\n\n  return !route ? html`` : html`\n    <h1>I am child 1.  I have a child router</h1>\n\n    <a href=\"${baseRoute}/child-route-A\">Go to child route A</a>\n    <a href=\"${baseRoute}/child-route-B\">Go to child route B</a>\n\n    ${routes[route]}\n  `;\n}\n\nChildOne.observedAttributes = ['base-route'];\n\ncustomElements.define(\n  \"child-one\",\n  component(ChildOne, HTMLElement, {\n    useShadowDOM: false\n  })\n);\n","/* eslint-disable */\n\nimport { component, html } from \"haunted-w-microtask\";\n\nfunction ChildTwo(el) {\n  return html`\n    <h1>I am child 2. I don't have a child router</h1>\n  `;\n}\n\ncustomElements.define(\n  \"child-two\",\n  component(ChildTwo, HTMLElement, {\n    useShadowDOM: false\n  })\n);\n","/* eslint-disable */\n\nimport { component, html } from \"haunted-w-microtask\";\nimport \"./router-test.scss\";\nimport { useRouter } from './use-router';\n\nimport \"./child-one\";\nimport \"./child-two\"\n\nconst routes = {\n    \"#/route1\": html`<child-one base-route=\"#/route1\"></child-one>`,\n    \"#/route2\": html`<child-two base-route=\"#/route2\"></child-two>`\n};\n\nfunction RouterTest(el) {\n\n  const route = useRouter({\n    id: \"parentRouter\",\n    routes: routes,\n    defaultRoute: \"#/route1\",\n    baseRoute: \"\"\n  });\n\n  return !route ? html`` : html`\n    <h1>Element with router</h1>\n\n    <a href=\"#/route1\">Go To Child 1</a>\n    <a href=\"#/route2\">Go To Child 2</a>\n\n    <main>\n      ${routes[route]}\n    </main>\n  `;\n}\n\ncustomElements.define(\n  \"router-test\",\n  component(RouterTest, HTMLElement, {\n    useShadowDOM: false\n  })\n);\n"]}